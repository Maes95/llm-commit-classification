{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Hans Verkuil <hverkuil-cisco@xs4all.nl>", "AuthorDate": "Mon Jul 11 12:21:08 2022 +0200", "Commit": "Mauro Carvalho Chehab <mchehab@kernel.org>", "CommitDate": "Fri Aug 19 13:47:00 2022 +0200", "Signed-off-by": ["Hans Verkuil <hverkuil-cisco@xs4all.nl>", "Mauro Carvalho Chehab <mchehab@kernel.org>"], "commit": "7392d87a9febb5f46f28d4704eb5636c5e22cdeb", "files": [{"action": "M", "added": "1", "file": "drivers/media/v4l2-core/v4l2-ctrls-api.c", "indexes": ["1b90bd7c4010", "6f1b72c59e8e"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "19", "file": "drivers/media/v4l2-core/v4l2-ctrls-core.c", "indexes": ["9871c77f559b", "a004fea10da2"], "modes": ["100644", "100644"], "removed": "12"}, {"action": "M", "added": "8", "file": "include/media/v4l2-ctrls.h", "indexes": ["5ddd506ae7b9", "c7a082c319d4"], "modes": ["100644", "100644"], "removed": "8"}], "message": "media: v4l2-ctrls: alloc arrays in ctrl_ref\n\nAlso allocate space for arrays in struct ctrl_ref.\n\nThis is in preparation for allowing to change the array size from\na driver.\n\nSigned-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>\nReviewed-by: Laurent Pinchart <laurent.pinchart+renesas@ideasonboard.com>\nSigned-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>", "parents": ["5f2c5c69a61dc5411d436c1a422f8a1ee195a924"], "refs": [], "diff": "diff --git a/drivers/media/v4l2-core/v4l2-ctrls-api.c b/drivers/media/v4l2-core/v4l2-ctrls-api.c\nindex 1b90bd7c4010..6f1b72c59e8e 100644\n--- a/drivers/media/v4l2-core/v4l2-ctrls-api.c\n+++ b/drivers/media/v4l2-core/v4l2-ctrls-api.c\n@@ -467,7 +467,7 @@ int v4l2_g_ext_ctrls_common(struct v4l2_ctrl_handler *hdl,\n \n \t\t\tif (is_default)\n \t\t\t\tret = def_to_user(cs->controls + idx, ref->ctrl);\n-\t\t\telse if (is_request && ref->p_req_dyn_enomem)\n+\t\t\telse if (is_request && ref->p_req_array_enomem)\n \t\t\t\tret = -ENOMEM;\n \t\t\telse if (is_request && ref->p_req_valid)\n \t\t\t\tret = req_to_user(cs->controls + idx, ref);\ndiff --git a/drivers/media/v4l2-core/v4l2-ctrls-core.c b/drivers/media/v4l2-core/v4l2-ctrls-core.c\nindex 9871c77f559b..a004fea10da2 100644\n--- a/drivers/media/v4l2-core/v4l2-ctrls-core.c\n+++ b/drivers/media/v4l2-core/v4l2-ctrls-core.c\n@@ -1048,23 +1048,26 @@ void cur_to_new(struct v4l2_ctrl *ctrl)\n \tptr_to_ptr(ctrl, ctrl->p_cur, ctrl->p_new, ctrl->new_elems);\n }\n \n-static bool req_alloc_dyn_array(struct v4l2_ctrl_ref *ref, u32 elems)\n+static bool req_alloc_array(struct v4l2_ctrl_ref *ref, u32 elems)\n {\n \tvoid *tmp;\n \n-\tif (elems < ref->p_req_dyn_alloc_elems)\n+\tif (elems == ref->p_req_array_alloc_elems)\n+\t\treturn true;\n+\tif (ref->ctrl->is_dyn_array &&\n+\t    elems < ref->p_req_array_alloc_elems)\n \t\treturn true;\n \n \ttmp = kvmalloc(elems * ref->ctrl->elem_size, GFP_KERNEL);\n \n \tif (!tmp) {\n-\t\tref->p_req_dyn_enomem = true;\n+\t\tref->p_req_array_enomem = true;\n \t\treturn false;\n \t}\n-\tref->p_req_dyn_enomem = false;\n+\tref->p_req_array_enomem = false;\n \tkvfree(ref->p_req.p);\n \tref->p_req.p = tmp;\n-\tref->p_req_dyn_alloc_elems = elems;\n+\tref->p_req_array_alloc_elems = elems;\n \treturn true;\n }\n \n@@ -1077,7 +1080,7 @@ void new_to_req(struct v4l2_ctrl_ref *ref)\n \t\treturn;\n \n \tctrl = ref->ctrl;\n-\tif (ctrl->is_dyn_array && !req_alloc_dyn_array(ref, ctrl->new_elems))\n+\tif (ctrl->is_array && !req_alloc_array(ref, ctrl->new_elems))\n \t\treturn;\n \n \tref->p_req_elems = ctrl->new_elems;\n@@ -1094,7 +1097,7 @@ void cur_to_req(struct v4l2_ctrl_ref *ref)\n \t\treturn;\n \n \tctrl = ref->ctrl;\n-\tif (ctrl->is_dyn_array && !req_alloc_dyn_array(ref, ctrl->elems))\n+\tif (ctrl->is_array && !req_alloc_array(ref, ctrl->elems))\n \t\treturn;\n \n \tref->p_req_elems = ctrl->elems;\n@@ -1123,14 +1126,18 @@ int req_to_new(struct v4l2_ctrl_ref *ref)\n \t\treturn 0;\n \t}\n \n-\t/* Not a dynamic array, so just copy the request value */\n-\tif (!ctrl->is_dyn_array) {\n+\t/* Not an array, so just copy the request value */\n+\tif (!ctrl->is_array) {\n \t\tptr_to_ptr(ctrl, ref->p_req, ctrl->p_new, ctrl->new_elems);\n \t\treturn 0;\n \t}\n \n \t/* Sanity check, should never happen */\n-\tif (WARN_ON(!ref->p_req_dyn_alloc_elems))\n+\tif (WARN_ON(!ref->p_req_array_alloc_elems))\n+\t\treturn -ENOMEM;\n+\n+\tif (!ctrl->is_dyn_array &&\n+\t    ref->p_req_elems != ctrl->p_array_alloc_elems)\n \t\treturn -ENOMEM;\n \n \t/*\n@@ -1243,7 +1250,7 @@ void v4l2_ctrl_handler_free(struct v4l2_ctrl_handler *hdl)\n \t/* Free all nodes */\n \tlist_for_each_entry_safe(ref, next_ref, &hdl->ctrl_refs, node) {\n \t\tlist_del(&ref->node);\n-\t\tif (ref->p_req_dyn_alloc_elems)\n+\t\tif (ref->p_req_array_alloc_elems)\n \t\t\tkvfree(ref->p_req.p);\n \t\tkfree(ref);\n \t}\n@@ -1368,7 +1375,7 @@ int handler_new_ref(struct v4l2_ctrl_handler *hdl,\n \tif (hdl->error)\n \t\treturn hdl->error;\n \n-\tif (allocate_req && !ctrl->is_dyn_array)\n+\tif (allocate_req && !ctrl->is_array)\n \t\tsize_extra_req = ctrl->elems * ctrl->elem_size;\n \tnew_ref = kzalloc(sizeof(*new_ref) + size_extra_req, GFP_KERNEL);\n \tif (!new_ref)\ndiff --git a/include/media/v4l2-ctrls.h b/include/media/v4l2-ctrls.h\nindex 5ddd506ae7b9..c7a082c319d4 100644\n--- a/include/media/v4l2-ctrls.h\n+++ b/include/media/v4l2-ctrls.h\n@@ -318,15 +318,15 @@ struct v4l2_ctrl {\n  *\t\tfrom a cluster with multiple controls twice (when the first\n  *\t\tcontrol of a cluster is applied, they all are).\n  * @p_req_valid: If set, then p_req contains the control value for the request.\n- * @p_req_dyn_enomem: If set, then p_req is invalid since allocating space for\n- *\t\ta dynamic array failed. Attempting to read this value shall\n- *\t\tresult in ENOMEM. Only valid if ctrl->is_dyn_array is true.\n- * @p_req_dyn_alloc_elems: The number of elements allocated for the dynamic\n- *\t\tarray. Only valid if @p_req_valid and ctrl->is_dyn_array are\n+ * @p_req_array_enomem: If set, then p_req is invalid since allocating space for\n+ *\t\tan array failed. Attempting to read this value shall\n+ *\t\tresult in ENOMEM. Only valid if ctrl->is_array is true.\n+ * @p_req_array_alloc_elems: The number of elements allocated for the\n+ *\t\tarray. Only valid if @p_req_valid and ctrl->is_array are\n  *\t\ttrue.\n  * @p_req_elems: The number of elements in @p_req. This is the same as\n  *\t\tctrl->elems, except for dynamic arrays. In that case it is in\n- *\t\tthe range of 1 to @p_req_dyn_alloc_elems. Only valid if\n+ *\t\tthe range of 1 to @p_req_array_alloc_elems. Only valid if\n  *\t\t@p_req_valid is true.\n  * @p_req:\tIf the control handler containing this control reference\n  *\t\tis bound to a media request, then this points to the\n@@ -348,8 +348,8 @@ struct v4l2_ctrl_ref {\n \tbool from_other_dev;\n \tbool req_done;\n \tbool p_req_valid;\n-\tbool p_req_dyn_enomem;\n-\tu32 p_req_dyn_alloc_elems;\n+\tbool p_req_array_enomem;\n+\tu32 p_req_array_alloc_elems;\n \tu32 p_req_elems;\n \tunion v4l2_ctrl_ptr p_req;\n };\n", "stats": " drivers/media/v4l2-core/v4l2-ctrls-api.c  |  2 +-\n drivers/media/v4l2-core/v4l2-ctrls-core.c | 31 +++++++++++++++++++------------\n include/media/v4l2-ctrls.h                | 16 ++++++++--------\n 3 files changed, 28 insertions(+), 21 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "7392d87a9febb5f46f28d4704eb5636c5e22cdeb"}, "tag": "linux", "timestamp": 1699830728.693828, "updated_on": 1660909620.0, "uuid": "704446a9ee30425860d355d50f6d8dd9813c57b8"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Luiz Augusto von Dentz <luiz.von.dentz@intel.com>", "AuthorDate": "Wed Jan 26 17:21:00 2022 -0800", "Commit": "Marcel Holtmann <marcel@holtmann.org>", "CommitDate": "Thu Jan 27 17:40:18 2022 +0100", "Signed-off-by": ["Luiz Augusto von Dentz <luiz.von.dentz@intel.com>", "Marcel Holtmann <marcel@holtmann.org>"], "commit": "0b94f2651f56b9e4aa5f012b0d7eb57308c773cf", "files": [{"action": "M", "added": "3", "file": "net/bluetooth/hci_sync.c", "indexes": ["2fe8c60dc62b", "6e71aa6b6fea"], "modes": ["100644", "100644"], "removed": "0"}], "message": "Bluetooth: hci_sync: Fix queuing commands when HCI_UNREGISTER is set\n\nhci_cmd_sync_queue shall return an error if HCI_UNREGISTER flag has\nbeen set as that means hci_unregister_dev has been called so it will\nlikely cause a uaf after the timeout as the hdev will be freed.\n\nSigned-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>\nSigned-off-by: Marcel Holtmann <marcel@holtmann.org>", "parents": ["adce573b927adf827f2f8627f05c2ba90031ebc9"], "refs": [], "diff": "diff --git a/net/bluetooth/hci_sync.c b/net/bluetooth/hci_sync.c\nindex 2fe8c60dc62b..6e71aa6b6fea 100644\n--- a/net/bluetooth/hci_sync.c\n+++ b/net/bluetooth/hci_sync.c\n@@ -382,6 +382,9 @@ int hci_cmd_sync_queue(struct hci_dev *hdev, hci_cmd_sync_work_func_t func,\n {\n \tstruct hci_cmd_sync_work_entry *entry;\n \n+\tif (hci_dev_test_flag(hdev, HCI_UNREGISTER))\n+\t\treturn -ENODEV;\n+\n \tentry = kmalloc(sizeof(*entry), GFP_KERNEL);\n \tif (!entry)\n \t\treturn -ENOMEM;\n", "stats": " net/bluetooth/hci_sync.c | 3 +++\n 1 file changed, 3 insertions(+)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "0b94f2651f56b9e4aa5f012b0d7eb57308c773cf"}, "tag": "linux", "timestamp": 1699830121.377113, "updated_on": 1643301618.0, "uuid": "936545d4197e6ba43059f43b62a097c9afb3e071"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Hannes Reinecke <hare@suse.de>", "AuthorDate": "Tue Dec 21 08:20:46 2021 +0100", "Commit": "Damien Le Moal <damien.lemoal@opensource.wdc.com>", "CommitDate": "Wed Jan 5 19:33:01 2022 +0900", "Signed-off-by": ["Hannes Reinecke <hare@suse.de>", "Damien Le Moal <damien.lemoal@opensource.wdc.com>"], "commit": "e1553351d747cbcd62db01d579dff916edcc782c", "files": [{"action": "M", "added": "0", "file": "drivers/ata/libata-core.c", "indexes": ["c9552606b015", "447a46bdc820"], "modes": ["100644", "100644"], "removed": "3"}, {"action": "M", "added": "0", "file": "drivers/ata/libata-sata.c", "indexes": ["d9b5744a3b06", "bfe9595d4f33"], "modes": ["100644", "100644"], "removed": "2"}, {"action": "M", "added": "0", "file": "drivers/ata/libata-scsi.c", "indexes": ["bfbb4cca4c17", "11fb046e3035"], "modes": ["100644", "100644"], "removed": "42"}, {"action": "M", "added": "0", "file": "drivers/ata/libata-sff.c", "indexes": ["b544bdc6d0a3", "d5dbeb68b2bf"], "modes": ["100644", "100644"], "removed": "4"}, {"action": "M", "added": "0", "file": "drivers/ata/libata.h", "indexes": ["2144065e762c", "51e01acdd241"], "modes": ["100644", "100644"], "removed": "1"}], "message": "ata: libata: remove pointless VPRINTK() calls\n\nMost of the information is already covered by tracepoints\n(if not downright pointless), so remove the VPRINTK() calls.\nAnd while we're at it, remove ata_scsi_dump_cdb(), too,\nas this information can be retrieved from scsi tracing.\n\nSigned-off-by: Hannes Reinecke <hare@suse.de>\nSigned-off-by: Damien Le Moal <damien.lemoal@opensource.wdc.com>", "parents": ["b5a5fc8b0f8175e4b3aaf182c1b23de4ccdd3347"], "refs": [], "diff": "diff --git a/drivers/ata/libata-core.c b/drivers/ata/libata-core.c\nindex c9552606b015..447a46bdc820 100644\n--- a/drivers/ata/libata-core.c\n+++ b/drivers/ata/libata-core.c\n@@ -4503,8 +4503,6 @@ static void ata_sg_clean(struct ata_queued_cmd *qc)\n \n \tWARN_ON_ONCE(sg == NULL);\n \n-\tVPRINTK(\"unmapping %u sg elements\\n\", qc->n_elem);\n-\n \tif (qc->n_elem)\n \t\tdma_unmap_sg(ap->dev, sg, qc->orig_n_elem, dir);\n \n@@ -4534,7 +4532,6 @@ static int ata_sg_setup(struct ata_queued_cmd *qc)\n \tif (n_elem < 1)\n \t\treturn -1;\n \n-\tVPRINTK(\"%d sg elements mapped\\n\", n_elem);\n \tqc->orig_n_elem = qc->n_elem;\n \tqc->n_elem = n_elem;\n \tqc->flags |= ATA_QCFLAG_DMAMAP;\ndiff --git a/drivers/ata/libata-sata.c b/drivers/ata/libata-sata.c\nindex d9b5744a3b06..bfe9595d4f33 100644\n--- a/drivers/ata/libata-sata.c\n+++ b/drivers/ata/libata-sata.c\n@@ -1258,8 +1258,6 @@ int ata_sas_queuecmd(struct scsi_cmnd *cmd, struct ata_port *ap)\n {\n \tint rc = 0;\n \n-\tata_scsi_dump_cdb(ap, cmd);\n-\n \tif (likely(ata_dev_enabled(ap->link.device)))\n \t\trc = __ata_scsi_queuecmd(cmd, ap->link.device);\n \telse {\ndiff --git a/drivers/ata/libata-scsi.c b/drivers/ata/libata-scsi.c\nindex bfbb4cca4c17..11fb046e3035 100644\n--- a/drivers/ata/libata-scsi.c\n+++ b/drivers/ata/libata-scsi.c\n@@ -1299,8 +1299,6 @@ static void scsi_6_lba_len(const u8 *cdb, u64 *plba, u32 *plen)\n \tu64 lba = 0;\n \tu32 len;\n \n-\tVPRINTK(\"six-byte command\\n\");\n-\n \tlba |= ((u64)(cdb[1] & 0x1f)) << 16;\n \tlba |= ((u64)cdb[2]) << 8;\n \tlba |= ((u64)cdb[3]);\n@@ -1326,8 +1324,6 @@ static void scsi_10_lba_len(const u8 *cdb, u64 *plba, u32 *plen)\n \tu64 lba = 0;\n \tu32 len = 0;\n \n-\tVPRINTK(\"ten-byte command\\n\");\n-\n \tlba |= ((u64)cdb[2]) << 24;\n \tlba |= ((u64)cdb[3]) << 16;\n \tlba |= ((u64)cdb[4]) << 8;\n@@ -1355,8 +1351,6 @@ static void scsi_16_lba_len(const u8 *cdb, u64 *plba, u32 *plen)\n \tu64 lba = 0;\n \tu32 len = 0;\n \n-\tVPRINTK(\"sixteen-byte command\\n\");\n-\n \tlba |= ((u64)cdb[2]) << 56;\n \tlba |= ((u64)cdb[3]) << 48;\n \tlba |= ((u64)cdb[4]) << 40;\n@@ -1706,8 +1700,6 @@ static int ata_scsi_translate(struct ata_device *dev, struct scsi_cmnd *cmd,\n \tstruct ata_queued_cmd *qc;\n \tint rc;\n \n-\tVPRINTK(\"ENTER\\n\");\n-\n \tqc = ata_scsi_qc_new(dev, cmd);\n \tif (!qc)\n \t\tgoto err_mem;\n@@ -1738,7 +1730,6 @@ static int ata_scsi_translate(struct ata_device *dev, struct scsi_cmnd *cmd,\n \t/* select device, send command to hardware */\n \tata_qc_issue(qc);\n \n-\tVPRINTK(\"EXIT\\n\");\n \treturn 0;\n \n early_finish:\n@@ -1851,8 +1842,6 @@ static unsigned int ata_scsiop_inq_std(struct ata_scsi_args *args, u8 *rbuf)\n \t\t2\n \t};\n \n-\tVPRINTK(\"ENTER\\n\");\n-\n \t/* set scsi removable (RMB) bit per ata bit, or if the\n \t * AHCI port says it's external (Hotplug-capable, eSATA).\n \t */\n@@ -2287,8 +2276,6 @@ static unsigned int ata_scsiop_mode_sense(struct ata_scsi_args *args, u8 *rbuf)\n \tu8 dpofua, bp = 0xff;\n \tu16 fp;\n \n-\tVPRINTK(\"ENTER\\n\");\n-\n \tsix_byte = (scsicmd[0] == MODE_SENSE);\n \tebd = !(scsicmd[1] & 0x8);      /* dbd bit inverted == edb */\n \t/*\n@@ -2406,8 +2393,6 @@ static unsigned int ata_scsiop_read_cap(struct ata_scsi_args *args, u8 *rbuf)\n \tlog2_per_phys = ata_id_log2_per_physical_sector(dev->id);\n \tlowest_aligned = ata_id_logical_sector_offset(dev->id, log2_per_phys);\n \n-\tVPRINTK(\"ENTER\\n\");\n-\n \tif (args->cmd->cmnd[0] == READ_CAPACITY) {\n \t\tif (last_lba >= 0xffffffffULL)\n \t\t\tlast_lba = 0xffffffff;\n@@ -2474,7 +2459,6 @@ static unsigned int ata_scsiop_read_cap(struct ata_scsi_args *args, u8 *rbuf)\n  */\n static unsigned int ata_scsiop_report_luns(struct ata_scsi_args *args, u8 *rbuf)\n {\n-\tVPRINTK(\"ENTER\\n\");\n \trbuf[3] = 8;\t/* just one lun, LUN 0, size 8 bytes */\n \n \treturn 0;\n@@ -2570,8 +2554,6 @@ static void atapi_qc_complete(struct ata_queued_cmd *qc)\n \tstruct scsi_cmnd *cmd = qc->scsicmd;\n \tunsigned int err_mask = qc->err_mask;\n \n-\tVPRINTK(\"ENTER, err_mask 0x%X\\n\", err_mask);\n-\n \t/* handle completion from new EH */\n \tif (unlikely(qc->ap->ops->error_handler &&\n \t\t     (err_mask || qc->flags & ATA_QCFLAG_SENSE_VALID))) {\n@@ -3680,8 +3662,6 @@ static unsigned int ata_scsi_mode_select_xlat(struct ata_queued_cmd *qc)\n \tu8 buffer[64];\n \tconst u8 *p = buffer;\n \n-\tVPRINTK(\"ENTER\\n\");\n-\n \tsix_byte = (cdb[0] == MODE_SELECT);\n \tif (six_byte) {\n \t\tif (scmd->cmd_len < 5) {\n@@ -3979,26 +3959,6 @@ static inline ata_xlat_func_t ata_get_xlat_func(struct ata_device *dev, u8 cmd)\n \treturn NULL;\n }\n \n-/**\n- *\tata_scsi_dump_cdb - dump SCSI command contents to dmesg\n- *\t@ap: ATA port to which the command was being sent\n- *\t@cmd: SCSI command to dump\n- *\n- *\tPrints the contents of a SCSI command via printk().\n- */\n-\n-void ata_scsi_dump_cdb(struct ata_port *ap, struct scsi_cmnd *cmd)\n-{\n-#ifdef ATA_VERBOSE_DEBUG\n-\tstruct scsi_device *scsidev = cmd->device;\n-\n-\tVPRINTK(\"CDB (%u:%d,%d,%lld) %9ph\\n\",\n-\t\tap->print_id,\n-\t\tscsidev->channel, scsidev->id, scsidev->lun,\n-\t\tcmd->cmnd);\n-#endif\n-}\n-\n int __ata_scsi_queuecmd(struct scsi_cmnd *scmd, struct ata_device *dev)\n {\n \tu8 scsi_op = scmd->cmnd[0];\n@@ -4077,8 +4037,6 @@ int ata_scsi_queuecmd(struct Scsi_Host *shost, struct scsi_cmnd *cmd)\n \n \tspin_lock_irqsave(ap->lock, irq_flags);\n \n-\tata_scsi_dump_cdb(ap, cmd);\n-\n \tdev = ata_scsi_find_dev(ap, scsidev);\n \tif (likely(dev))\n \t\trc = __ata_scsi_queuecmd(cmd, dev);\ndiff --git a/drivers/ata/libata-sff.c b/drivers/ata/libata-sff.c\nindex b544bdc6d0a3..d5dbeb68b2bf 100644\n--- a/drivers/ata/libata-sff.c\n+++ b/drivers/ata/libata-sff.c\n@@ -877,8 +877,6 @@ static void atapi_pio_bytes(struct ata_queued_cmd *qc)\n \tif (unlikely(!bytes))\n \t\tgoto atapi_check;\n \n-\tVPRINTK(\"ata%u: xfering %d bytes\\n\", ap->print_id, bytes);\n-\n \tif (unlikely(__atapi_pio_bytes(qc, bytes)))\n \t\tgoto err_out;\n \tata_sff_sync(ap); /* flush */\n@@ -2586,7 +2584,6 @@ static void ata_bmdma_fill_sg(struct ata_queued_cmd *qc)\n \n \t\t\tprd[pi].addr = cpu_to_le32(addr);\n \t\t\tprd[pi].flags_len = cpu_to_le32(len & 0xffff);\n-\t\t\tVPRINTK(\"PRD[%u] = (0x%X, 0x%X)\\n\", pi, addr, len);\n \n \t\t\tpi++;\n \t\t\tsg_len -= len;\n@@ -2646,7 +2643,6 @@ static void ata_bmdma_fill_sg_dumb(struct ata_queued_cmd *qc)\n \t\t\t\tprd[++pi].addr = cpu_to_le32(addr + 0x8000);\n \t\t\t}\n \t\t\tprd[pi].flags_len = cpu_to_le32(blen);\n-\t\t\tVPRINTK(\"PRD[%u] = (0x%X, 0x%X)\\n\", pi, addr, len);\n \n \t\t\tpi++;\n \t\t\tsg_len -= len;\ndiff --git a/drivers/ata/libata.h b/drivers/ata/libata.h\nindex 2144065e762c..51e01acdd241 100644\n--- a/drivers/ata/libata.h\n+++ b/drivers/ata/libata.h\n@@ -148,7 +148,6 @@ extern int ata_scsi_user_scan(struct Scsi_Host *shost, unsigned int channel,\n \t\t\t      unsigned int id, u64 lun);\n void ata_scsi_sdev_config(struct scsi_device *sdev);\n int ata_scsi_dev_config(struct scsi_device *sdev, struct ata_device *dev);\n-void ata_scsi_dump_cdb(struct ata_port *ap, struct scsi_cmnd *cmd);\n int __ata_scsi_queuecmd(struct scsi_cmnd *scmd, struct ata_device *dev);\n \n /* libata-eh.c */\n", "stats": " drivers/ata/libata-core.c |  3 ---\n drivers/ata/libata-sata.c |  2 --\n drivers/ata/libata-scsi.c | 42 ------------------------------------------\n drivers/ata/libata-sff.c  |  4 ----\n drivers/ata/libata.h      |  1 -\n 5 files changed, 52 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "e1553351d747cbcd62db01d579dff916edcc782c"}, "tag": "linux", "timestamp": 1699830012.911875, "updated_on": 1641378781.0, "uuid": "7ccfd6610eb2918e5d7570e6ccde71cc837ebf6c"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Stanislaw Gruszka <stf_xl@wp.pl>", "AuthorDate": "Thu Oct 27 15:43:34 2022 +0200", "Commit": "Andrew Morton <akpm@linux-foundation.org>", "CommitDate": "Fri Nov 18 13:55:08 2022 -0800", "Signed-off-by": ["Stanislaw Gruszka <stf_xl@wp.pl>", "Andrew Morton <akpm@linux-foundation.org>"], "commit": "dc3f4dee81cd85b039d07b8d75cfbae4668a15d2", "files": [{"action": "M", "added": "1", "file": "scripts/checkpatch.pl", "indexes": ["bd1b9d7a1647", "29517897baa1"], "modes": ["100755", "100755"], "removed": "0"}], "message": "scripts: checkpatch: allow \"case\" macros\n\nDo not report errors like below:\n\n./scripts/checkpatch.pl -f drivers/net/wireless/ath/ath10k/wmi.h\n\nERROR: Macros with complex values should be enclosed in parentheses\n+#define C2S(x) case x: return #x\n\nsince many \"case ...\" macros are already used by some in-kernel drivers.\n\nLink: https://lkml.kernel.org/r/20221027134334.164301-1-stf_xl@wp.pl\nSigned-off-by: Stanislaw Gruszka <stf_xl@wp.pl>\nAcked-by: Joe Perches <joe@perches.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>", "parents": ["5cc81d5c81af0dee54da9a67a3ebe4be076a13db"], "refs": [], "diff": "diff --git a/scripts/checkpatch.pl b/scripts/checkpatch.pl\nindex bd1b9d7a1647..29517897baa1 100755\n--- a/scripts/checkpatch.pl\n+++ b/scripts/checkpatch.pl\n@@ -5918,6 +5918,7 @@ sub process {\n \t\t\t    $dstat !~ /$exceptions/ &&\n \t\t\t    $dstat !~ /^\\.$Ident\\s*=/ &&\t\t\t\t# .foo =\n \t\t\t    $dstat !~ /^(?:\\#\\s*$Ident|\\#\\s*$Constant)\\s*$/ &&\t\t# stringification #foo\n+\t\t\t    $dstat !~ /^case\\b/ &&\t\t\t\t\t# case ...\n \t\t\t    $dstat !~ /^do\\s*$Constant\\s*while\\s*$Constant;?$/ &&\t# do {...} while (...); // do {...} while (...)\n \t\t\t    $dstat !~ /^while\\s*$Constant\\s*$Constant\\s*$/ &&\t\t# while (...) {...}\n \t\t\t    $dstat !~ /^for\\s*$Constant$/ &&\t\t\t\t# for (...)\n", "stats": " scripts/checkpatch.pl | 1 +\n 1 file changed, 1 insertion(+)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "dc3f4dee81cd85b039d07b8d75cfbae4668a15d2"}, "tag": "linux", "timestamp": 1699830895.902597, "updated_on": 1668808508.0, "uuid": "e9ba7494c9aefe008d67783bc82e69ea53180ed1"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Jakub Kicinski <kuba@kernel.org>", "AuthorDate": "Fri May 20 12:43:14 2022 -0700", "Commit": "Jakub Kicinski <kuba@kernel.org>", "CommitDate": "Sun May 22 17:23:05 2022 -0700", "Signed-off-by": ["Jakub Kicinski <kuba@kernel.org>"], "commit": "e95032988053c17baf6c7e27024f5103a19a5f4a", "files": [{"action": "M", "added": "5", "file": "drivers/net/wireless/ath/ath9k/Makefile", "indexes": ["eff94bcd1f0a", "9bdfcee2f448"], "modes": ["100644", "100644"], "removed": "0"}], "message": "wifi: ath9k: silence array-bounds warning on GCC 12\n\nGCC 12 says:\n\ndrivers/net/wireless/ath/ath9k/mac.c: In function \u2018ath9k_hw_resettxqueue\u2019:\ndrivers/net/wireless/ath/ath9k/mac.c:373:22: warning: array subscript 32 is above array bounds of \u2018struct ath9k_tx_queue_info[10]\u2019 [-Warray-bounds]\n  373 |         qi = &ah->txq[q];\n      |               ~~~~~~~^~~\n\nI don't know where it got the 32 from, relegate the warning to W=1+.\n\nAcked-by: Kalle Valo <kvalo@kernel.org>\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>", "parents": ["0c7ab953d1f2358cce5bcddf96877b16966bbabc"], "refs": [], "diff": "diff --git a/drivers/net/wireless/ath/ath9k/Makefile b/drivers/net/wireless/ath/ath9k/Makefile\nindex eff94bcd1f0a..9bdfcee2f448 100644\n--- a/drivers/net/wireless/ath/ath9k/Makefile\n+++ b/drivers/net/wireless/ath/ath9k/Makefile\n@@ -45,6 +45,11 @@ ath9k_hw-y:=\t\\\n \t\tar9003_eeprom.o \\\n \t\tar9003_paprd.o\n \n+# FIXME: temporarily silence -Warray-bounds on non W=1+ builds\n+ifndef KBUILD_EXTRA_WARN\n+CFLAGS_mac.o += -Wno-array-bounds\n+endif\n+\n ath9k_hw-$(CONFIG_ATH9K_WOW) += ar9003_wow.o\n \n ath9k_hw-$(CONFIG_ATH9K_BTCOEX_SUPPORT) += btcoex.o \\\n", "stats": " drivers/net/wireless/ath/ath9k/Makefile | 5 +++++\n 1 file changed, 5 insertions(+)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "e95032988053c17baf6c7e27024f5103a19a5f4a"}, "tag": "linux", "timestamp": 1699830313.229594, "updated_on": 1653265385.0, "uuid": "cb890b80fb825d7ad039ed770386cb47c80a68dc"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Linu Cherian <lcherian@marvell.com>", "AuthorDate": "Mon May 9 10:02:21 2022 +0530", "Commit": "Catalin Marinas <catalin.marinas@arm.com>", "CommitDate": "Wed May 11 13:40:26 2022 +0100", "Signed-off-by": ["Linu Cherian <lcherian@marvell.com>", "Catalin Marinas <catalin.marinas@arm.com>"], "commit": "710c8d6c026c0bbbd5d9036ef210e263edeb07d3", "files": [{"action": "M", "added": "1", "file": "arch/arm64/kernel/cpu_errata.c", "indexes": ["4c9b5b4b7a0b", "49f4863c6c56"], "modes": ["100644", "100644"], "removed": "1"}], "message": "arm64: Declare non global symbols as static\n\nFix below sparse warnings introduced while adding errata.\n\narch/arm64/kernel/cpu_errata.c:218:25: sparse: warning: symbol\n'cavium_erratum_23154_cpus' was not declared. Should it be static?\n\nReported-by: kernel test robot <lkp@intel.com>\nSigned-off-by: Linu Cherian <lcherian@marvell.com>\nAcked-by: Will Deacon <will@kernel.org>\nLink: https://lore.kernel.org/r/20220509043221.16361-1-lcherian@marvell.com\nSigned-off-by: Catalin Marinas <catalin.marinas@arm.com>", "parents": ["f41ef4c2ee99d255c82d8ac6f720f28116340869"], "refs": [], "diff": "diff --git a/arch/arm64/kernel/cpu_errata.c b/arch/arm64/kernel/cpu_errata.c\nindex 4c9b5b4b7a0b..49f4863c6c56 100644\n--- a/arch/arm64/kernel/cpu_errata.c\n+++ b/arch/arm64/kernel/cpu_errata.c\n@@ -215,7 +215,7 @@ static const struct arm64_cpu_capabilities arm64_repeat_tlbi_list[] = {\n #endif\n \n #ifdef CONFIG_CAVIUM_ERRATUM_23154\n-const struct midr_range cavium_erratum_23154_cpus[] = {\n+static const struct midr_range cavium_erratum_23154_cpus[] = {\n \tMIDR_ALL_VERSIONS(MIDR_THUNDERX),\n \tMIDR_ALL_VERSIONS(MIDR_THUNDERX_81XX),\n \tMIDR_ALL_VERSIONS(MIDR_THUNDERX_83XX),\n", "stats": " arch/arm64/kernel/cpu_errata.c | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "710c8d6c026c0bbbd5d9036ef210e263edeb07d3"}, "tag": "linux", "timestamp": 1699830255.329126, "updated_on": 1652272826.0, "uuid": "09385fd802df4d4bc597a7ad7a0c3dc240aa2f9a"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Sasha Neftin <sasha.neftin@intel.com>", "AuthorDate": "Tue Mar 1 15:32:10 2022 +0200", "Commit": "Tony Nguyen <anthony.l.nguyen@intel.com>", "CommitDate": "Wed Apr 13 07:58:32 2022 -0700", "Signed-off-by": ["Sasha Neftin <sasha.neftin@intel.com>", "Tony Nguyen <anthony.l.nguyen@intel.com>"], "commit": "907862e9aef75bf89e2b265efcc58870be06081e", "files": [{"action": "M", "added": "9", "file": "drivers/net/ethernet/intel/igc/igc_i225.c", "indexes": ["66ea566488d1", "59d5c467ea6e"], "modes": ["100644", "100644"], "removed": "2"}], "message": "igc: Fix infinite loop in release_swfw_sync\n\nAn infinite loop may occur if we fail to acquire the HW semaphore,\nwhich is needed for resource release.\nThis will typically happen if the hardware is surprise-removed.\nAt this stage there is nothing to do, except log an error and quit.\n\nFixes: c0071c7aa5fe (\"igc: Add HW initialization code\")\nSuggested-by: Dima Ruinskiy <dima.ruinskiy@intel.com>\nSigned-off-by: Sasha Neftin <sasha.neftin@intel.com>\nTested-by: Naama Meir <naamax.meir@linux.intel.com>\nSigned-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>", "parents": ["ef27324e2cb7bb24542d6cb2571740eefe6b00dc"], "refs": [], "diff": "diff --git a/drivers/net/ethernet/intel/igc/igc_i225.c b/drivers/net/ethernet/intel/igc/igc_i225.c\nindex 66ea566488d1..59d5c467ea6e 100644\n--- a/drivers/net/ethernet/intel/igc/igc_i225.c\n+++ b/drivers/net/ethernet/intel/igc/igc_i225.c\n@@ -156,8 +156,15 @@ void igc_release_swfw_sync_i225(struct igc_hw *hw, u16 mask)\n {\n \tu32 swfw_sync;\n \n-\twhile (igc_get_hw_semaphore_i225(hw))\n-\t\t; /* Empty */\n+\t/* Releasing the resource requires first getting the HW semaphore.\n+\t * If we fail to get the semaphore, there is nothing we can do,\n+\t * except log an error and quit. We are not allowed to hang here\n+\t * indefinitely, as it may cause denial of service or system crash.\n+\t */\n+\tif (igc_get_hw_semaphore_i225(hw)) {\n+\t\thw_dbg(\"Failed to release SW_FW_SYNC.\\n\");\n+\t\treturn;\n+\t}\n \n \tswfw_sync = rd32(IGC_SW_FW_SYNC);\n \tswfw_sync &= ~mask;\n", "stats": " drivers/net/ethernet/intel/igc/igc_i225.c | 11 +++++++++--\n 1 file changed, 9 insertions(+), 2 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "907862e9aef75bf89e2b265efcc58870be06081e"}, "tag": "linux", "timestamp": 1699830226.644804, "updated_on": 1649861912.0, "uuid": "693a81d2dbe02bd3205b744d50dfe9504fe10bdf"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Wojciech Drewek <wojciech.drewek@intel.com>", "AuthorDate": "Fri Mar 4 17:40:43 2022 +0100", "Commit": "Tony Nguyen <anthony.l.nguyen@intel.com>", "CommitDate": "Fri Mar 11 08:27:16 2022 -0800", "Signed-off-by": ["Wojciech Drewek <wojciech.drewek@intel.com>", "Tony Nguyen <anthony.l.nguyen@intel.com>"], "commit": "9af41cc33471ea1efa6f77e188f055cc77d0a5c5", "files": [{"action": "M", "added": "197", "file": "drivers/net/gtp.c", "indexes": ["25d8521897b3", "bf434d79f868"], "modes": ["100644", "100644"], "removed": "16"}, {"action": "M", "added": "31", "file": "include/net/gtp.h", "indexes": ["0e16ebb2a82d", "0e12c37f2958"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "1", "file": "include/uapi/linux/if_link.h", "indexes": ["ebd2aa3ef809", "bd24c7dc10a2"], "modes": ["100644", "100644"], "removed": "0"}], "message": "gtp: Implement GTP echo response\n\nAdding GTP device through ip link creates the situation where\nthere is no userspace daemon which would handle GTP messages\n(Echo Request for example). GTP-U instance which would not respond\nto echo requests would violate GTP specification.\n\nWhen GTP packet arrives with GTP_ECHO_REQ message type,\nGTP_ECHO_RSP is send to the sender. GTP_ECHO_RSP message\nshould contain information element with GTPIE_RECOVERY tag and\nrestart counter value. For GTPv1 restart counter is not used\nand should be equal to 0, for GTPv0 restart counter contains\ninformation provided from userspace(IFLA_GTP_RESTART_COUNT).\n\nSigned-off-by: Wojciech Drewek <wojciech.drewek@intel.com>\nSuggested-by: Harald Welte <laforge@gnumonks.org>\nReviewed-by: Harald Welte <laforge@gnumonks.org>\nTested-by: Harald Welte <laforge@gnumonks.org>\nSigned-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>", "parents": ["b20dc3c684580ddc07eb48ee3c3dc7597cd5eebf"], "refs": [], "diff": "diff --git a/drivers/net/gtp.c b/drivers/net/gtp.c\nindex 25d8521897b3..bf434d79f868 100644\n--- a/drivers/net/gtp.c\n+++ b/drivers/net/gtp.c\n@@ -75,6 +75,8 @@ struct gtp_dev {\n \tunsigned int\t\thash_size;\n \tstruct hlist_head\t*tid_hash;\n \tstruct hlist_head\t*addr_hash;\n+\n+\tu8\t\t\trestart_count;\n };\n \n static unsigned int gtp_net_id __read_mostly;\n@@ -217,6 +219,106 @@ static int gtp_rx(struct pdp_ctx *pctx, struct sk_buff *skb,\n \treturn -1;\n }\n \n+static struct rtable *ip4_route_output_gtp(struct flowi4 *fl4,\n+\t\t\t\t\t   const struct sock *sk,\n+\t\t\t\t\t   __be32 daddr, __be32 saddr)\n+{\n+\tmemset(fl4, 0, sizeof(*fl4));\n+\tfl4->flowi4_oif\t\t= sk->sk_bound_dev_if;\n+\tfl4->daddr\t\t= daddr;\n+\tfl4->saddr\t\t= saddr;\n+\tfl4->flowi4_tos\t\t= RT_CONN_FLAGS(sk);\n+\tfl4->flowi4_proto\t= sk->sk_protocol;\n+\n+\treturn ip_route_output_key(sock_net(sk), fl4);\n+}\n+\n+/* GSM TS 09.60. 7.3\n+ * In all Path Management messages:\n+ * - TID: is not used and shall be set to 0.\n+ * - Flow Label is not used and shall be set to 0\n+ * In signalling messages:\n+ * - number: this field is not yet used in signalling messages.\n+ *   It shall be set to 255 by the sender and shall be ignored\n+ *   by the receiver\n+ * Returns true if the echo req was correct, false otherwise.\n+ */\n+static bool gtp0_validate_echo_req(struct gtp0_header *gtp0)\n+{\n+\treturn !(gtp0->tid || (gtp0->flags ^ 0x1e) ||\n+\t\tgtp0->number != 0xff || gtp0->flow);\n+}\n+\n+static int gtp0_send_echo_resp(struct gtp_dev *gtp, struct sk_buff *skb)\n+{\n+\tstruct gtp0_packet *gtp_pkt;\n+\tstruct gtp0_header *gtp0;\n+\tstruct rtable *rt;\n+\tstruct flowi4 fl4;\n+\tstruct iphdr *iph;\n+\t__be16 seq;\n+\n+\tgtp0 = (struct gtp0_header *)(skb->data + sizeof(struct udphdr));\n+\n+\tif (!gtp0_validate_echo_req(gtp0))\n+\t\treturn -1;\n+\n+\tseq = gtp0->seq;\n+\n+\t/* pull GTP and UDP headers */\n+\tskb_pull_data(skb, sizeof(struct gtp0_header) + sizeof(struct udphdr));\n+\n+\tgtp_pkt = skb_push(skb, sizeof(struct gtp0_packet));\n+\tmemset(gtp_pkt, 0, sizeof(struct gtp0_packet));\n+\n+\tgtp_pkt->gtp0_h.flags = 0x1e; /* v0, GTP-non-prime. */\n+\tgtp_pkt->gtp0_h.type = GTP_ECHO_RSP;\n+\tgtp_pkt->gtp0_h.length =\n+\t\thtons(sizeof(struct gtp0_packet) - sizeof(struct gtp0_header));\n+\n+\t/* GSM TS 09.60. 7.3 The Sequence Number in a signalling response\n+\t * message shall be copied from the signalling request message\n+\t * that the GSN is replying to.\n+\t */\n+\tgtp_pkt->gtp0_h.seq = seq;\n+\n+\t/* GSM TS 09.60. 7.3 In all Path Management Flow Label and TID\n+\t * are not used and shall be set to 0.\n+\t */\n+\tgtp_pkt->gtp0_h.flow = 0;\n+\tgtp_pkt->gtp0_h.tid = 0;\n+\tgtp_pkt->gtp0_h.number = 0xff;\n+\tgtp_pkt->gtp0_h.spare[0] = 0xff;\n+\tgtp_pkt->gtp0_h.spare[1] = 0xff;\n+\tgtp_pkt->gtp0_h.spare[2] = 0xff;\n+\n+\tgtp_pkt->ie.tag = GTPIE_RECOVERY;\n+\tgtp_pkt->ie.val = gtp->restart_count;\n+\n+\tiph = ip_hdr(skb);\n+\n+\t/* find route to the sender,\n+\t * src address becomes dst address and vice versa.\n+\t */\n+\trt = ip4_route_output_gtp(&fl4, gtp->sk0, iph->saddr, iph->daddr);\n+\tif (IS_ERR(rt)) {\n+\t\tnetdev_dbg(gtp->dev, \"no route for echo response from %pI4\\n\",\n+\t\t\t   &iph->saddr);\n+\t\treturn -1;\n+\t}\n+\n+\tudp_tunnel_xmit_skb(rt, gtp->sk0, skb,\n+\t\t\t    fl4.saddr, fl4.daddr,\n+\t\t\t    iph->tos,\n+\t\t\t    ip4_dst_hoplimit(&rt->dst),\n+\t\t\t    0,\n+\t\t\t    htons(GTP0_PORT), htons(GTP0_PORT),\n+\t\t\t    !net_eq(sock_net(gtp->sk1u),\n+\t\t\t\t    dev_net(gtp->dev)),\n+\t\t\t    false);\n+\treturn 0;\n+}\n+\n /* 1 means pass up to the stack, -1 means drop and 0 means decapsulated. */\n static int gtp0_udp_encap_recv(struct gtp_dev *gtp, struct sk_buff *skb)\n {\n@@ -233,6 +335,13 @@ static int gtp0_udp_encap_recv(struct gtp_dev *gtp, struct sk_buff *skb)\n \tif ((gtp0->flags >> 5) != GTP_V0)\n \t\treturn 1;\n \n+\t/* If the sockets were created in kernel, it means that\n+\t * there is no daemon running in userspace which would\n+\t * handle echo request.\n+\t */\n+\tif (gtp0->type == GTP_ECHO_REQ && gtp->sk_created)\n+\t\treturn gtp0_send_echo_resp(gtp, skb);\n+\n \tif (gtp0->type != GTP_TPDU)\n \t\treturn 1;\n \n@@ -245,6 +354,75 @@ static int gtp0_udp_encap_recv(struct gtp_dev *gtp, struct sk_buff *skb)\n \treturn gtp_rx(pctx, skb, hdrlen, gtp->role);\n }\n \n+static int gtp1u_send_echo_resp(struct gtp_dev *gtp, struct sk_buff *skb)\n+{\n+\tstruct gtp1_header_long *gtp1u;\n+\tstruct gtp1u_packet *gtp_pkt;\n+\tstruct rtable *rt;\n+\tstruct flowi4 fl4;\n+\tstruct iphdr *iph;\n+\n+\tgtp1u = (struct gtp1_header_long *)(skb->data + sizeof(struct udphdr));\n+\n+\t/* 3GPP TS 29.281 5.1 - For the Echo Request, Echo Response,\n+\t * Error Indication and Supported Extension Headers Notification\n+\t * messages, the S flag shall be set to 1 and TEID shall be set to 0.\n+\t */\n+\tif (!(gtp1u->flags & GTP1_F_SEQ) || gtp1u->tid)\n+\t\treturn -1;\n+\n+\t/* pull GTP and UDP headers */\n+\tskb_pull_data(skb,\n+\t\t      sizeof(struct gtp1_header_long) + sizeof(struct udphdr));\n+\n+\tgtp_pkt = skb_push(skb, sizeof(struct gtp1u_packet));\n+\tmemset(gtp_pkt, 0, sizeof(struct gtp1u_packet));\n+\n+\t/* S flag must be set to 1 */\n+\tgtp_pkt->gtp1u_h.flags = 0x32;\n+\tgtp_pkt->gtp1u_h.type = GTP_ECHO_RSP;\n+\t/* seq, npdu and next should be counted to the length of the GTP packet\n+\t * that's why szie of gtp1_header should be subtracted,\n+\t * not why szie of gtp1_header_long.\n+\t */\n+\tgtp_pkt->gtp1u_h.length =\n+\t\thtons(sizeof(struct gtp1u_packet) - sizeof(struct gtp1_header));\n+\t/* 3GPP TS 29.281 5.1 - TEID has to be set to 0 */\n+\tgtp_pkt->gtp1u_h.tid = 0;\n+\n+\t/* 3GPP TS 29.281 7.7.2 - The Restart Counter value in the\n+\t * Recovery information element shall not be used, i.e. it shall\n+\t * be set to zero by the sender and shall be ignored by the receiver.\n+\t * The Recovery information element is mandatory due to backwards\n+\t * compatibility reasons.\n+\t */\n+\tgtp_pkt->ie.tag = GTPIE_RECOVERY;\n+\tgtp_pkt->ie.val = 0;\n+\n+\tiph = ip_hdr(skb);\n+\n+\t/* find route to the sender,\n+\t * src address becomes dst address and vice versa.\n+\t */\n+\trt = ip4_route_output_gtp(&fl4, gtp->sk1u, iph->saddr, iph->daddr);\n+\tif (IS_ERR(rt)) {\n+\t\tnetdev_dbg(gtp->dev, \"no route for echo response from %pI4\\n\",\n+\t\t\t   &iph->saddr);\n+\t\treturn -1;\n+\t}\n+\n+\tudp_tunnel_xmit_skb(rt, gtp->sk1u, skb,\n+\t\t\t    fl4.saddr, fl4.daddr,\n+\t\t\t    iph->tos,\n+\t\t\t    ip4_dst_hoplimit(&rt->dst),\n+\t\t\t    0,\n+\t\t\t    htons(GTP1U_PORT), htons(GTP1U_PORT),\n+\t\t\t    !net_eq(sock_net(gtp->sk1u),\n+\t\t\t\t    dev_net(gtp->dev)),\n+\t\t\t    false);\n+\treturn 0;\n+}\n+\n static int gtp1u_udp_encap_recv(struct gtp_dev *gtp, struct sk_buff *skb)\n {\n \tunsigned int hdrlen = sizeof(struct udphdr) +\n@@ -260,6 +438,13 @@ static int gtp1u_udp_encap_recv(struct gtp_dev *gtp, struct sk_buff *skb)\n \tif ((gtp1->flags >> 5) != GTP_V1)\n \t\treturn 1;\n \n+\t/* If the sockets were created in kernel, it means that\n+\t * there is no daemon running in userspace which would\n+\t * handle echo request.\n+\t */\n+\tif (gtp1->type == GTP_ECHO_REQ && gtp->sk_created)\n+\t\treturn gtp1u_send_echo_resp(gtp, skb);\n+\n \tif (gtp1->type != GTP_TPDU)\n \t\treturn 1;\n \n@@ -398,20 +583,6 @@ static void gtp_dev_uninit(struct net_device *dev)\n \tfree_percpu(dev->tstats);\n }\n \n-static struct rtable *ip4_route_output_gtp(struct flowi4 *fl4,\n-\t\t\t\t\t   const struct sock *sk,\n-\t\t\t\t\t   __be32 daddr)\n-{\n-\tmemset(fl4, 0, sizeof(*fl4));\n-\tfl4->flowi4_oif\t\t= sk->sk_bound_dev_if;\n-\tfl4->daddr\t\t= daddr;\n-\tfl4->saddr\t\t= inet_sk(sk)->inet_saddr;\n-\tfl4->flowi4_tos\t\t= RT_CONN_FLAGS(sk);\n-\tfl4->flowi4_proto\t= sk->sk_protocol;\n-\n-\treturn ip_route_output_key(sock_net(sk), fl4);\n-}\n-\n static inline void gtp0_push_header(struct sk_buff *skb, struct pdp_ctx *pctx)\n {\n \tint payload_len = skb->len;\n@@ -517,7 +688,8 @@ static int gtp_build_skb_ip4(struct sk_buff *skb, struct net_device *dev,\n \t}\n \tnetdev_dbg(dev, \"found PDP context %p\\n\", pctx);\n \n-\trt = ip4_route_output_gtp(&fl4, pctx->sk, pctx->peer_addr_ip4.s_addr);\n+\trt = ip4_route_output_gtp(&fl4, pctx->sk, pctx->peer_addr_ip4.s_addr,\n+\t\t\t\t  inet_sk(pctx->sk)->inet_saddr);\n \tif (IS_ERR(rt)) {\n \t\tnetdev_dbg(dev, \"no route to SSGN %pI4\\n\",\n \t\t\t   &pctx->peer_addr_ip4.s_addr);\n@@ -746,6 +918,11 @@ static int gtp_newlink(struct net *src_net, struct net_device *dev,\n \t}\n \tgtp->role = role;\n \n+\tif (!data[IFLA_GTP_RESTART_COUNT])\n+\t\tgtp->restart_count = 0;\n+\telse\n+\t\tgtp->restart_count = nla_get_u8(data[IFLA_GTP_RESTART_COUNT]);\n+\n \tgtp->net = src_net;\n \n \terr = gtp_hashtable_new(gtp, hashsize);\n@@ -801,6 +978,7 @@ static const struct nla_policy gtp_policy[IFLA_GTP_MAX + 1] = {\n \t[IFLA_GTP_PDP_HASHSIZE]\t\t= { .type = NLA_U32 },\n \t[IFLA_GTP_ROLE]\t\t\t= { .type = NLA_U32 },\n \t[IFLA_GTP_CREATE_SOCKETS]\t= { .type = NLA_U8 },\n+\t[IFLA_GTP_RESTART_COUNT]\t= { .type = NLA_U8 },\n };\n \n static int gtp_validate(struct nlattr *tb[], struct nlattr *data[],\n@@ -815,7 +993,8 @@ static int gtp_validate(struct nlattr *tb[], struct nlattr *data[],\n static size_t gtp_get_size(const struct net_device *dev)\n {\n \treturn nla_total_size(sizeof(__u32)) + /* IFLA_GTP_PDP_HASHSIZE */\n-\t\tnla_total_size(sizeof(__u32)); /* IFLA_GTP_ROLE */\n+\t\tnla_total_size(sizeof(__u32)) + /* IFLA_GTP_ROLE */\n+\t\tnla_total_size(sizeof(__u8)); /* IFLA_GTP_RESTART_COUNT */\n }\n \n static int gtp_fill_info(struct sk_buff *skb, const struct net_device *dev)\n@@ -826,6 +1005,8 @@ static int gtp_fill_info(struct sk_buff *skb, const struct net_device *dev)\n \t\tgoto nla_put_failure;\n \tif (nla_put_u32(skb, IFLA_GTP_ROLE, gtp->role))\n \t\tgoto nla_put_failure;\n+\tif (nla_put_u8(skb, IFLA_GTP_RESTART_COUNT, gtp->restart_count))\n+\t\tgoto nla_put_failure;\n \n \treturn 0;\n \ndiff --git a/include/net/gtp.h b/include/net/gtp.h\nindex 0e16ebb2a82d..0e12c37f2958 100644\n--- a/include/net/gtp.h\n+++ b/include/net/gtp.h\n@@ -7,8 +7,13 @@\n #define GTP0_PORT\t3386\n #define GTP1U_PORT\t2152\n \n+/* GTP messages types */\n+#define GTP_ECHO_REQ\t1\t/* Echo Request */\n+#define GTP_ECHO_RSP\t2\t/* Echo Response */\n #define GTP_TPDU\t255\n \n+#define GTPIE_RECOVERY\t14\n+\n struct gtp0_header {\t/* According to GSM TS 09.60. */\n \t__u8\tflags;\n \t__u8\ttype;\n@@ -27,6 +32,32 @@ struct gtp1_header {\t/* According to 3GPP TS 29.060. */\n \t__be32\ttid;\n } __attribute__ ((packed));\n \n+struct gtp1_header_long {\t/* According to 3GPP TS 29.060. */\n+\t__u8\tflags;\n+\t__u8\ttype;\n+\t__be16\tlength;\n+\t__be32\ttid;\n+\t__be16\tseq;\n+\t__u8\tnpdu;\n+\t__u8\tnext;\n+} __packed;\n+\n+/* GTP Information Element */\n+struct gtp_ie {\n+\t__u8\ttag;\n+\t__u8\tval;\n+} __packed;\n+\n+struct gtp0_packet {\n+\tstruct gtp0_header gtp0_h;\n+\tstruct gtp_ie ie;\n+} __packed;\n+\n+struct gtp1u_packet {\n+\tstruct gtp1_header_long gtp1u_h;\n+\tstruct gtp_ie ie;\n+} __packed;\n+\n #define GTP1_F_NPDU\t0x01\n #define GTP1_F_SEQ\t0x02\n #define GTP1_F_EXTHDR\t0x04\ndiff --git a/include/uapi/linux/if_link.h b/include/uapi/linux/if_link.h\nindex ebd2aa3ef809..bd24c7dc10a2 100644\n--- a/include/uapi/linux/if_link.h\n+++ b/include/uapi/linux/if_link.h\n@@ -888,6 +888,7 @@ enum {\n \tIFLA_GTP_PDP_HASHSIZE,\n \tIFLA_GTP_ROLE,\n \tIFLA_GTP_CREATE_SOCKETS,\n+\tIFLA_GTP_RESTART_COUNT,\n \t__IFLA_GTP_MAX,\n };\n #define IFLA_GTP_MAX (__IFLA_GTP_MAX - 1)\n", "stats": " drivers/net/gtp.c            | 213 +++++++++++++++++++++++++++++++++++++++----\n include/net/gtp.h            |  31 +++++++\n include/uapi/linux/if_link.h |   1 +\n 3 files changed, 229 insertions(+), 16 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "9af41cc33471ea1efa6f77e188f055cc77d0a5c5"}, "tag": "linux", "timestamp": 1699830134.812322, "updated_on": 1647016036.0, "uuid": "45b842cd90a67417165e16b702dba37f7d9af8fd"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Marijn Suijten <marijn.suijten@somainline.org>", "AuthorDate": "Sun Oct 30 08:32:30 2022 +0100", "Commit": "Bjorn Andersson <andersson@kernel.org>", "CommitDate": "Mon Nov 7 17:25:47 2022 -0600", "Signed-off-by": ["Marijn Suijten <marijn.suijten@somainline.org>", "Bjorn Andersson <andersson@kernel.org>"], "commit": "8bad51c68930eba8b26ce362c7c9bfce5d074a2f", "files": [{"action": "M", "added": "16", "file": "arch/arm64/boot/dts/qcom/sm6350-sony-xperia-lena-pdx213.dts", "indexes": ["5cb76026ef67", "6eb1d4e5e60f"], "modes": ["100644", "100644"], "removed": "0"}], "message": "arm64: dts: qcom: sm6350-lena: Enable QUP and GPI DMA\n\nEnable QUP and GPI DMA hardware to be able to add functioning I2C nodes\nlater.\n\nSigned-off-by: Marijn Suijten <marijn.suijten@somainline.org>\nReviewed-by: Konrad Dybcio <konrad.dybcio@somainline.org>\nSigned-off-by: Bjorn Andersson <andersson@kernel.org>\nLink: https://lore.kernel.org/r/20221030073232.22726-9-marijn.suijten@somainline.org", "parents": ["85eef5cb65ab7e8905725d13c98c90442bb93dbc"], "refs": [], "diff": "diff --git a/arch/arm64/boot/dts/qcom/sm6350-sony-xperia-lena-pdx213.dts b/arch/arm64/boot/dts/qcom/sm6350-sony-xperia-lena-pdx213.dts\nindex 5cb76026ef67..6eb1d4e5e60f 100644\n--- a/arch/arm64/boot/dts/qcom/sm6350-sony-xperia-lena-pdx213.dts\n+++ b/arch/arm64/boot/dts/qcom/sm6350-sony-xperia-lena-pdx213.dts\n@@ -272,6 +272,14 @@ pm6150l_bob: bob {\n \t};\n };\n \n+&gpi_dma0 {\n+\tstatus = \"okay\";\n+};\n+\n+&gpi_dma1 {\n+\tstatus = \"okay\";\n+};\n+\n &pm6350_gpios {\n \tgpio_keys_state: gpio-keys-state {\n \t\tkey-volume-down-pins {\n@@ -289,6 +297,14 @@ &pm6350_resin {\n \tstatus = \"okay\";\n };\n \n+&qupv3_id_0 {\n+\tstatus = \"okay\";\n+};\n+\n+&qupv3_id_1 {\n+\tstatus = \"okay\";\n+};\n+\n &sdc2_off_state {\n \tsd-cd-pins {\n \t\tpins = \"gpio94\";\n", "stats": " .../boot/dts/qcom/sm6350-sony-xperia-lena-pdx213.dts     | 16 ++++++++++++++++\n 1 file changed, 16 insertions(+)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "8bad51c68930eba8b26ce362c7c9bfce5d074a2f"}, "tag": "linux", "timestamp": 1699830849.386251, "updated_on": 1667863547.0, "uuid": "1d5e79df19876136a9146dcead000d1a1a046d7c"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Bjorn Andersson <andersson@kernel.org>", "AuthorDate": "Wed Feb 9 21:10:43 2022 -0800", "Commit": "Bjorn Andersson <andersson@kernel.org>", "CommitDate": "Thu Feb 10 17:53:00 2022 -0600", "Signed-off-by": ["Bjorn Andersson <bjorn.andersson@linaro.org>"], "commit": "76ee15ae1b13a53a355246f92039c8373e8ba601", "files": [{"action": "M", "added": "12", "file": "drivers/soc/qcom/socinfo.c", "indexes": ["6dc0f39c0ec3", "8b38d134720a"], "modes": ["100644", "100644"], "removed": "0"}], "message": "soc: qcom: socinfo: Add some more PMICs and SoCs\n\nAdd SM8350, SC8280XP, SA8540P and one more SM8450 and various PMICs\nfound on boards on these platforms to the socinfo driver.\n\nSigned-off-by: Bjorn Andersson <bjorn.andersson@linaro.org>\nTested-by: Vinod Koul <vkoul@kernel.org>\nReviewed-by: Vinod Koul <vkoul@kernel.org>\nLink: https://lore.kernel.org/r/20220210051043.748275-1-bjorn.andersson@linaro.org", "parents": ["f60a317bcbea5c5b8923d6de6c7288850fdd83fb"], "refs": [], "diff": "diff --git a/drivers/soc/qcom/socinfo.c b/drivers/soc/qcom/socinfo.c\nindex 6dc0f39c0ec3..8b38d134720a 100644\n--- a/drivers/soc/qcom/socinfo.c\n+++ b/drivers/soc/qcom/socinfo.c\n@@ -104,6 +104,14 @@ static const char *const pmic_models[] = {\n \t[36] = \"PM8009\",\n \t[38] = \"PM8150C\",\n \t[41] = \"SMB2351\",\n+\t[47] = \"PMK8350\",\n+\t[48] = \"PM8350\",\n+\t[49] = \"PM8350C\",\n+\t[50] = \"PM8350B\",\n+\t[51] = \"PMR735A\",\n+\t[52] = \"PMR735B\",\n+\t[58] = \"PM8450\",\n+\t[65] = \"PM8010\",\n };\n #endif /* CONFIG_DEBUG_FS */\n \n@@ -314,10 +322,14 @@ static const struct soc_id soc_id[] = {\n \t{ 422, \"IPQ6010\" },\n \t{ 425, \"SC7180\" },\n \t{ 434, \"SM6350\" },\n+\t{ 439, \"SM8350\" },\n+\t{ 449, \"SC8280XP\" },\n \t{ 453, \"IPQ6005\" },\n \t{ 455, \"QRB5165\" },\n \t{ 457, \"SM8450\" },\n \t{ 459, \"SM7225\" },\n+\t{ 460, \"SA8540P\" },\n+\t{ 480, \"SM8450\" },\n };\n \n static const char *socinfo_machine(struct device *dev, unsigned int id)\n", "stats": " drivers/soc/qcom/socinfo.c | 12 ++++++++++++\n 1 file changed, 12 insertions(+)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "76ee15ae1b13a53a355246f92039c8373e8ba601"}, "tag": "linux", "timestamp": 1699830101.867021, "updated_on": 1644537180.0, "uuid": "605a4e03b665ccc416938e4208c9b159a55af3fc"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Mike Kravetz <mike.kravetz@oracle.com>", "AuthorDate": "Tue Oct 4 18:17:05 2022 -0700", "Commit": "Andrew Morton <akpm@linux-foundation.org>", "CommitDate": "Fri Oct 7 14:28:40 2022 -0700", "Signed-off-by": ["Mike Kravetz <mike.kravetz@oracle.com>", "Andrew Morton <akpm@linux-foundation.org>"], "commit": "131a79b474e973f023c5c75e2323a940332103be", "files": [{"action": "M", "added": "27", "file": "mm/hugetlb.c", "indexes": ["8de5a6b5a172", "45e305d182f6"], "modes": ["100644", "100644"], "removed": "16"}, {"action": "M", "added": "0", "file": "mm/memory.c", "indexes": ["118e5f023597", "df678fa30cdb"], "modes": ["100644", "100644"], "removed": "4"}], "message": "hugetlb: fix vma lock handling during split vma and range unmapping\n\nPatch series \"hugetlb: fixes for new vma lock series\".\n\nIn review of the series \"hugetlb: Use new vma lock for huge pmd sharing\nsynchronization\", Miaohe Lin pointed out two key issues:\n\n1) There is a race in the routine hugetlb_unmap_file_folio when locks\n   are dropped and reacquired in the correct order [1].\n\n2) With the switch to using vma lock for fault/truncate synchronization,\n   we need to make sure lock exists for all VM_MAYSHARE vmas, not just\n   vmas capable of pmd sharing.\n\nThese two issues are addressed here.  In addition, having a vma lock\npresent in all VM_MAYSHARE vmas, uncovered some issues around vma\nsplitting.  Those are also addressed.\n\n[1] https://lore.kernel.org/linux-mm/01f10195-7088-4462-6def-909549c75ef4@huawei.com/\n\n\nThis patch (of 3):\n\nThe hugetlb vma lock hangs off the vm_private_data field and is specific\nto the vma.  When vm_area_dup() is called as part of vma splitting, the\nvma lock pointer is copied to the new vma.  This will result in issues\nsuch as double freeing of the structure.  Update the hugetlb open vm_ops\nto allocate a new vma lock for the new vma.\n\nThe routine __unmap_hugepage_range_final unconditionally unset VM_MAYSHARE\nto prevent subsequent pmd sharing.  hugetlb_vma_lock_free attempted to\nanticipate this by checking both VM_MAYSHARE and VM_SHARED.  However, if\nonly VM_MAYSHARE was set we would miss the free.  With the introduction of\nthe vma lock, a vma can not participate in pmd sharing if vm_private_data\nis NULL.  Instead of clearing VM_MAYSHARE in __unmap_hugepage_range_final,\nfree the vma lock to prevent sharing.  Also, update the sharing code to\nmake sure vma lock is indeed a condition for pmd sharing.\nhugetlb_vma_lock_free can then key off VM_MAYSHARE and not miss any vmas.\n\nLink: https://lkml.kernel.org/r/20221005011707.514612-1-mike.kravetz@oracle.com\nLink: https://lkml.kernel.org/r/20221005011707.514612-2-mike.kravetz@oracle.com\nFixes: \"hugetlb: add vma based lock for pmd sharing\"\nSigned-off-by: Mike Kravetz <mike.kravetz@oracle.com>\nCc: Andrea Arcangeli <aarcange@redhat.com>\nCc: \"Aneesh Kumar K.V\" <aneesh.kumar@linux.vnet.ibm.com>\nCc: Axel Rasmussen <axelrasmussen@google.com>\nCc: David Hildenbrand <david@redhat.com>\nCc: Davidlohr Bueso <dave@stgolabs.net>\nCc: James Houghton <jthoughton@google.com>\nCc: \"Kirill A. Shutemov\" <kirill.shutemov@linux.intel.com>\nCc: Miaohe Lin <linmiaohe@huawei.com>\nCc: Michal Hocko <mhocko@suse.com>\nCc: Mina Almasry <almasrymina@google.com>\nCc: Muchun Song <songmuchun@bytedance.com>\nCc: Naoya Horiguchi <naoya.horiguchi@linux.dev>\nCc: Pasha Tatashin <pasha.tatashin@soleen.com>\nCc: Peter Xu <peterx@redhat.com>\nCc: Prakash Sangappa <prakash.sangappa@oracle.com>\nCc: Sven Schnelle <svens@linux.ibm.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>", "parents": ["e4fea72b143848d8bbbeae6d39a890212bcf848e"], "refs": [], "diff": "diff --git a/mm/hugetlb.c b/mm/hugetlb.c\nindex 8de5a6b5a172..45e305d182f6 100644\n--- a/mm/hugetlb.c\n+++ b/mm/hugetlb.c\n@@ -4612,7 +4612,14 @@ static void hugetlb_vm_op_open(struct vm_area_struct *vma)\n \t\tkref_get(&resv->refs);\n \t}\n \n-\thugetlb_vma_lock_alloc(vma);\n+\t/*\n+\t * vma_lock structure for sharable mappings is vma specific.\n+\t * Clear old pointer (if copied via vm_area_dup) and create new.\n+\t */\n+\tif (vma->vm_flags & VM_MAYSHARE) {\n+\t\tvma->vm_private_data = NULL;\n+\t\thugetlb_vma_lock_alloc(vma);\n+\t}\n }\n \n static void hugetlb_vm_op_close(struct vm_area_struct *vma)\n@@ -5168,19 +5175,23 @@ void __unmap_hugepage_range_final(struct mmu_gather *tlb,\n \t\t\t  unsigned long end, struct page *ref_page,\n \t\t\t  zap_flags_t zap_flags)\n {\n+\thugetlb_vma_lock_write(vma);\n+\ti_mmap_lock_write(vma->vm_file->f_mapping);\n+\n \t__unmap_hugepage_range(tlb, vma, start, end, ref_page, zap_flags);\n \n \t/*\n-\t * Clear this flag so that x86's huge_pmd_share page_table_shareable\n-\t * test will fail on a vma being torn down, and not grab a page table\n-\t * on its way out.  We're lucky that the flag has such an appropriate\n-\t * name, and can in fact be safely cleared here. We could clear it\n-\t * before the __unmap_hugepage_range above, but all that's necessary\n-\t * is to clear it before releasing the i_mmap_rwsem. This works\n-\t * because in the context this is called, the VMA is about to be\n-\t * destroyed and the i_mmap_rwsem is held.\n+\t * Unlock and free the vma lock before releasing i_mmap_rwsem.  When\n+\t * the vma_lock is freed, this makes the vma ineligible for pmd\n+\t * sharing.  And, i_mmap_rwsem is required to set up pmd sharing.\n+\t * This is important as page tables for this unmapped range will\n+\t * be asynchrously deleted.  If the page tables are shared, there\n+\t * will be issues when accessed by someone else.\n \t */\n-\tvma->vm_flags &= ~VM_MAYSHARE;\n+\thugetlb_vma_unlock_write(vma);\n+\thugetlb_vma_lock_free(vma);\n+\n+\ti_mmap_unlock_write(vma->vm_file->f_mapping);\n }\n \n void unmap_hugepage_range(struct vm_area_struct *vma, unsigned long start,\n@@ -6664,10 +6675,13 @@ static unsigned long page_table_shareable(struct vm_area_struct *svma,\n \t/*\n \t * match the virtual addresses, permission and the alignment of the\n \t * page table page.\n+\t *\n+\t * Also, vma_lock (vm_private_data) is required for sharing.\n \t */\n \tif (pmd_index(addr) != pmd_index(saddr) ||\n \t    vm_flags != svm_flags ||\n-\t    !range_in_vma(svma, sbase, s_end))\n+\t    !range_in_vma(svma, sbase, s_end) ||\n+\t    !svma->vm_private_data)\n \t\treturn 0;\n \n \treturn saddr;\n@@ -6817,12 +6831,9 @@ void hugetlb_vma_lock_release(struct kref *kref)\n static void hugetlb_vma_lock_free(struct vm_area_struct *vma)\n {\n \t/*\n-\t * Only present in sharable vmas.  See comment in\n-\t * __unmap_hugepage_range_final about how VM_SHARED could\n-\t * be set without VM_MAYSHARE.  As a result, we need to\n-\t * check if either is set in the free path.\n+\t * Only present in sharable vmas.\n \t */\n-\tif (!vma || !(vma->vm_flags & (VM_MAYSHARE | VM_SHARED)))\n+\tif (!vma || !__vma_shareable_flags_pmd(vma))\n \t\treturn;\n \n \tif (vma->vm_private_data) {\ndiff --git a/mm/memory.c b/mm/memory.c\nindex 118e5f023597..df678fa30cdb 100644\n--- a/mm/memory.c\n+++ b/mm/memory.c\n@@ -1685,12 +1685,8 @@ static void unmap_single_vma(struct mmu_gather *tlb,\n \t\t\tif (vma->vm_file) {\n \t\t\t\tzap_flags_t zap_flags = details ?\n \t\t\t\t    details->zap_flags : 0;\n-\t\t\t\thugetlb_vma_lock_write(vma);\n-\t\t\t\ti_mmap_lock_write(vma->vm_file->f_mapping);\n \t\t\t\t__unmap_hugepage_range_final(tlb, vma, start, end,\n \t\t\t\t\t\t\t     NULL, zap_flags);\n-\t\t\t\ti_mmap_unlock_write(vma->vm_file->f_mapping);\n-\t\t\t\thugetlb_vma_unlock_write(vma);\n \t\t\t}\n \t\t} else\n \t\t\tunmap_page_range(tlb, vma, start, end, details);\n", "stats": " mm/hugetlb.c | 43 +++++++++++++++++++++++++++----------------\n mm/memory.c  |  4 ----\n 2 files changed, 27 insertions(+), 20 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "131a79b474e973f023c5c75e2323a940332103be"}, "tag": "linux", "timestamp": 1699830764.754378, "updated_on": 1665178120.0, "uuid": "9f19985cc23f7a840acce1081c05f0c93e5bf937"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Alexandre Belloni <alexandre.belloni@bootlin.com>", "AuthorDate": "Tue Nov 15 21:21:05 2022 +0100", "Commit": "Shuah Khan <skhan@linuxfoundation.org>", "CommitDate": "Tue Nov 15 13:30:51 2022 -0700", "Signed-off-by": ["Alexandre Belloni <alexandre.belloni@bootlin.com>", "Shuah Khan <skhan@linuxfoundation.org>"], "commit": "35eee9a363becb854109e35d568299bafc97c9d1", "files": [{"action": "M", "added": "32", "file": "tools/testing/selftests/rtc/rtctest.c", "indexes": ["2b9d929a24ed", "63ce02d1d5cc"], "modes": ["100644", "100644"], "removed": "1"}], "message": "selftests: rtc: skip when RTC is not present\n\nThere is no point in failing the tests when RTC is not present.\n\nReported-by: Linux Kernel Functional Testing <lkft@linaro.org>\nSigned-off-by: Alexandre Belloni <alexandre.belloni@bootlin.com>\nTested-by: Daniel Diaz <daniel.diaz@linaro.org>\nSigned-off-by: Shuah Khan <skhan@linuxfoundation.org>", "parents": ["a1d6cd88c8973cfb08ee85722488b1d6d5d16327"], "refs": [], "diff": "diff --git a/tools/testing/selftests/rtc/rtctest.c b/tools/testing/selftests/rtc/rtctest.c\nindex 2b9d929a24ed..63ce02d1d5cc 100644\n--- a/tools/testing/selftests/rtc/rtctest.c\n+++ b/tools/testing/selftests/rtc/rtctest.c\n@@ -31,7 +31,6 @@ FIXTURE(rtc) {\n \n FIXTURE_SETUP(rtc) {\n \tself->fd = open(rtc_file, O_RDONLY);\n-\tASSERT_NE(-1, self->fd);\n }\n \n FIXTURE_TEARDOWN(rtc) {\n@@ -42,6 +41,10 @@ TEST_F(rtc, date_read) {\n \tint rc;\n \tstruct rtc_time rtc_tm;\n \n+\tif (self->fd == -1 && errno == ENOENT)\n+\t\tSKIP(return, \"Skipping test since %s does not exist\", rtc_file);\n+\tASSERT_NE(-1, self->fd);\n+\n \t/* Read the RTC time/date */\n \trc = ioctl(self->fd, RTC_RD_TIME, &rtc_tm);\n \tASSERT_NE(-1, rc);\n@@ -85,6 +88,10 @@ TEST_F_TIMEOUT(rtc, date_read_loop, READ_LOOP_DURATION_SEC + 2) {\n \tstruct rtc_time rtc_tm;\n \ttime_t start_rtc_read, prev_rtc_read;\n \n+\tif (self->fd == -1 && errno == ENOENT)\n+\t\tSKIP(return, \"Skipping test since %s does not exist\", rtc_file);\n+\tASSERT_NE(-1, self->fd);\n+\n \tTH_LOG(\"Continuously reading RTC time for %ds (with %dms breaks after every read).\",\n \t       READ_LOOP_DURATION_SEC, READ_LOOP_SLEEP_MS);\n \n@@ -119,6 +126,10 @@ TEST_F_TIMEOUT(rtc, uie_read, NUM_UIE + 2) {\n \tint i, rc, irq = 0;\n \tunsigned long data;\n \n+\tif (self->fd == -1 && errno == ENOENT)\n+\t\tSKIP(return, \"Skipping test since %s does not exist\", rtc_file);\n+\tASSERT_NE(-1, self->fd);\n+\n \t/* Turn on update interrupts */\n \trc = ioctl(self->fd, RTC_UIE_ON, 0);\n \tif (rc == -1) {\n@@ -144,6 +155,10 @@ TEST_F(rtc, uie_select) {\n \tint i, rc, irq = 0;\n \tunsigned long data;\n \n+\tif (self->fd == -1 && errno == ENOENT)\n+\t\tSKIP(return, \"Skipping test since %s does not exist\", rtc_file);\n+\tASSERT_NE(-1, self->fd);\n+\n \t/* Turn on update interrupts */\n \trc = ioctl(self->fd, RTC_UIE_ON, 0);\n \tif (rc == -1) {\n@@ -183,6 +198,10 @@ TEST_F(rtc, alarm_alm_set) {\n \ttime_t secs, new;\n \tint rc;\n \n+\tif (self->fd == -1 && errno == ENOENT)\n+\t\tSKIP(return, \"Skipping test since %s does not exist\", rtc_file);\n+\tASSERT_NE(-1, self->fd);\n+\n \trc = ioctl(self->fd, RTC_RD_TIME, &tm);\n \tASSERT_NE(-1, rc);\n \n@@ -237,6 +256,10 @@ TEST_F(rtc, alarm_wkalm_set) {\n \ttime_t secs, new;\n \tint rc;\n \n+\tif (self->fd == -1 && errno == ENOENT)\n+\t\tSKIP(return, \"Skipping test since %s does not exist\", rtc_file);\n+\tASSERT_NE(-1, self->fd);\n+\n \trc = ioctl(self->fd, RTC_RD_TIME, &alarm.time);\n \tASSERT_NE(-1, rc);\n \n@@ -285,6 +308,10 @@ TEST_F_TIMEOUT(rtc, alarm_alm_set_minute, 65) {\n \ttime_t secs, new;\n \tint rc;\n \n+\tif (self->fd == -1 && errno == ENOENT)\n+\t\tSKIP(return, \"Skipping test since %s does not exist\", rtc_file);\n+\tASSERT_NE(-1, self->fd);\n+\n \trc = ioctl(self->fd, RTC_RD_TIME, &tm);\n \tASSERT_NE(-1, rc);\n \n@@ -339,6 +366,10 @@ TEST_F_TIMEOUT(rtc, alarm_wkalm_set_minute, 65) {\n \ttime_t secs, new;\n \tint rc;\n \n+\tif (self->fd == -1 && errno == ENOENT)\n+\t\tSKIP(return, \"Skipping test since %s does not exist\", rtc_file);\n+\tASSERT_NE(-1, self->fd);\n+\n \trc = ioctl(self->fd, RTC_RD_TIME, &alarm.time);\n \tASSERT_NE(-1, rc);\n \n", "stats": " tools/testing/selftests/rtc/rtctest.c | 33 ++++++++++++++++++++++++++++++++-\n 1 file changed, 32 insertions(+), 1 deletion(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "35eee9a363becb854109e35d568299bafc97c9d1"}, "tag": "linux", "timestamp": 1699830890.170933, "updated_on": 1668544251.0, "uuid": "05ed9d0335aeb5d4461e7f8c5d054fd1bd97a96f"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Rob Herring <robh@kernel.org>", "AuthorDate": "Tue Jul 19 15:49:54 2022 -0600", "Commit": "Linus Walleij <linus.walleij@linaro.org>", "CommitDate": "Tue Jul 26 09:40:05 2022 +0200", "Signed-off-by": ["Rob Herring <robh@kernel.org>", "Linus Walleij <linus.walleij@linaro.org>"], "commit": "e79368b15d7735cbc1dff86bb414847d697487c5", "files": [{"action": "M", "added": "2", "file": "Documentation/devicetree/bindings/pinctrl/st,stm32-pinctrl.yaml", "indexes": ["335ffc1353b5", "d35dcc4f0242"], "modes": ["100644", "100644"], "removed": "2"}], "message": "dt-bindings: pinctrl: st,stm32: Correct 'resets' property name\n\nThe correct property name for the reset binding is 'resets', not 'reset'.\nAssuming actual users are correct, this error didn't show up due to\nmissing 'additionalProperties: false'. Fix the name and add missing\n'additionalProperties'.\n\nSigned-off-by: Rob Herring <robh@kernel.org>\nLink: https://lore.kernel.org/r/20220719214955.1875020-1-robh@kernel.org\nSigned-off-by: Linus Walleij <linus.walleij@linaro.org>", "parents": ["c3e4fa4b4eb10bb12b330118fa5a6bacadeecfc6"], "refs": [], "diff": "diff --git a/Documentation/devicetree/bindings/pinctrl/st,stm32-pinctrl.yaml b/Documentation/devicetree/bindings/pinctrl/st,stm32-pinctrl.yaml\nindex 335ffc1353b5..d35dcc4f0242 100644\n--- a/Documentation/devicetree/bindings/pinctrl/st,stm32-pinctrl.yaml\n+++ b/Documentation/devicetree/bindings/pinctrl/st,stm32-pinctrl.yaml\n@@ -59,6 +59,7 @@ properties:\n patternProperties:\n   '^gpio@[0-9a-f]*$':\n     type: object\n+    additionalProperties: false\n     properties:\n       gpio-controller: true\n       '#gpio-cells':\n@@ -68,8 +69,7 @@ patternProperties:\n         maxItems: 1\n       clocks:\n         maxItems: 1\n-      reset:\n-        minItems: 1\n+      resets:\n         maxItems: 1\n       gpio-ranges:\n         minItems: 1\n", "stats": " Documentation/devicetree/bindings/pinctrl/st,stm32-pinctrl.yaml | 4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "e79368b15d7735cbc1dff86bb414847d697487c5"}, "tag": "linux", "timestamp": 1699830589.964033, "updated_on": 1658821205.0, "uuid": "c8b022269d6cd908695c4e899d27ca5c28ed2e6b"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Adam Ford <aford173@gmail.com>", "AuthorDate": "Tue Jan 25 18:11:22 2022 +0100", "Commit": "Mauro Carvalho Chehab <mchehab@kernel.org>", "CommitDate": "Mon Mar 7 10:54:01 2022 +0100", "Signed-off-by": ["Adam Ford <aford173@gmail.com>", "Hans Verkuil <hverkuil-cisco@xs4all.nl>", "Mauro Carvalho Chehab <mchehab@kernel.org>"], "commit": "f3116f2e52e63d8e5b615040013f00c535126fc1", "files": [{"action": "M", "added": "27", "file": "Documentation/devicetree/bindings/media/nxp,imx8mq-vpu.yaml", "indexes": ["762be3f96ce9", "9c28d562112b"], "modes": ["100644", "100644"], "removed": "38"}], "message": "media: dt-bindings: media: nxp, imx8mq-vpu: Split G1 and G2 nodes\n\nThe G1 and G2 are independent and separate decoder blocks\nthat are enabled by the vpu-blk-ctrl power-domain controller,\nwhich now has a proper driver.\n\nBecause these blocks only share the power-domain, and can be\nindependently fused out, update the bindings to support separate\nnodes for the G1 and G2 decoders with vpu-blk-ctrl power-domain\nsupport.\n\nThe new DT + old kernel isn't a supported configuration.\n\nSigned-off-by: Adam Ford <aford173@gmail.com>\nReviewed-by: Rob Herring <robh@kernel.org>\nReviewed-by: Ezequiel Garcia <ezequiel@vanguardiasur.com.ar>\nSigned-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>\nSigned-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>", "parents": ["cf4a3ab5981ac4cb997176878ec992fd0f556af1"], "refs": [], "diff": "diff --git a/Documentation/devicetree/bindings/media/nxp,imx8mq-vpu.yaml b/Documentation/devicetree/bindings/media/nxp,imx8mq-vpu.yaml\nindex 762be3f96ce9..9c28d562112b 100644\n--- a/Documentation/devicetree/bindings/media/nxp,imx8mq-vpu.yaml\n+++ b/Documentation/devicetree/bindings/media/nxp,imx8mq-vpu.yaml\n@@ -15,33 +15,20 @@ description:\n \n properties:\n   compatible:\n-    const: nxp,imx8mq-vpu\n+    oneOf:\n+      - const: nxp,imx8mq-vpu\n+        deprecated: true\n+      - const: nxp,imx8mq-vpu-g1\n+      - const: nxp,imx8mq-vpu-g2\n \n   reg:\n-    maxItems: 3\n-\n-  reg-names:\n-    items:\n-      - const: g1\n-      - const: g2\n-      - const: ctrl\n+    maxItems: 1\n \n   interrupts:\n-    maxItems: 2\n-\n-  interrupt-names:\n-    items:\n-      - const: g1\n-      - const: g2\n+    maxItems: 1\n \n   clocks:\n-    maxItems: 3\n-\n-  clock-names:\n-    items:\n-      - const: g1\n-      - const: g2\n-      - const: bus\n+    maxItems: 1\n \n   power-domains:\n     maxItems: 1\n@@ -49,31 +36,33 @@ properties:\n required:\n   - compatible\n   - reg\n-  - reg-names\n   - interrupts\n-  - interrupt-names\n   - clocks\n-  - clock-names\n \n additionalProperties: false\n \n examples:\n   - |\n         #include <dt-bindings/clock/imx8mq-clock.h>\n+        #include <dt-bindings/power/imx8mq-power.h>\n+        #include <dt-bindings/interrupt-controller/arm-gic.h>\n+\n+        vpu_g1: video-codec@38300000 {\n+                compatible = \"nxp,imx8mq-vpu-g1\";\n+                reg = <0x38300000 0x10000>;\n+                interrupts = <GIC_SPI 7 IRQ_TYPE_LEVEL_HIGH>;\n+                clocks = <&clk IMX8MQ_CLK_VPU_G1_ROOT>;\n+                power-domains = <&vpu_blk_ctrl IMX8MQ_VPUBLK_PD_G1>;\n+        };\n+  - |\n+        #include <dt-bindings/clock/imx8mq-clock.h>\n+        #include <dt-bindings/power/imx8mq-power.h>\n         #include <dt-bindings/interrupt-controller/arm-gic.h>\n \n-        vpu: video-codec@38300000 {\n-                compatible = \"nxp,imx8mq-vpu\";\n-                reg = <0x38300000 0x10000>,\n-                      <0x38310000 0x10000>,\n-                      <0x38320000 0x10000>;\n-                reg-names = \"g1\", \"g2\", \"ctrl\";\n-                interrupts = <GIC_SPI 7 IRQ_TYPE_LEVEL_HIGH>,\n-                             <GIC_SPI 8 IRQ_TYPE_LEVEL_HIGH>;\n-                interrupt-names = \"g1\", \"g2\";\n-                clocks = <&clk IMX8MQ_CLK_VPU_G1_ROOT>,\n-                         <&clk IMX8MQ_CLK_VPU_G2_ROOT>,\n-                         <&clk IMX8MQ_CLK_VPU_DEC_ROOT>;\n-                clock-names = \"g1\", \"g2\", \"bus\";\n-                power-domains = <&pgc_vpu>;\n+        vpu_g2: video-codec@38300000 {\n+                compatible = \"nxp,imx8mq-vpu-g2\";\n+                reg = <0x38310000 0x10000>;\n+                interrupts = <GIC_SPI 8 IRQ_TYPE_LEVEL_HIGH>;\n+                clocks = <&clk IMX8MQ_CLK_VPU_G2_ROOT>;\n+                power-domains = <&vpu_blk_ctrl IMX8MQ_VPUBLK_PD_G2>;\n         };\n", "stats": " .../devicetree/bindings/media/nxp,imx8mq-vpu.yaml  | 65 +++++++++-------------\n 1 file changed, 27 insertions(+), 38 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "f3116f2e52e63d8e5b615040013f00c535126fc1"}, "tag": "linux", "timestamp": 1699830096.239472, "updated_on": 1646646841.0, "uuid": "9eac29e6cb3921ed94c08d3cef2542168988a9ca"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Ramesh Rangavittal <ramesh.rangavittal@infineon.com>", "AuthorDate": "Thu Sep 22 05:41:40 2022 -0500", "Commit": "Kalle Valo <kvalo@kernel.org>", "CommitDate": "Tue Sep 27 09:09:07 2022 +0300", "Signed-off-by": ["Ramesh Rangavittal <ramesh.rangavittal@infineon.com>", "Chi-hsien Lin <chi-hsien.lin@infineon.com>", "Ian Lin <ian.lin@infineon.com>", "Kalle Valo <kvalo@kernel.org>"], "commit": "a373f38cd1f5e86cae86157f0b77cf731c5049c1", "files": [{"action": "M", "added": "1", "file": "drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c", "indexes": ["42068145a447", "dfcfb3333369"], "modes": ["100644", "100644"], "removed": "25"}], "message": "brcmfmac: Remove the call to \"dtim_assoc\" IOVAR\n\nWhen STA roams from one AP to another, after roam is complete, host\ndriver tries to get TIM information from firmware. This is no longer\nsupported in the firmware & hence, this call will always fail.\nThis failure results in the below message being displayed on the\nconsole all the time when roam is done.\n\nieee80211 phy0: brcmf_update_bss_info: wl dtim_assoc failed (-52)\n\nChanges ensure that the host driver will no longer try to get TIM\ninformation from firmware.\n\nSigned-off-by: Ramesh Rangavittal <ramesh.rangavittal@infineon.com>\nSigned-off-by: Chi-hsien Lin <chi-hsien.lin@infineon.com>\nSigned-off-by: Ian Lin <ian.lin@infineon.com>\nSigned-off-by: Kalle Valo <kvalo@kernel.org>\nLink: https://lore.kernel.org/r/20220922104140.11889-5-ian.lin@infineon.com", "parents": ["11eda8f01d6a1b16341235459a6b2b5bf9a28669"], "refs": [], "diff": "diff --git a/drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c b/drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c\nindex 42068145a447..dfcfb3333369 100644\n--- a/drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c\n+++ b/drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c\n@@ -3164,10 +3164,7 @@ static s32 brcmf_update_bss_info(struct brcmf_cfg80211_info *cfg,\n \t\t\t\t struct brcmf_if *ifp)\n {\n \tstruct brcmf_pub *drvr = cfg->pub;\n-\tstruct brcmf_bss_info_le *bi;\n-\tconst struct brcmf_tlv *tim;\n-\tsize_t ie_len;\n-\tu8 *ie;\n+\tstruct brcmf_bss_info_le *bi = NULL;\n \ts32 err = 0;\n \n \tbrcmf_dbg(TRACE, \"Enter\\n\");\n@@ -3181,29 +3178,8 @@ static s32 brcmf_update_bss_info(struct brcmf_cfg80211_info *cfg,\n \t\tbphy_err(drvr, \"Could not get bss info %d\\n\", err);\n \t\tgoto update_bss_info_out;\n \t}\n-\n \tbi = (struct brcmf_bss_info_le *)(cfg->extra_buf + 4);\n \terr = brcmf_inform_single_bss(cfg, bi);\n-\tif (err)\n-\t\tgoto update_bss_info_out;\n-\n-\tie = ((u8 *)bi) + le16_to_cpu(bi->ie_offset);\n-\tie_len = le32_to_cpu(bi->ie_length);\n-\n-\ttim = brcmf_parse_tlvs(ie, ie_len, WLAN_EID_TIM);\n-\tif (!tim) {\n-\t\t/*\n-\t\t* active scan was done so we could not get dtim\n-\t\t* information out of probe response.\n-\t\t* so we speficially query dtim information to dongle.\n-\t\t*/\n-\t\tu32 var;\n-\t\terr = brcmf_fil_iovar_int_get(ifp, \"dtim_assoc\", &var);\n-\t\tif (err) {\n-\t\t\tbphy_err(drvr, \"wl dtim_assoc failed (%d)\\n\", err);\n-\t\t\tgoto update_bss_info_out;\n-\t\t}\n-\t}\n \n update_bss_info_out:\n \tbrcmf_dbg(TRACE, \"Exit\");\n", "stats": " .../broadcom/brcm80211/brcmfmac/cfg80211.c         | 26 +---------------------\n 1 file changed, 1 insertion(+), 25 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "a373f38cd1f5e86cae86157f0b77cf731c5049c1"}, "tag": "linux", "timestamp": 1699830682.35213, "updated_on": 1664258947.0, "uuid": "5fcf582c8050d13b4de4de16ab93614a3c7be6d6"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Jens Axboe <axboe@kernel.dk>", "AuthorDate": "Mon Jun 13 04:42:56 2022 -0600", "Commit": "Jens Axboe <axboe@kernel.dk>", "CommitDate": "Sun Jul 24 18:39:16 2022 -0600", "Signed-off-by": ["Jens Axboe <axboe@kernel.dk>"], "commit": "f110ed8498afa6ff8e9a8c08fb26880e02117616", "files": [{"action": "M", "added": "51", "file": "io_uring/filetable.c", "indexes": ["534e1a3c625d", "abaa5ba7f655"], "modes": ["100644", "100644"], "removed": "15"}, {"action": "M", "added": "3", "file": "io_uring/filetable.h", "indexes": ["fb5a274c08ff", "79eb50c1980e"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "4", "file": "io_uring/openclose.c", "indexes": ["099a5ec84dfd", "d1818ec9169b"], "modes": ["100644", "100644"], "removed": "31"}, {"action": "M", "added": "1", "file": "io_uring/openclose.h", "indexes": ["9f578f3fad87", "4b1c28d3a66c"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "1", "file": "io_uring/rsrc.c", "indexes": ["110608955159", "706fa020505b"], "modes": ["100644", "100644"], "removed": "1"}], "message": "io_uring: split out fixed file installation and removal\n\nPut it with the filetable code, which is where it belongs. While doing\nso, have the helpers take a ctx rather than an io_kiocb. It doesn't make\nsense to use a request, as it's not an operation on the request itself.\nIt applies to the ring itself.\n\nSigned-off-by: Jens Axboe <axboe@kernel.dk>", "parents": ["8fcf4c48f44bd7b1b75db139f56ff1ad6477379e"], "refs": [], "diff": "diff --git a/io_uring/filetable.c b/io_uring/filetable.c\nindex 534e1a3c625d..abaa5ba7f655 100644\n--- a/io_uring/filetable.c\n+++ b/io_uring/filetable.c\n@@ -58,11 +58,10 @@ void io_free_file_tables(struct io_file_table *table)\n \ttable->bitmap = NULL;\n }\n \n-static int io_install_fixed_file(struct io_kiocb *req, struct file *file,\n-\t\t\t\t unsigned int issue_flags, u32 slot_index)\n+static int io_install_fixed_file(struct io_ring_ctx *ctx, struct file *file,\n+\t\t\t\t u32 slot_index)\n \t__must_hold(&req->ctx->uring_lock)\n {\n-\tstruct io_ring_ctx *ctx = req->ctx;\n \tbool needs_switch = false;\n \tstruct io_fixed_file *file_slot;\n \tint ret;\n@@ -108,34 +107,71 @@ static int io_install_fixed_file(struct io_kiocb *req, struct file *file,\n \treturn ret;\n }\n \n-/*\n- * Note when io_fixed_fd_install() returns error value, it will ensure\n- * fput() is called correspondingly.\n- */\n-int io_fixed_fd_install(struct io_kiocb *req, unsigned int issue_flags,\n-\t\t\tstruct file *file, unsigned int file_slot)\n+int __io_fixed_fd_install(struct io_ring_ctx *ctx, struct file *file,\n+\t\t\t  unsigned int file_slot)\n {\n \tbool alloc_slot = file_slot == IORING_FILE_INDEX_ALLOC;\n-\tstruct io_ring_ctx *ctx = req->ctx;\n \tint ret;\n \n-\tio_ring_submit_lock(ctx, issue_flags);\n-\n \tif (alloc_slot) {\n \t\tret = io_file_bitmap_get(ctx);\n \t\tif (unlikely(ret < 0))\n-\t\t\tgoto err;\n+\t\t\treturn ret;\n \t\tfile_slot = ret;\n \t} else {\n \t\tfile_slot--;\n \t}\n \n-\tret = io_install_fixed_file(req, file, issue_flags, file_slot);\n+\tret = io_install_fixed_file(ctx, file, file_slot);\n \tif (!ret && alloc_slot)\n \t\tret = file_slot;\n-err:\n+\treturn ret;\n+}\n+/*\n+ * Note when io_fixed_fd_install() returns error value, it will ensure\n+ * fput() is called correspondingly.\n+ */\n+int io_fixed_fd_install(struct io_kiocb *req, unsigned int issue_flags,\n+\t\t\tstruct file *file, unsigned int file_slot)\n+{\n+\tstruct io_ring_ctx *ctx = req->ctx;\n+\tint ret;\n+\n+\tio_ring_submit_lock(ctx, issue_flags);\n+\tret = __io_fixed_fd_install(ctx, file, file_slot);\n \tio_ring_submit_unlock(ctx, issue_flags);\n+\n \tif (unlikely(ret < 0))\n \t\tfput(file);\n \treturn ret;\n }\n+\n+int io_fixed_fd_remove(struct io_ring_ctx *ctx, unsigned int offset)\n+{\n+\tstruct io_fixed_file *file_slot;\n+\tstruct file *file;\n+\tint ret;\n+\n+\tif (unlikely(!ctx->file_data))\n+\t\treturn -ENXIO;\n+\tif (offset >= ctx->nr_user_files)\n+\t\treturn -EINVAL;\n+\tret = io_rsrc_node_switch_start(ctx);\n+\tif (ret)\n+\t\treturn ret;\n+\n+\toffset = array_index_nospec(offset, ctx->nr_user_files);\n+\tfile_slot = io_fixed_file_slot(&ctx->file_table, offset);\n+\tif (!file_slot->file_ptr)\n+\t\treturn -EBADF;\n+\n+\tfile = (struct file *)(file_slot->file_ptr & FFS_MASK);\n+\tret = io_queue_rsrc_removal(ctx->file_data, offset, ctx->rsrc_node, file);\n+\tif (ret)\n+\t\treturn ret;\n+\n+\tfile_slot->file_ptr = 0;\n+\tio_file_bitmap_clear(&ctx->file_table, offset);\n+\tio_rsrc_node_switch(ctx, ctx->file_data);\n+\treturn 0;\n+}\ndiff --git a/io_uring/filetable.h b/io_uring/filetable.h\nindex fb5a274c08ff..79eb50c1980e 100644\n--- a/io_uring/filetable.h\n+++ b/io_uring/filetable.h\n@@ -29,6 +29,9 @@ void io_free_file_tables(struct io_file_table *table);\n \n int io_fixed_fd_install(struct io_kiocb *req, unsigned int issue_flags,\n \t\t\tstruct file *file, unsigned int file_slot);\n+int __io_fixed_fd_install(struct io_ring_ctx *ctx, struct file *file,\n+\t\t\t\tunsigned int file_slot);\n+int io_fixed_fd_remove(struct io_ring_ctx *ctx, unsigned int offset);\n \n unsigned int io_file_get_flags(struct file *file);\n \ndiff --git a/io_uring/openclose.c b/io_uring/openclose.c\nindex 099a5ec84dfd..d1818ec9169b 100644\n--- a/io_uring/openclose.c\n+++ b/io_uring/openclose.c\n@@ -173,42 +173,15 @@ void io_open_cleanup(struct io_kiocb *req)\n \t\tputname(open->filename);\n }\n \n-int __io_close_fixed(struct io_kiocb *req, unsigned int issue_flags,\n+int __io_close_fixed(struct io_ring_ctx *ctx, unsigned int issue_flags,\n \t\t     unsigned int offset)\n {\n-\tstruct io_ring_ctx *ctx = req->ctx;\n-\tstruct io_fixed_file *file_slot;\n-\tstruct file *file;\n \tint ret;\n \n \tio_ring_submit_lock(ctx, issue_flags);\n-\tret = -ENXIO;\n-\tif (unlikely(!ctx->file_data))\n-\t\tgoto out;\n-\tret = -EINVAL;\n-\tif (offset >= ctx->nr_user_files)\n-\t\tgoto out;\n-\tret = io_rsrc_node_switch_start(ctx);\n-\tif (ret)\n-\t\tgoto out;\n-\n-\toffset = array_index_nospec(offset, ctx->nr_user_files);\n-\tfile_slot = io_fixed_file_slot(&ctx->file_table, offset);\n-\tret = -EBADF;\n-\tif (!file_slot->file_ptr)\n-\t\tgoto out;\n-\n-\tfile = (struct file *)(file_slot->file_ptr & FFS_MASK);\n-\tret = io_queue_rsrc_removal(ctx->file_data, offset, ctx->rsrc_node, file);\n-\tif (ret)\n-\t\tgoto out;\n-\n-\tfile_slot->file_ptr = 0;\n-\tio_file_bitmap_clear(&ctx->file_table, offset);\n-\tio_rsrc_node_switch(ctx, ctx->file_data);\n-\tret = 0;\n-out:\n+\tret = io_fixed_fd_remove(ctx, offset);\n \tio_ring_submit_unlock(ctx, issue_flags);\n+\n \treturn ret;\n }\n \n@@ -216,7 +189,7 @@ static inline int io_close_fixed(struct io_kiocb *req, unsigned int issue_flags)\n {\n \tstruct io_close *close = io_kiocb_to_cmd(req);\n \n-\treturn __io_close_fixed(req, issue_flags, close->file_slot - 1);\n+\treturn __io_close_fixed(req->ctx, issue_flags, close->file_slot - 1);\n }\n \n int io_close_prep(struct io_kiocb *req, const struct io_uring_sqe *sqe)\ndiff --git a/io_uring/openclose.h b/io_uring/openclose.h\nindex 9f578f3fad87..4b1c28d3a66c 100644\n--- a/io_uring/openclose.h\n+++ b/io_uring/openclose.h\n@@ -1,6 +1,6 @@\n // SPDX-License-Identifier: GPL-2.0\n \n-int __io_close_fixed(struct io_kiocb *req, unsigned int issue_flags,\n+int __io_close_fixed(struct io_ring_ctx *ctx, unsigned int issue_flags,\n \t\t     unsigned int offset);\n \n int io_openat_prep(struct io_kiocb *req, const struct io_uring_sqe *sqe);\ndiff --git a/io_uring/rsrc.c b/io_uring/rsrc.c\nindex 110608955159..706fa020505b 100644\n--- a/io_uring/rsrc.c\n+++ b/io_uring/rsrc.c\n@@ -703,7 +703,7 @@ static int io_files_update_with_index_alloc(struct io_kiocb *req,\n \t\tif (ret < 0)\n \t\t\tbreak;\n \t\tif (copy_to_user(&fds[done], &ret, sizeof(ret))) {\n-\t\t\t__io_close_fixed(req, issue_flags, ret);\n+\t\t\t__io_close_fixed(req->ctx, issue_flags, ret);\n \t\t\tret = -EFAULT;\n \t\t\tbreak;\n \t\t}\n", "stats": " io_uring/filetable.c | 66 ++++++++++++++++++++++++++++++++++++++++------------\n io_uring/filetable.h |  3 +++\n io_uring/openclose.c | 35 ++++------------------------\n io_uring/openclose.h |  2 +-\n io_uring/rsrc.c      |  2 +-\n 5 files changed, 60 insertions(+), 48 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "f110ed8498afa6ff8e9a8c08fb26880e02117616"}, "tag": "linux", "timestamp": 1699830483.220648, "updated_on": 1658709556.0, "uuid": "1b74b2b0f17cf3e4fc00671818dd8345c3bf7ebf"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Yury Norov <yury.norov@gmail.com>", "AuthorDate": "Sat Aug 14 14:17:05 2021 -0700", "Commit": "Yury Norov <yury.norov@gmail.com>", "CommitDate": "Sat Jan 15 08:47:31 2022 -0800", "Signed-off-by": ["Yury Norov <yury.norov@gmail.com>"], "commit": "9b51d9d866482a703646fd4c07e433c3d9d88efd", "files": [{"action": "M", "added": "1", "file": "block/blk-mq.c", "indexes": ["8874a63ae952", "ef56e753ab38"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "1", "file": "drivers/net/virtio_net.c", "indexes": ["b107835242ad", "8c70ab3c436a"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "1", "file": "drivers/soc/fsl/qbman/bman_portal.c", "indexes": ["acda8a5637c5", "4d7b9caee1c4"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "1", "file": "drivers/soc/fsl/qbman/qman_portal.c", "indexes": ["96f74a1dc603", "e23b60618c1a"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "16", "file": "include/linux/cpumask.h", "indexes": ["c4e1b9ea0ba4", "64dae70d31f5"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "2", "file": "kernel/time/clocksource.c", "indexes": ["b8a14d2fb5ba", "f29d1a524fa5"], "modes": ["100644", "100644"], "removed": "2"}], "message": "cpumask: replace cpumask_next_* with cpumask_first_* where appropriate\n\ncpumask_first() is a more effective analogue of 'next' version if n == -1\n(which means start == 0). This patch replaces 'next' with 'first' where\nthings look trivial.\n\nThere's no cpumask_first_zero() function, so create it.\n\nSigned-off-by: Yury Norov <yury.norov@gmail.com>\nTested-by: Wolfram Sang <wsa+renesas@sang-engineering.com>", "parents": ["4ade0818cf048bb166e875ed4f8b456e6c2c7b3c"], "refs": [], "diff": "diff --git a/block/blk-mq.c b/block/blk-mq.c\nindex 8874a63ae952..ef56e753ab38 100644\n--- a/block/blk-mq.c\n+++ b/block/blk-mq.c\n@@ -2967,7 +2967,7 @@ static bool blk_mq_hctx_has_requests(struct blk_mq_hw_ctx *hctx)\n static inline bool blk_mq_last_cpu_in_hctx(unsigned int cpu,\n \t\tstruct blk_mq_hw_ctx *hctx)\n {\n-\tif (cpumask_next_and(-1, hctx->cpumask, cpu_online_mask) != cpu)\n+\tif (cpumask_first_and(hctx->cpumask, cpu_online_mask) != cpu)\n \t\treturn false;\n \tif (cpumask_next_and(cpu, hctx->cpumask, cpu_online_mask) < nr_cpu_ids)\n \t\treturn false;\ndiff --git a/drivers/net/virtio_net.c b/drivers/net/virtio_net.c\nindex b107835242ad..8c70ab3c436a 100644\n--- a/drivers/net/virtio_net.c\n+++ b/drivers/net/virtio_net.c\n@@ -2101,7 +2101,7 @@ static void virtnet_set_affinity(struct virtnet_info *vi)\n \tstragglers = num_cpu >= vi->curr_queue_pairs ?\n \t\t\tnum_cpu % vi->curr_queue_pairs :\n \t\t\t0;\n-\tcpu = cpumask_next(-1, cpu_online_mask);\n+\tcpu = cpumask_first(cpu_online_mask);\n \n \tfor (i = 0; i < vi->curr_queue_pairs; i++) {\n \t\tgroup_size = stride + (i < stragglers ? 1 : 0);\ndiff --git a/drivers/soc/fsl/qbman/bman_portal.c b/drivers/soc/fsl/qbman/bman_portal.c\nindex acda8a5637c5..4d7b9caee1c4 100644\n--- a/drivers/soc/fsl/qbman/bman_portal.c\n+++ b/drivers/soc/fsl/qbman/bman_portal.c\n@@ -155,7 +155,7 @@ static int bman_portal_probe(struct platform_device *pdev)\n \t}\n \n \tspin_lock(&bman_lock);\n-\tcpu = cpumask_next_zero(-1, &portal_cpus);\n+\tcpu = cpumask_first_zero(&portal_cpus);\n \tif (cpu >= nr_cpu_ids) {\n \t\t__bman_portals_probed = 1;\n \t\t/* unassigned portal, skip init */\ndiff --git a/drivers/soc/fsl/qbman/qman_portal.c b/drivers/soc/fsl/qbman/qman_portal.c\nindex 96f74a1dc603..e23b60618c1a 100644\n--- a/drivers/soc/fsl/qbman/qman_portal.c\n+++ b/drivers/soc/fsl/qbman/qman_portal.c\n@@ -248,7 +248,7 @@ static int qman_portal_probe(struct platform_device *pdev)\n \tpcfg->pools = qm_get_pools_sdqcr();\n \n \tspin_lock(&qman_lock);\n-\tcpu = cpumask_next_zero(-1, &portal_cpus);\n+\tcpu = cpumask_first_zero(&portal_cpus);\n \tif (cpu >= nr_cpu_ids) {\n \t\t__qman_portals_probed = 1;\n \t\t/* unassigned portal, skip init */\ndiff --git a/include/linux/cpumask.h b/include/linux/cpumask.h\nindex c4e1b9ea0ba4..64dae70d31f5 100644\n--- a/include/linux/cpumask.h\n+++ b/include/linux/cpumask.h\n@@ -123,6 +123,11 @@ static inline unsigned int cpumask_first(const struct cpumask *srcp)\n \treturn 0;\n }\n \n+static inline unsigned int cpumask_first_zero(const struct cpumask *srcp)\n+{\n+\treturn 0;\n+}\n+\n static inline unsigned int cpumask_first_and(const struct cpumask *srcp1,\n \t\t\t\t\t     const struct cpumask *srcp2)\n {\n@@ -201,6 +206,17 @@ static inline unsigned int cpumask_first(const struct cpumask *srcp)\n \treturn find_first_bit(cpumask_bits(srcp), nr_cpumask_bits);\n }\n \n+/**\n+ * cpumask_first_zero - get the first unset cpu in a cpumask\n+ * @srcp: the cpumask pointer\n+ *\n+ * Returns >= nr_cpu_ids if all cpus are set.\n+ */\n+static inline unsigned int cpumask_first_zero(const struct cpumask *srcp)\n+{\n+\treturn find_first_zero_bit(cpumask_bits(srcp), nr_cpumask_bits);\n+}\n+\n /**\n  * cpumask_first_and - return the first cpu from *srcp1 & *srcp2\n  * @src1p: the first input\ndiff --git a/kernel/time/clocksource.c b/kernel/time/clocksource.c\nindex b8a14d2fb5ba..f29d1a524fa5 100644\n--- a/kernel/time/clocksource.c\n+++ b/kernel/time/clocksource.c\n@@ -257,7 +257,7 @@ static void clocksource_verify_choose_cpus(void)\n \t\treturn;\n \n \t/* Make sure to select at least one CPU other than the current CPU. */\n-\tcpu = cpumask_next(-1, cpu_online_mask);\n+\tcpu = cpumask_first(cpu_online_mask);\n \tif (cpu == smp_processor_id())\n \t\tcpu = cpumask_next(cpu, cpu_online_mask);\n \tif (WARN_ON_ONCE(cpu >= nr_cpu_ids))\n@@ -279,7 +279,7 @@ static void clocksource_verify_choose_cpus(void)\n \t\tcpu = prandom_u32() % nr_cpu_ids;\n \t\tcpu = cpumask_next(cpu - 1, cpu_online_mask);\n \t\tif (cpu >= nr_cpu_ids)\n-\t\t\tcpu = cpumask_next(-1, cpu_online_mask);\n+\t\t\tcpu = cpumask_first(cpu_online_mask);\n \t\tif (!WARN_ON_ONCE(cpu >= nr_cpu_ids))\n \t\t\tcpumask_set_cpu(cpu, &cpus_chosen);\n \t}\n", "stats": " block/blk-mq.c                      |  2 +-\n drivers/net/virtio_net.c            |  2 +-\n drivers/soc/fsl/qbman/bman_portal.c |  2 +-\n drivers/soc/fsl/qbman/qman_portal.c |  2 +-\n include/linux/cpumask.h             | 16 ++++++++++++++++\n kernel/time/clocksource.c           |  4 ++--\n 6 files changed, 22 insertions(+), 6 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "9b51d9d866482a703646fd4c07e433c3d9d88efd"}, "tag": "linux", "timestamp": 1699830021.976694, "updated_on": 1642265251.0, "uuid": "5cdd73b925f13fdafa8dc00dcfacddae2f7240d7"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Jisheng Zhang <jszhang@kernel.org>", "AuthorDate": "Mon Dec 6 23:03:53 2021 +0800", "Commit": "Palmer Dabbelt <palmer@rivosinc.com>", "CommitDate": "Wed Jan 19 09:56:35 2022 -0800", "Signed-off-by": ["Jisheng Zhang <jszhang@kernel.org>", "Palmer Dabbelt <palmer@rivosinc.com>"], "commit": "805a3ebed59f81155ded218648db58bdc886a881", "files": [{"action": "M", "added": "3", "file": "arch/riscv/mm/init.c", "indexes": ["b20d6d2e184c", "c1fffec37749"], "modes": ["100644", "100644"], "removed": "8"}], "message": "riscv: mm: init: try best to remove #ifdef CONFIG_XIP_KERNEL usage\n\nCurrently, the #ifdef CONFIG_XIP_KERNEL usage can be divided into the\nfollowing three types:\n\nThe first one is for functions/declarations only used in XIP case.\n\nThe second one is for XIP_FIXUP case. Something as below:\n|foo_type foo;\n|#ifdef CONFIG_XIP_KERNEL\n|#define foo    (*(foo_type *)XIP_FIXUP(&foo))\n|#endif\n\nUsually, it's better to let the foo macro sit with the foo var\ntogether. But if various foos are defined adjacently, we can\nsave some #ifdef CONFIG_XIP_KERNEL usage by grouping them together.\n\nThe third one is for different implementations for XIP, usually, this\nis a #ifdef...#else...#endif case.\n\nThis patch moves the pt_ops macro to adjacent #ifdef CONFIG_XIP_KERNEL\nand group first type usage cases into one.\n\nSigned-off-by: Jisheng Zhang <jszhang@kernel.org>\nReviewed-by: Alexandre Ghiti <alex@ghiti.fr>\nSigned-off-by: Palmer Dabbelt <palmer@rivosinc.com>", "parents": ["fe036db7d8a93cfbfd254f76e0ecf81aecbbf6b4"], "refs": [], "diff": "diff --git a/arch/riscv/mm/init.c b/arch/riscv/mm/init.c\nindex b20d6d2e184c..c1fffec37749 100644\n--- a/arch/riscv/mm/init.c\n+++ b/arch/riscv/mm/init.c\n@@ -40,10 +40,6 @@ EXPORT_SYMBOL(kernel_map);\n phys_addr_t phys_ram_base __ro_after_init;\n EXPORT_SYMBOL(phys_ram_base);\n \n-#ifdef CONFIG_XIP_KERNEL\n-extern char _xiprom[], _exiprom[], __data_loc;\n-#endif\n-\n unsigned long empty_zero_page[PAGE_SIZE / sizeof(unsigned long)]\n \t\t\t\t\t\t\t__page_aligned_bss;\n EXPORT_SYMBOL(empty_zero_page);\n@@ -227,10 +223,6 @@ static void __init setup_bootmem(void)\n #ifdef CONFIG_MMU\n static struct pt_alloc_ops pt_ops __initdata;\n \n-#ifdef CONFIG_XIP_KERNEL\n-#define pt_ops (*(struct pt_alloc_ops *)XIP_FIXUP(&pt_ops))\n-#endif\n-\n unsigned long riscv_pfn_base __ro_after_init;\n EXPORT_SYMBOL(riscv_pfn_base);\n \n@@ -242,6 +234,7 @@ pgd_t early_pg_dir[PTRS_PER_PGD] __initdata __aligned(PAGE_SIZE);\n static pmd_t __maybe_unused early_dtb_pmd[PTRS_PER_PMD] __initdata __aligned(PAGE_SIZE);\n \n #ifdef CONFIG_XIP_KERNEL\n+#define pt_ops\t\t\t(*(struct pt_alloc_ops *)XIP_FIXUP(&pt_ops))\n #define trampoline_pg_dir      ((pgd_t *)XIP_FIXUP(trampoline_pg_dir))\n #define fixmap_pte             ((pte_t *)XIP_FIXUP(fixmap_pte))\n #define early_pg_dir           ((pgd_t *)XIP_FIXUP(early_pg_dir))\n@@ -446,6 +439,8 @@ static uintptr_t __init best_map_size(phys_addr_t base, phys_addr_t size)\n }\n \n #ifdef CONFIG_XIP_KERNEL\n+extern char _xiprom[], _exiprom[], __data_loc;\n+\n /* called from head.S with MMU off */\n asmlinkage void __init __copy_data(void)\n {\n", "stats": " arch/riscv/mm/init.c | 11 +++--------\n 1 file changed, 3 insertions(+), 8 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "805a3ebed59f81155ded218648db58bdc886a881"}, "tag": "linux", "timestamp": 1699830016.427978, "updated_on": 1642614995.0, "uuid": "3282d9e142a8b7c33cd30ff4d97dab2937ad0858"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Ajye Huang <ajye_huang@compal.corp-partner.google.com>", "AuthorDate": "Thu Jan 20 17:02:26 2022 -0600", "Commit": "Mark Brown <broonie@kernel.org>", "CommitDate": "Mon Jan 24 13:31:47 2022 +0000", "Signed-off-by": ["Ajye Huang <ajye_huang@compal.corp-partner.google.com>", "Brent Lu <brent.lu@intel.com>", "Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>", "Mark Brown <broonie@kernel.org>"], "commit": "c8e98eaf2bcb91291b309f7f703dea345cae1411", "files": [{"action": "M", "added": "8", "file": "sound/soc/intel/boards/sof_rt5682.c", "indexes": ["8391bea8ec79", "70541caa7237"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "6", "file": "sound/soc/intel/common/soc-acpi-intel-adl-match.c", "indexes": ["f32bcb2b2e09", "20257f547275"], "modes": ["100644", "100644"], "removed": "0"}], "message": "ASoC: Intel: sof_rt5682: Add support for platform without amplifier\n\nAdd a board config adl_rt5682 to support alc5682 headset codec without\nspeaker amplifier. Follow Intel BT offload design by connecting\nalc5682 to SSP0.\n\nReviewed-by: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>\nSigned-off-by: Ajye Huang <ajye_huang@compal.corp-partner.google.com>\nSigned-off-by: Brent Lu <brent.lu@intel.com>\nSigned-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>\nLink: https://lore.kernel.org/r/20220120230226.175906-3-pierre-louis.bossart@linux.intel.com\nSigned-off-by: Mark Brown <broonie@kernel.org>", "parents": ["22cefca393ea3256fa7afb97cca39d5a088053f4"], "refs": [], "diff": "diff --git a/sound/soc/intel/boards/sof_rt5682.c b/sound/soc/intel/boards/sof_rt5682.c\nindex 8391bea8ec79..70541caa7237 100644\n--- a/sound/soc/intel/boards/sof_rt5682.c\n+++ b/sound/soc/intel/boards/sof_rt5682.c\n@@ -1045,6 +1045,14 @@ static const struct platform_device_id board_ids[] = {\n \t\t\t\t\tSOF_BT_OFFLOAD_SSP(2) |\n \t\t\t\t\tSOF_SSP_BT_OFFLOAD_PRESENT),\n \t},\n+\t{\n+\t\t.name = \"adl_rt5682\",\n+\t\t.driver_data = (kernel_ulong_t)(SOF_RT5682_MCLK_EN |\n+\t\t\t\t\tSOF_RT5682_SSP_CODEC(0) |\n+\t\t\t\t\tSOF_RT5682_NUM_HDMIDEV(4) |\n+\t\t\t\t\tSOF_BT_OFFLOAD_SSP(2) |\n+\t\t\t\t\tSOF_SSP_BT_OFFLOAD_PRESENT),\n+\t},\n \t{ }\n };\n MODULE_DEVICE_TABLE(platform, board_ids);\ndiff --git a/sound/soc/intel/common/soc-acpi-intel-adl-match.c b/sound/soc/intel/common/soc-acpi-intel-adl-match.c\nindex f32bcb2b2e09..20257f547275 100644\n--- a/sound/soc/intel/common/soc-acpi-intel-adl-match.c\n+++ b/sound/soc/intel/common/soc-acpi-intel-adl-match.c\n@@ -447,6 +447,12 @@ struct snd_soc_acpi_mach snd_soc_acpi_intel_adl_machines[] = {\n \t\t.sof_fw_filename = \"sof-adl.ri\",\n \t\t.sof_tplg_filename = \"sof-adl-max98390-rt5682.tplg\",\n \t},\n+\t{\n+\t\t.comp_ids = &adl_rt5682_rt5682s_hp,\n+\t\t.drv_name = \"adl_rt5682\",\n+\t\t.sof_fw_filename = \"sof-adl.ri\",\n+\t\t.sof_tplg_filename = \"sof-adl-rt5682.tplg\",\n+\t},\n \t{},\n };\n EXPORT_SYMBOL_GPL(snd_soc_acpi_intel_adl_machines);\n", "stats": " sound/soc/intel/boards/sof_rt5682.c               | 8 ++++++++\n sound/soc/intel/common/soc-acpi-intel-adl-match.c | 6 ++++++\n 2 files changed, 14 insertions(+)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "c8e98eaf2bcb91291b309f7f703dea345cae1411"}, "tag": "linux", "timestamp": 1699830098.702792, "updated_on": 1643031107.0, "uuid": "f49052d7580512a1b73b27f4bd3127b67c848782"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Christophe JAILLET <christophe.jaillet@wanadoo.fr>", "AuthorDate": "Sat Mar 19 08:01:24 2022 +0100", "Commit": "Martin K. Petersen <martin.petersen@oracle.com>", "CommitDate": "Wed Mar 30 00:05:42 2022 -0400", "Signed-off-by": ["Christophe JAILLET <christophe.jaillet@wanadoo.fr>", "Martin K. Petersen <martin.petersen@oracle.com>"], "commit": "16ed828b872d12ccba8f07bcc446ae89ba662f9c", "files": [{"action": "M", "added": "2", "file": "drivers/scsi/zorro7xx.c", "indexes": ["27b9e2baab1a", "7acf9193a9e8"], "modes": ["100644", "100644"], "removed": "0"}], "message": "scsi: zorro7xx: Fix a resource leak in zorro7xx_remove_one()\n\nThe error handling path of the probe releases a resource that is not freed\nin the remove function. In some cases, a ioremap() must be undone.\n\nAdd the missing iounmap() call in the remove function.\n\nLink: https://lore.kernel.org/r/247066a3104d25f9a05de8b3270fc3c848763bcc.1647673264.git.christophe.jaillet@wanadoo.fr\nFixes: 45804fbb00ee (\"[SCSI] 53c700: Amiga Zorro NCR53c710 SCSI\")\nReviewed-by: Geert Uytterhoeven <geert@linux-m68k.org>\nSigned-off-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>\nSigned-off-by: Martin K. Petersen <martin.petersen@oracle.com>", "parents": ["37a9bd7090cdf6657ced3f693897819a66ee8d52"], "refs": [], "diff": "diff --git a/drivers/scsi/zorro7xx.c b/drivers/scsi/zorro7xx.c\nindex 27b9e2baab1a..7acf9193a9e8 100644\n--- a/drivers/scsi/zorro7xx.c\n+++ b/drivers/scsi/zorro7xx.c\n@@ -159,6 +159,8 @@ static void zorro7xx_remove_one(struct zorro_dev *z)\n \tscsi_remove_host(host);\n \n \tNCR_700_release(host);\n+\tif (host->base > 0x01000000)\n+\t\tiounmap(hostdata->base);\n \tkfree(hostdata);\n \tfree_irq(host->irq, host);\n \tzorro_release_device(z);\n", "stats": " drivers/scsi/zorro7xx.c | 2 ++\n 1 file changed, 2 insertions(+)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "16ed828b872d12ccba8f07bcc446ae89ba662f9c"}, "tag": "linux", "timestamp": 1699830222.855859, "updated_on": 1648613142.0, "uuid": "cc67bae786060ea74de94be3c71e904ba00d4088"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Paul E. McKenney <paulmck@kernel.org>", "AuthorDate": "Fri Mar 25 16:39:01 2022 -0700", "Commit": "Paul E. McKenney <paulmck@kernel.org>", "CommitDate": "Wed Apr 20 16:53:19 2022 -0700", "Signed-off-by": ["Paul E. McKenney <paulmck@kernel.org>"], "commit": "4df002d908796c1ff87b985af1d31a0e36e6c66f", "files": [{"action": "M", "added": "0", "file": "kernel/rcu/Kconfig.debug", "indexes": ["dceaa3e754e5", "71e73fceff87"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "11", "file": "kernel/rcu/rcuscale.c", "indexes": ["5e4f1f83d38e", "311dbcb064ed"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "2", "file": "tools/testing/selftests/rcutorture/configs/rcuscale/CFcommon", "indexes": ["90942bb5bebc", "2ed3b46a9c37"], "modes": ["100644", "100644"], "removed": "2"}, {"action": "M", "added": "2", "file": "tools/testing/selftests/rcutorture/configs/rcuscale/TREE", "indexes": ["f110d9ffbe4c", "b10706fd03a4"], "modes": ["100644", "100644"], "removed": "0"}], "message": "rcuscale: Allow rcuscale without RCU Tasks\n\nCurrently, a CONFIG_PREEMPT_NONE=y kernel substitutes normal RCU for\nRCU Tasks.  Unless that kernel builds rcuscale, whether built-in or as\na module, in which case RCU Tasks is (unnecessarily) built.  This both\nincreases kernel size and increases the complexity of certain tracing\noperations.  This commit therefore decouples the presence of rcuscale\nfrom the presence of RCU Tasks.\n\nSigned-off-by: Paul E. McKenney <paulmck@kernel.org>", "parents": ["dec86781a54f4a527386a0b86b22e99e2ac67a09"], "refs": [], "diff": "diff --git a/kernel/rcu/Kconfig.debug b/kernel/rcu/Kconfig.debug\nindex dceaa3e754e5..71e73fceff87 100644\n--- a/kernel/rcu/Kconfig.debug\n+++ b/kernel/rcu/Kconfig.debug\n@@ -28,7 +28,6 @@ config RCU_SCALE_TEST\n \tdepends on DEBUG_KERNEL\n \tselect TORTURE_TEST\n \tselect SRCU\n-\tselect TASKS_RCU\n \tselect TASKS_RUDE_RCU\n \tselect TASKS_TRACE_RCU\n \tdefault n\ndiff --git a/kernel/rcu/rcuscale.c b/kernel/rcu/rcuscale.c\nindex 5e4f1f83d38e..311dbcb064ed 100644\n--- a/kernel/rcu/rcuscale.c\n+++ b/kernel/rcu/rcuscale.c\n@@ -268,6 +268,8 @@ static struct rcu_scale_ops srcud_ops = {\n \t.name\t\t= \"srcud\"\n };\n \n+#ifdef CONFIG_TASKS_RCU\n+\n /*\n  * Definitions for RCU-tasks scalability testing.\n  */\n@@ -295,6 +297,14 @@ static struct rcu_scale_ops tasks_ops = {\n \t.name\t\t= \"tasks\"\n };\n \n+#define TASKS_OPS &tasks_ops,\n+\n+#else // #ifdef CONFIG_TASKS_RCU\n+\n+#define TASKS_OPS\n+\n+#endif // #else // #ifdef CONFIG_TASKS_RCU\n+\n /*\n  * Definitions for RCU-tasks-trace scalability testing.\n  */\n@@ -797,7 +807,7 @@ rcu_scale_init(void)\n \tlong i;\n \tint firsterr = 0;\n \tstatic struct rcu_scale_ops *scale_ops[] = {\n-\t\t&rcu_ops, &srcu_ops, &srcud_ops, &tasks_ops, &tasks_tracing_ops\n+\t\t&rcu_ops, &srcu_ops, &srcud_ops, TASKS_OPS &tasks_tracing_ops\n \t};\n \n \tif (!torture_init_begin(scale_type, verbose))\ndiff --git a/tools/testing/selftests/rcutorture/configs/rcuscale/CFcommon b/tools/testing/selftests/rcutorture/configs/rcuscale/CFcommon\nindex 90942bb5bebc..2ed3b46a9c37 100644\n--- a/tools/testing/selftests/rcutorture/configs/rcuscale/CFcommon\n+++ b/tools/testing/selftests/rcutorture/configs/rcuscale/CFcommon\n@@ -1,5 +1,5 @@\n CONFIG_RCU_SCALE_TEST=y\n CONFIG_PRINTK_TIME=y\n CONFIG_TASKS_RCU_GENERIC=y\n-CONFIG_TASKS_RCU=y\n-CONFIG_TASKS_TRACE_RCU=y\n+CONFIG_FORCE_TASKS_RCU=y\n+#CHECK#CONFIG_TASKS_RCU=y\ndiff --git a/tools/testing/selftests/rcutorture/configs/rcuscale/TREE b/tools/testing/selftests/rcutorture/configs/rcuscale/TREE\nindex f110d9ffbe4c..b10706fd03a4 100644\n--- a/tools/testing/selftests/rcutorture/configs/rcuscale/TREE\n+++ b/tools/testing/selftests/rcutorture/configs/rcuscale/TREE\n@@ -16,3 +16,5 @@ CONFIG_RCU_BOOST=n\n CONFIG_DEBUG_OBJECTS_RCU_HEAD=n\n CONFIG_RCU_EXPERT=y\n CONFIG_RCU_TRACE=y\n+CONFIG_KPROBES=n\n+CONFIG_FTRACE=n\n", "stats": " kernel/rcu/Kconfig.debug                                     |  1 -\n kernel/rcu/rcuscale.c                                        | 12 +++++++++++-\n tools/testing/selftests/rcutorture/configs/rcuscale/CFcommon |  4 ++--\n tools/testing/selftests/rcutorture/configs/rcuscale/TREE     |  2 ++\n 4 files changed, 15 insertions(+), 4 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "4df002d908796c1ff87b985af1d31a0e36e6c66f"}, "tag": "linux", "timestamp": 1699830240.258969, "updated_on": 1650498799.0, "uuid": "5a80250102316f29007166ded46e077e53bbf902"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Serge Semin <Sergey.Semin@baikalelectronics.ru>", "AuthorDate": "Fri Jun 24 17:34:25 2022 +0300", "Commit": "Bjorn Helgaas <bhelgaas@google.com>", "CommitDate": "Tue Jul 5 19:00:52 2022 -0500", "Signed-off-by": ["Serge Semin <Sergey.Semin@baikalelectronics.ru>", "Bjorn Helgaas <bhelgaas@google.com>"], "commit": "60b3c27fb9b92b8b55cd8bdcc444c3f7cb556652", "files": [{"action": "M", "added": "6", "file": "drivers/pci/controller/dwc/pci-dra7xx.c", "indexes": ["dfcdeb432dc8", "a174b680b2a7"], "modes": ["100644", "100644"], "removed": "6"}, {"action": "M", "added": "3", "file": "drivers/pci/controller/dwc/pci-exynos.c", "indexes": ["467c8d1cd7e4", "2044d191fba6"], "modes": ["100644", "100644"], "removed": "3"}, {"action": "M", "added": "3", "file": "drivers/pci/controller/dwc/pci-imx6.c", "indexes": ["7a285fb0f619", "5ea01ed4674d"], "modes": ["100644", "100644"], "removed": "3"}, {"action": "M", "added": "10", "file": "drivers/pci/controller/dwc/pci-keystone.c", "indexes": ["d10e5fd0f83c", "c3d88aa27dd4"], "modes": ["100644", "100644"], "removed": "10"}, {"action": "M", "added": "1", "file": "drivers/pci/controller/dwc/pci-layerscape.c", "indexes": ["6a4f0619bb1c", "879b8692f96a"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "1", "file": "drivers/pci/controller/dwc/pci-meson.c", "indexes": ["f44bf347904a", "c1527693bed9"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "3", "file": "drivers/pci/controller/dwc/pcie-al.c", "indexes": ["e8afa50129a8", "b8cb77c9c4bd"], "modes": ["100644", "100644"], "removed": "3"}, {"action": "M", "added": "2", "file": "drivers/pci/controller/dwc/pcie-armada8k.c", "indexes": ["4e2552dcf982", "8b113d3f3095"], "modes": ["100644", "100644"], "removed": "2"}, {"action": "M", "added": "2", "file": "drivers/pci/controller/dwc/pcie-artpec6.c", "indexes": ["2f15441770e1", "98102079e26d"], "modes": ["100644", "100644"], "removed": "2"}, {"action": "M", "added": "18", "file": "drivers/pci/controller/dwc/pcie-designware-host.c", "indexes": ["af4ace7e3579", "1314bb128128"], "modes": ["100644", "100644"], "removed": "18"}, {"action": "M", "added": "1", "file": "drivers/pci/controller/dwc/pcie-designware-plat.c", "indexes": ["abf1afac6064", "97de6ad7f9db"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "15", "file": "drivers/pci/controller/dwc/pcie-designware.h", "indexes": ["13bffa3eaed6", "32df3ebccf19"], "modes": ["100644", "100644"], "removed": "15"}, {"action": "M", "added": "2", "file": "drivers/pci/controller/dwc/pcie-dw-rockchip.c", "indexes": ["8c5bb9d7cc36", "c1e7653e508e"], "modes": ["100644", "100644"], "removed": "2"}, {"action": "M", "added": "1", "file": "drivers/pci/controller/dwc/pcie-fu740.c", "indexes": ["02cc70d8cc06", "da059f1c9e92"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "5", "file": "drivers/pci/controller/dwc/pcie-histb.c", "indexes": ["410555dccb6d", "e2b80f10030d"], "modes": ["100644", "100644"], "removed": "5"}, {"action": "M", "added": "3", "file": "drivers/pci/controller/dwc/pcie-intel-gw.c", "indexes": ["5ba144924ff8", "07bc54886d71"], "modes": ["100644", "100644"], "removed": "3"}, {"action": "M", "added": "2", "file": "drivers/pci/controller/dwc/pcie-keembay.c", "indexes": ["1ac29a6eef22", "58f3caf75cff"], "modes": ["100644", "100644"], "removed": "2"}, {"action": "M", "added": "1", "file": "drivers/pci/controller/dwc/pcie-kirin.c", "indexes": ["a52cad269f85", "7f67aad71df4"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "2", "file": "drivers/pci/controller/dwc/pcie-qcom.c", "indexes": ["2ea13750b492", "a9b2322624d5"], "modes": ["100644", "100644"], "removed": "2"}, {"action": "M", "added": "3", "file": "drivers/pci/controller/dwc/pcie-spear13xx.c", "indexes": ["1569e82b5568", "7fd698da144e"], "modes": ["100644", "100644"], "removed": "3"}, {"action": "M", "added": "11", "file": "drivers/pci/controller/dwc/pcie-tegra194.c", "indexes": ["cc2678490162", "65135f5c4a4a"], "modes": ["100644", "100644"], "removed": "11"}, {"action": "M", "added": "5", "file": "drivers/pci/controller/dwc/pcie-uniphier.c", "indexes": ["b45ac3754242", "48c3eba817b4"], "modes": ["100644", "100644"], "removed": "5"}, {"action": "M", "added": "3", "file": "drivers/pci/controller/dwc/pcie-visconti.c", "indexes": ["50f80f07e4db", "71026fefa366"], "modes": ["100644", "100644"], "removed": "3"}], "message": "PCI: dwc: Rename struct pcie_port to dw_pcie_rp\n\nAll of the DW PCIe core driver entities except the pcie_port struct have\nnames with the \"dw_\" prefix to distinguish local and common PCIe name\nspaces, and endpoint-related entities have an \"_ep\" suffix.\n\nRename struct pcie_port to dw_pcie_rp to make it more consistent with other\nnames.\n\n[bhelgaas: commit log]\nLink: https://lore.kernel.org/r/20220624143428.8334-16-Sergey.Semin@baikalelectronics.ru\nSigned-off-by: Serge Semin <Sergey.Semin@baikalelectronics.ru>\nSigned-off-by: Bjorn Helgaas <bhelgaas@google.com>\nReviewed-by: Rob Herring <robh@kernel.org>\nReviewed-by: Neil Armstrong <narmstrong@baylibre.com>\nReviewed-by: Manivannan Sadhasivam <manivannan.sadhasivam@linaro.org>\nAcked-by: Jesper Nilsson <jesper.nilsson@axis.com>", "parents": ["d6bdbcd8bfe134566035d3eabed915ed27a04320"], "refs": [], "diff": "diff --git a/drivers/pci/controller/dwc/pci-dra7xx.c b/drivers/pci/controller/dwc/pci-dra7xx.c\nindex dfcdeb432dc8..a174b680b2a7 100644\n--- a/drivers/pci/controller/dwc/pci-dra7xx.c\n+++ b/drivers/pci/controller/dwc/pci-dra7xx.c\n@@ -178,7 +178,7 @@ static void dra7xx_pcie_enable_interrupts(struct dra7xx_pcie *dra7xx)\n \tdra7xx_pcie_enable_msi_interrupts(dra7xx);\n }\n \n-static int dra7xx_pcie_host_init(struct pcie_port *pp)\n+static int dra7xx_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct dra7xx_pcie *dra7xx = to_dra7xx_pcie(pci);\n@@ -202,7 +202,7 @@ static const struct irq_domain_ops intx_domain_ops = {\n \t.xlate = pci_irqd_intx_xlate,\n };\n \n-static int dra7xx_pcie_handle_msi(struct pcie_port *pp, int index)\n+static int dra7xx_pcie_handle_msi(struct dw_pcie_rp *pp, int index)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tunsigned long val;\n@@ -224,7 +224,7 @@ static int dra7xx_pcie_handle_msi(struct pcie_port *pp, int index)\n \treturn 1;\n }\n \n-static void dra7xx_pcie_handle_msi_irq(struct pcie_port *pp)\n+static void dra7xx_pcie_handle_msi_irq(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tint ret, i, count, num_ctrls;\n@@ -255,8 +255,8 @@ static void dra7xx_pcie_msi_irq_handler(struct irq_desc *desc)\n {\n \tstruct irq_chip *chip = irq_desc_get_chip(desc);\n \tstruct dra7xx_pcie *dra7xx;\n+\tstruct dw_pcie_rp *pp;\n \tstruct dw_pcie *pci;\n-\tstruct pcie_port *pp;\n \tunsigned long reg;\n \tu32 bit;\n \n@@ -344,7 +344,7 @@ static irqreturn_t dra7xx_pcie_irq_handler(int irq, void *arg)\n \treturn IRQ_HANDLED;\n }\n \n-static int dra7xx_pcie_init_irq_domain(struct pcie_port *pp)\n+static int dra7xx_pcie_init_irq_domain(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct device *dev = pci->dev;\n@@ -475,7 +475,7 @@ static int dra7xx_add_pcie_port(struct dra7xx_pcie *dra7xx,\n {\n \tint ret;\n \tstruct dw_pcie *pci = dra7xx->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tstruct device *dev = pci->dev;\n \n \tpp->irq = platform_get_irq(pdev, 1);\ndiff --git a/drivers/pci/controller/dwc/pci-exynos.c b/drivers/pci/controller/dwc/pci-exynos.c\nindex 467c8d1cd7e4..2044d191fba6 100644\n--- a/drivers/pci/controller/dwc/pci-exynos.c\n+++ b/drivers/pci/controller/dwc/pci-exynos.c\n@@ -249,7 +249,7 @@ static int exynos_pcie_link_up(struct dw_pcie *pci)\n \treturn (val & PCIE_ELBI_XMLH_LINKUP);\n }\n \n-static int exynos_pcie_host_init(struct pcie_port *pp)\n+static int exynos_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct exynos_pcie *ep = to_exynos_pcie(pci);\n@@ -276,7 +276,7 @@ static int exynos_add_pcie_port(struct exynos_pcie *ep,\n \t\t\t\t       struct platform_device *pdev)\n {\n \tstruct dw_pcie *pci = &ep->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tstruct device *dev = &pdev->dev;\n \tint ret;\n \n@@ -406,7 +406,7 @@ static int __maybe_unused exynos_pcie_resume_noirq(struct device *dev)\n {\n \tstruct exynos_pcie *ep = dev_get_drvdata(dev);\n \tstruct dw_pcie *pci = &ep->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tint ret;\n \n \tret = regulator_bulk_enable(ARRAY_SIZE(ep->supplies), ep->supplies);\ndiff --git a/drivers/pci/controller/dwc/pci-imx6.c b/drivers/pci/controller/dwc/pci-imx6.c\nindex 7a285fb0f619..5ea01ed4674d 100644\n--- a/drivers/pci/controller/dwc/pci-imx6.c\n+++ b/drivers/pci/controller/dwc/pci-imx6.c\n@@ -863,7 +863,7 @@ static int imx6_pcie_start_link(struct dw_pcie *pci)\n \treturn ret;\n }\n \n-static int imx6_pcie_host_init(struct pcie_port *pp)\n+static int imx6_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct imx6_pcie *imx6_pcie = to_imx6_pcie(pci);\n@@ -992,7 +992,7 @@ static int imx6_pcie_resume_noirq(struct device *dev)\n {\n \tint ret;\n \tstruct imx6_pcie *imx6_pcie = dev_get_drvdata(dev);\n-\tstruct pcie_port *pp = &imx6_pcie->pci->pp;\n+\tstruct dw_pcie_rp *pp = &imx6_pcie->pci->pp;\n \n \tif (!(imx6_pcie->drvdata->flags & IMX6_PCIE_FLAG_SUPPORTS_SUSPEND))\n \t\treturn 0;\n@@ -1291,7 +1291,7 @@ static struct platform_driver imx6_pcie_driver = {\n static void imx6_pcie_quirk(struct pci_dev *dev)\n {\n \tstruct pci_bus *bus = dev->bus;\n-\tstruct pcie_port *pp = bus->sysdata;\n+\tstruct dw_pcie_rp *pp = bus->sysdata;\n \n \t/* Bus parent is the PCI bridge, its parent is this platform driver */\n \tif (!bus->dev.parent || !bus->dev.parent->parent)\ndiff --git a/drivers/pci/controller/dwc/pci-keystone.c b/drivers/pci/controller/dwc/pci-keystone.c\nindex d10e5fd0f83c..c3d88aa27dd4 100644\n--- a/drivers/pci/controller/dwc/pci-keystone.c\n+++ b/drivers/pci/controller/dwc/pci-keystone.c\n@@ -147,7 +147,7 @@ static void ks_pcie_app_writel(struct keystone_pcie *ks_pcie, u32 offset,\n \n static void ks_pcie_msi_irq_ack(struct irq_data *data)\n {\n-\tstruct pcie_port *pp  = irq_data_get_irq_chip_data(data);\n+\tstruct dw_pcie_rp *pp  = irq_data_get_irq_chip_data(data);\n \tstruct keystone_pcie *ks_pcie;\n \tu32 irq = data->hwirq;\n \tstruct dw_pcie *pci;\n@@ -167,7 +167,7 @@ static void ks_pcie_msi_irq_ack(struct irq_data *data)\n \n static void ks_pcie_compose_msi_msg(struct irq_data *data, struct msi_msg *msg)\n {\n-\tstruct pcie_port *pp = irq_data_get_irq_chip_data(data);\n+\tstruct dw_pcie_rp *pp = irq_data_get_irq_chip_data(data);\n \tstruct keystone_pcie *ks_pcie;\n \tstruct dw_pcie *pci;\n \tu64 msi_target;\n@@ -192,7 +192,7 @@ static int ks_pcie_msi_set_affinity(struct irq_data *irq_data,\n \n static void ks_pcie_msi_mask(struct irq_data *data)\n {\n-\tstruct pcie_port *pp = irq_data_get_irq_chip_data(data);\n+\tstruct dw_pcie_rp *pp = irq_data_get_irq_chip_data(data);\n \tstruct keystone_pcie *ks_pcie;\n \tu32 irq = data->hwirq;\n \tstruct dw_pcie *pci;\n@@ -216,7 +216,7 @@ static void ks_pcie_msi_mask(struct irq_data *data)\n \n static void ks_pcie_msi_unmask(struct irq_data *data)\n {\n-\tstruct pcie_port *pp = irq_data_get_irq_chip_data(data);\n+\tstruct dw_pcie_rp *pp = irq_data_get_irq_chip_data(data);\n \tstruct keystone_pcie *ks_pcie;\n \tu32 irq = data->hwirq;\n \tstruct dw_pcie *pci;\n@@ -247,7 +247,7 @@ static struct irq_chip ks_pcie_msi_irq_chip = {\n \t.irq_unmask = ks_pcie_msi_unmask,\n };\n \n-static int ks_pcie_msi_host_init(struct pcie_port *pp)\n+static int ks_pcie_msi_host_init(struct dw_pcie_rp *pp)\n {\n \tpp->msi_irq_chip = &ks_pcie_msi_irq_chip;\n \treturn dw_pcie_allocate_domains(pp);\n@@ -390,7 +390,7 @@ static void ks_pcie_setup_rc_app_regs(struct keystone_pcie *ks_pcie)\n \tu32 val;\n \tu32 num_viewport = ks_pcie->num_viewport;\n \tstruct dw_pcie *pci = ks_pcie->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tu64 start, end;\n \tstruct resource *mem;\n \tint i;\n@@ -428,7 +428,7 @@ static void ks_pcie_setup_rc_app_regs(struct keystone_pcie *ks_pcie)\n static void __iomem *ks_pcie_other_map_bus(struct pci_bus *bus,\n \t\t\t\t\t   unsigned int devfn, int where)\n {\n-\tstruct pcie_port *pp = bus->sysdata;\n+\tstruct dw_pcie_rp *pp = bus->sysdata;\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct keystone_pcie *ks_pcie = to_keystone_pcie(pci);\n \tu32 reg;\n@@ -456,7 +456,7 @@ static struct pci_ops ks_child_pcie_ops = {\n  */\n static int ks_pcie_v3_65_add_bus(struct pci_bus *bus)\n {\n-\tstruct pcie_port *pp = bus->sysdata;\n+\tstruct dw_pcie_rp *pp = bus->sysdata;\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct keystone_pcie *ks_pcie = to_keystone_pcie(pci);\n \n@@ -574,7 +574,7 @@ static void ks_pcie_msi_irq_handler(struct irq_desc *desc)\n \tstruct keystone_pcie *ks_pcie = irq_desc_get_handler_data(desc);\n \tu32 offset = irq - ks_pcie->msi_host_irq;\n \tstruct dw_pcie *pci = ks_pcie->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tstruct device *dev = pci->dev;\n \tstruct irq_chip *chip = irq_desc_get_chip(desc);\n \tu32 vector, reg, pos;\n@@ -799,7 +799,7 @@ static int __init ks_pcie_init_id(struct keystone_pcie *ks_pcie)\n \treturn 0;\n }\n \n-static int __init ks_pcie_host_init(struct pcie_port *pp)\n+static int __init ks_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct keystone_pcie *ks_pcie = to_keystone_pcie(pci);\ndiff --git a/drivers/pci/controller/dwc/pci-layerscape.c b/drivers/pci/controller/dwc/pci-layerscape.c\nindex 6a4f0619bb1c..879b8692f96a 100644\n--- a/drivers/pci/controller/dwc/pci-layerscape.c\n+++ b/drivers/pci/controller/dwc/pci-layerscape.c\n@@ -74,7 +74,7 @@ static void ls_pcie_fix_error_response(struct ls_pcie *pcie)\n \tiowrite32(PCIE_ABSERR_SETTING, pci->dbi_base + PCIE_ABSERR);\n }\n \n-static int ls_pcie_host_init(struct pcie_port *pp)\n+static int ls_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct ls_pcie *pcie = to_ls_pcie(pci);\ndiff --git a/drivers/pci/controller/dwc/pci-meson.c b/drivers/pci/controller/dwc/pci-meson.c\nindex f44bf347904a..c1527693bed9 100644\n--- a/drivers/pci/controller/dwc/pci-meson.c\n+++ b/drivers/pci/controller/dwc/pci-meson.c\n@@ -370,7 +370,7 @@ static int meson_pcie_link_up(struct dw_pcie *pci)\n \treturn 0;\n }\n \n-static int meson_pcie_host_init(struct pcie_port *pp)\n+static int meson_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct meson_pcie *mp = to_meson_pcie(pci);\ndiff --git a/drivers/pci/controller/dwc/pcie-al.c b/drivers/pci/controller/dwc/pcie-al.c\nindex e8afa50129a8..b8cb77c9c4bd 100644\n--- a/drivers/pci/controller/dwc/pcie-al.c\n+++ b/drivers/pci/controller/dwc/pcie-al.c\n@@ -217,7 +217,7 @@ static inline void al_pcie_target_bus_set(struct al_pcie *pcie,\n static void __iomem *al_pcie_conf_addr_map_bus(struct pci_bus *bus,\n \t\t\t\t\t       unsigned int devfn, int where)\n {\n-\tstruct pcie_port *pp = bus->sysdata;\n+\tstruct dw_pcie_rp *pp = bus->sysdata;\n \tstruct al_pcie *pcie = to_al_pcie(to_dw_pcie_from_pp(pp));\n \tunsigned int busnr = bus->number;\n \tstruct al_pcie_target_bus_cfg *target_bus_cfg = &pcie->target_bus_cfg;\n@@ -245,7 +245,7 @@ static struct pci_ops al_child_pci_ops = {\n static void al_pcie_config_prepare(struct al_pcie *pcie)\n {\n \tstruct al_pcie_target_bus_cfg *target_bus_cfg;\n-\tstruct pcie_port *pp = &pcie->pci->pp;\n+\tstruct dw_pcie_rp *pp = &pcie->pci->pp;\n \tunsigned int ecam_bus_mask;\n \tu32 cfg_control_offset;\n \tu8 subordinate_bus;\n@@ -289,7 +289,7 @@ static void al_pcie_config_prepare(struct al_pcie *pcie)\n \tal_pcie_controller_writel(pcie, cfg_control_offset, reg);\n }\n \n-static int al_pcie_host_init(struct pcie_port *pp)\n+static int al_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct al_pcie *pcie = to_al_pcie(pci);\ndiff --git a/drivers/pci/controller/dwc/pcie-armada8k.c b/drivers/pci/controller/dwc/pcie-armada8k.c\nindex 4e2552dcf982..8b113d3f3095 100644\n--- a/drivers/pci/controller/dwc/pcie-armada8k.c\n+++ b/drivers/pci/controller/dwc/pcie-armada8k.c\n@@ -166,7 +166,7 @@ static int armada8k_pcie_start_link(struct dw_pcie *pci)\n \treturn 0;\n }\n \n-static int armada8k_pcie_host_init(struct pcie_port *pp)\n+static int armada8k_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tu32 reg;\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n@@ -233,7 +233,7 @@ static int armada8k_add_pcie_port(struct armada8k_pcie *pcie,\n \t\t\t\t  struct platform_device *pdev)\n {\n \tstruct dw_pcie *pci = pcie->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tstruct device *dev = &pdev->dev;\n \tint ret;\n \ndiff --git a/drivers/pci/controller/dwc/pcie-artpec6.c b/drivers/pci/controller/dwc/pcie-artpec6.c\nindex 2f15441770e1..98102079e26d 100644\n--- a/drivers/pci/controller/dwc/pcie-artpec6.c\n+++ b/drivers/pci/controller/dwc/pcie-artpec6.c\n@@ -97,7 +97,7 @@ static void artpec6_pcie_writel(struct artpec6_pcie *artpec6_pcie, u32 offset, u\n static u64 artpec6_pcie_cpu_addr_fixup(struct dw_pcie *pci, u64 pci_addr)\n {\n \tstruct artpec6_pcie *artpec6_pcie = to_artpec6_pcie(pci);\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tstruct dw_pcie_ep *ep = &pci->ep;\n \n \tswitch (artpec6_pcie->mode) {\n@@ -315,7 +315,7 @@ static void artpec6_pcie_deassert_core_reset(struct artpec6_pcie *artpec6_pcie)\n \tusleep_range(100, 200);\n }\n \n-static int artpec6_pcie_host_init(struct pcie_port *pp)\n+static int artpec6_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct artpec6_pcie *artpec6_pcie = to_artpec6_pcie(pci);\ndiff --git a/drivers/pci/controller/dwc/pcie-designware-host.c b/drivers/pci/controller/dwc/pcie-designware-host.c\nindex af4ace7e3579..1314bb128128 100644\n--- a/drivers/pci/controller/dwc/pcie-designware-host.c\n+++ b/drivers/pci/controller/dwc/pcie-designware-host.c\n@@ -53,7 +53,7 @@ static struct msi_domain_info dw_pcie_msi_domain_info = {\n };\n \n /* MSI int handler */\n-irqreturn_t dw_handle_msi_irq(struct pcie_port *pp)\n+irqreturn_t dw_handle_msi_irq(struct dw_pcie_rp *pp)\n {\n \tint i, pos;\n \tunsigned long val;\n@@ -88,7 +88,7 @@ irqreturn_t dw_handle_msi_irq(struct pcie_port *pp)\n static void dw_chained_msi_isr(struct irq_desc *desc)\n {\n \tstruct irq_chip *chip = irq_desc_get_chip(desc);\n-\tstruct pcie_port *pp;\n+\tstruct dw_pcie_rp *pp;\n \n \tchained_irq_enter(chip, desc);\n \n@@ -100,7 +100,7 @@ static void dw_chained_msi_isr(struct irq_desc *desc)\n \n static void dw_pci_setup_msi_msg(struct irq_data *d, struct msi_msg *msg)\n {\n-\tstruct pcie_port *pp = irq_data_get_irq_chip_data(d);\n+\tstruct dw_pcie_rp *pp = irq_data_get_irq_chip_data(d);\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tu64 msi_target;\n \n@@ -123,7 +123,7 @@ static int dw_pci_msi_set_affinity(struct irq_data *d,\n \n static void dw_pci_bottom_mask(struct irq_data *d)\n {\n-\tstruct pcie_port *pp = irq_data_get_irq_chip_data(d);\n+\tstruct dw_pcie_rp *pp = irq_data_get_irq_chip_data(d);\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tunsigned int res, bit, ctrl;\n \tunsigned long flags;\n@@ -142,7 +142,7 @@ static void dw_pci_bottom_mask(struct irq_data *d)\n \n static void dw_pci_bottom_unmask(struct irq_data *d)\n {\n-\tstruct pcie_port *pp = irq_data_get_irq_chip_data(d);\n+\tstruct dw_pcie_rp *pp = irq_data_get_irq_chip_data(d);\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tunsigned int res, bit, ctrl;\n \tunsigned long flags;\n@@ -161,7 +161,7 @@ static void dw_pci_bottom_unmask(struct irq_data *d)\n \n static void dw_pci_bottom_ack(struct irq_data *d)\n {\n-\tstruct pcie_port *pp  = irq_data_get_irq_chip_data(d);\n+\tstruct dw_pcie_rp *pp  = irq_data_get_irq_chip_data(d);\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tunsigned int res, bit, ctrl;\n \n@@ -185,7 +185,7 @@ static int dw_pcie_irq_domain_alloc(struct irq_domain *domain,\n \t\t\t\t    unsigned int virq, unsigned int nr_irqs,\n \t\t\t\t    void *args)\n {\n-\tstruct pcie_port *pp = domain->host_data;\n+\tstruct dw_pcie_rp *pp = domain->host_data;\n \tunsigned long flags;\n \tu32 i;\n \tint bit;\n@@ -213,7 +213,7 @@ static void dw_pcie_irq_domain_free(struct irq_domain *domain,\n \t\t\t\t    unsigned int virq, unsigned int nr_irqs)\n {\n \tstruct irq_data *d = irq_domain_get_irq_data(domain, virq);\n-\tstruct pcie_port *pp = domain->host_data;\n+\tstruct dw_pcie_rp *pp = domain->host_data;\n \tunsigned long flags;\n \n \traw_spin_lock_irqsave(&pp->lock, flags);\n@@ -229,7 +229,7 @@ static const struct irq_domain_ops dw_pcie_msi_domain_ops = {\n \t.free\t= dw_pcie_irq_domain_free,\n };\n \n-int dw_pcie_allocate_domains(struct pcie_port *pp)\n+int dw_pcie_allocate_domains(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct fwnode_handle *fwnode = of_node_to_fwnode(pci->dev->of_node);\n@@ -255,7 +255,7 @@ int dw_pcie_allocate_domains(struct pcie_port *pp)\n \treturn 0;\n }\n \n-static void dw_pcie_free_msi(struct pcie_port *pp)\n+static void dw_pcie_free_msi(struct dw_pcie_rp *pp)\n {\n \tif (pp->msi_irq)\n \t\tirq_set_chained_handler_and_data(pp->msi_irq, NULL, NULL);\n@@ -272,7 +272,7 @@ static void dw_pcie_free_msi(struct pcie_port *pp)\n \t}\n }\n \n-static void dw_pcie_msi_init(struct pcie_port *pp)\n+static void dw_pcie_msi_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tu64 msi_target = (u64)pp->msi_data;\n@@ -285,7 +285,7 @@ static void dw_pcie_msi_init(struct pcie_port *pp)\n \tdw_pcie_writel_dbi(pci, PCIE_MSI_ADDR_HI, upper_32_bits(msi_target));\n }\n \n-int dw_pcie_host_init(struct pcie_port *pp)\n+int dw_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct device *dev = pci->dev;\n@@ -436,7 +436,7 @@ int dw_pcie_host_init(struct pcie_port *pp)\n }\n EXPORT_SYMBOL_GPL(dw_pcie_host_init);\n \n-void dw_pcie_host_deinit(struct pcie_port *pp)\n+void dw_pcie_host_deinit(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \n@@ -455,7 +455,7 @@ static void __iomem *dw_pcie_other_conf_map_bus(struct pci_bus *bus,\n {\n \tint type;\n \tu32 busdev;\n-\tstruct pcie_port *pp = bus->sysdata;\n+\tstruct dw_pcie_rp *pp = bus->sysdata;\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \n \t/*\n@@ -487,7 +487,7 @@ static int dw_pcie_rd_other_conf(struct pci_bus *bus, unsigned int devfn,\n \t\t\t\t int where, int size, u32 *val)\n {\n \tint ret;\n-\tstruct pcie_port *pp = bus->sysdata;\n+\tstruct dw_pcie_rp *pp = bus->sysdata;\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \n \tret = pci_generic_config_read(bus, devfn, where, size, val);\n@@ -503,7 +503,7 @@ static int dw_pcie_wr_other_conf(struct pci_bus *bus, unsigned int devfn,\n \t\t\t\t int where, int size, u32 val)\n {\n \tint ret;\n-\tstruct pcie_port *pp = bus->sysdata;\n+\tstruct dw_pcie_rp *pp = bus->sysdata;\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \n \tret = pci_generic_config_write(bus, devfn, where, size, val);\n@@ -523,7 +523,7 @@ static struct pci_ops dw_child_pcie_ops = {\n \n void __iomem *dw_pcie_own_conf_map_bus(struct pci_bus *bus, unsigned int devfn, int where)\n {\n-\tstruct pcie_port *pp = bus->sysdata;\n+\tstruct dw_pcie_rp *pp = bus->sysdata;\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \n \tif (PCI_SLOT(devfn) > 0)\n@@ -539,7 +539,7 @@ static struct pci_ops dw_pcie_ops = {\n \t.write = pci_generic_config_write,\n };\n \n-void dw_pcie_setup_rc(struct pcie_port *pp)\n+void dw_pcie_setup_rc(struct dw_pcie_rp *pp)\n {\n \tu32 val, ctrl, num_ctrls;\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\ndiff --git a/drivers/pci/controller/dwc/pcie-designware-plat.c b/drivers/pci/controller/dwc/pcie-designware-plat.c\nindex abf1afac6064..97de6ad7f9db 100644\n--- a/drivers/pci/controller/dwc/pcie-designware-plat.c\n+++ b/drivers/pci/controller/dwc/pcie-designware-plat.c\n@@ -87,7 +87,7 @@ static int dw_plat_add_pcie_port(struct dw_plat_pcie *dw_plat_pcie,\n \t\t\t\t struct platform_device *pdev)\n {\n \tstruct dw_pcie *pci = dw_plat_pcie->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tstruct device *dev = &pdev->dev;\n \tint ret;\n \ndiff --git a/drivers/pci/controller/dwc/pcie-designware.h b/drivers/pci/controller/dwc/pcie-designware.h\nindex 13bffa3eaed6..32df3ebccf19 100644\n--- a/drivers/pci/controller/dwc/pcie-designware.h\n+++ b/drivers/pci/controller/dwc/pcie-designware.h\n@@ -155,8 +155,8 @@\n #define MAX_IATU_IN\t\t\t256\n #define MAX_IATU_OUT\t\t\t256\n \n-struct pcie_port;\n struct dw_pcie;\n+struct dw_pcie_rp;\n struct dw_pcie_ep;\n \n enum dw_pcie_region_type {\n@@ -173,11 +173,11 @@ enum dw_pcie_device_mode {\n };\n \n struct dw_pcie_host_ops {\n-\tint (*host_init)(struct pcie_port *pp);\n-\tint (*msi_host_init)(struct pcie_port *pp);\n+\tint (*host_init)(struct dw_pcie_rp *pp);\n+\tint (*msi_host_init)(struct dw_pcie_rp *pp);\n };\n \n-struct pcie_port {\n+struct dw_pcie_rp {\n \tbool\t\t\thas_msi_ctrl:1;\n \tbool\t\t\tcfg0_io_shared:1;\n \tu64\t\t\tcfg0_base;\n@@ -267,7 +267,7 @@ struct dw_pcie {\n \tsize_t\t\t\tatu_size;\n \tu32\t\t\tnum_ib_windows;\n \tu32\t\t\tnum_ob_windows;\n-\tstruct pcie_port\tpp;\n+\tstruct dw_pcie_rp\tpp;\n \tstruct dw_pcie_ep\tep;\n \tconst struct dw_pcie_ops *ops;\n \tunsigned int\t\tversion;\n@@ -380,33 +380,33 @@ static inline void dw_pcie_stop_link(struct dw_pcie *pci)\n }\n \n #ifdef CONFIG_PCIE_DW_HOST\n-irqreturn_t dw_handle_msi_irq(struct pcie_port *pp);\n-void dw_pcie_setup_rc(struct pcie_port *pp);\n-int dw_pcie_host_init(struct pcie_port *pp);\n-void dw_pcie_host_deinit(struct pcie_port *pp);\n-int dw_pcie_allocate_domains(struct pcie_port *pp);\n+irqreturn_t dw_handle_msi_irq(struct dw_pcie_rp *pp);\n+void dw_pcie_setup_rc(struct dw_pcie_rp *pp);\n+int dw_pcie_host_init(struct dw_pcie_rp *pp);\n+void dw_pcie_host_deinit(struct dw_pcie_rp *pp);\n+int dw_pcie_allocate_domains(struct dw_pcie_rp *pp);\n void __iomem *dw_pcie_own_conf_map_bus(struct pci_bus *bus, unsigned int devfn,\n \t\t\t\t       int where);\n #else\n-static inline irqreturn_t dw_handle_msi_irq(struct pcie_port *pp)\n+static inline irqreturn_t dw_handle_msi_irq(struct dw_pcie_rp *pp)\n {\n \treturn IRQ_NONE;\n }\n \n-static inline void dw_pcie_setup_rc(struct pcie_port *pp)\n+static inline void dw_pcie_setup_rc(struct dw_pcie_rp *pp)\n {\n }\n \n-static inline int dw_pcie_host_init(struct pcie_port *pp)\n+static inline int dw_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \treturn 0;\n }\n \n-static inline void dw_pcie_host_deinit(struct pcie_port *pp)\n+static inline void dw_pcie_host_deinit(struct dw_pcie_rp *pp)\n {\n }\n \n-static inline int dw_pcie_allocate_domains(struct pcie_port *pp)\n+static inline int dw_pcie_allocate_domains(struct dw_pcie_rp *pp)\n {\n \treturn 0;\n }\ndiff --git a/drivers/pci/controller/dwc/pcie-dw-rockchip.c b/drivers/pci/controller/dwc/pcie-dw-rockchip.c\nindex 8c5bb9d7cc36..c1e7653e508e 100644\n--- a/drivers/pci/controller/dwc/pcie-dw-rockchip.c\n+++ b/drivers/pci/controller/dwc/pcie-dw-rockchip.c\n@@ -186,7 +186,7 @@ static int rockchip_pcie_start_link(struct dw_pcie *pci)\n \treturn 0;\n }\n \n-static int rockchip_pcie_host_init(struct pcie_port *pp)\n+static int rockchip_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct rockchip_pcie *rockchip = to_rockchip_pcie(pci);\n@@ -288,7 +288,7 @@ static int rockchip_pcie_probe(struct platform_device *pdev)\n {\n \tstruct device *dev = &pdev->dev;\n \tstruct rockchip_pcie *rockchip;\n-\tstruct pcie_port *pp;\n+\tstruct dw_pcie_rp *pp;\n \tint ret;\n \n \trockchip = devm_kzalloc(dev, sizeof(*rockchip), GFP_KERNEL);\ndiff --git a/drivers/pci/controller/dwc/pcie-fu740.c b/drivers/pci/controller/dwc/pcie-fu740.c\nindex 02cc70d8cc06..da059f1c9e92 100644\n--- a/drivers/pci/controller/dwc/pcie-fu740.c\n+++ b/drivers/pci/controller/dwc/pcie-fu740.c\n@@ -236,7 +236,7 @@ static int fu740_pcie_start_link(struct dw_pcie *pci)\n \treturn ret;\n }\n \n-static int fu740_pcie_host_init(struct pcie_port *pp)\n+static int fu740_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct fu740_pcie *afp = to_fu740_pcie(pci);\ndiff --git a/drivers/pci/controller/dwc/pcie-histb.c b/drivers/pci/controller/dwc/pcie-histb.c\nindex 410555dccb6d..e2b80f10030d 100644\n--- a/drivers/pci/controller/dwc/pcie-histb.c\n+++ b/drivers/pci/controller/dwc/pcie-histb.c\n@@ -74,7 +74,7 @@ static void histb_pcie_writel(struct histb_pcie *histb_pcie, u32 reg, u32 val)\n \twritel(val, histb_pcie->ctrl + reg);\n }\n \n-static void histb_pcie_dbi_w_mode(struct pcie_port *pp, bool enable)\n+static void histb_pcie_dbi_w_mode(struct dw_pcie_rp *pp, bool enable)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct histb_pcie *hipcie = to_histb_pcie(pci);\n@@ -88,7 +88,7 @@ static void histb_pcie_dbi_w_mode(struct pcie_port *pp, bool enable)\n \thistb_pcie_writel(hipcie, PCIE_SYS_CTRL0, val);\n }\n \n-static void histb_pcie_dbi_r_mode(struct pcie_port *pp, bool enable)\n+static void histb_pcie_dbi_r_mode(struct dw_pcie_rp *pp, bool enable)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct histb_pcie *hipcie = to_histb_pcie(pci);\n@@ -180,7 +180,7 @@ static int histb_pcie_start_link(struct dw_pcie *pci)\n \treturn 0;\n }\n \n-static int histb_pcie_host_init(struct pcie_port *pp)\n+static int histb_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct histb_pcie *hipcie = to_histb_pcie(pci);\n@@ -219,7 +219,7 @@ static void histb_pcie_host_disable(struct histb_pcie *hipcie)\n \t\tregulator_disable(hipcie->vpcie);\n }\n \n-static int histb_pcie_host_enable(struct pcie_port *pp)\n+static int histb_pcie_host_enable(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct histb_pcie *hipcie = to_histb_pcie(pci);\n@@ -297,7 +297,7 @@ static int histb_pcie_probe(struct platform_device *pdev)\n {\n \tstruct histb_pcie *hipcie;\n \tstruct dw_pcie *pci;\n-\tstruct pcie_port *pp;\n+\tstruct dw_pcie_rp *pp;\n \tstruct device_node *np = pdev->dev.of_node;\n \tstruct device *dev = &pdev->dev;\n \tenum of_gpio_flags of_flags;\ndiff --git a/drivers/pci/controller/dwc/pcie-intel-gw.c b/drivers/pci/controller/dwc/pcie-intel-gw.c\nindex 5ba144924ff8..07bc54886d71 100644\n--- a/drivers/pci/controller/dwc/pcie-intel-gw.c\n+++ b/drivers/pci/controller/dwc/pcie-intel-gw.c\n@@ -343,7 +343,7 @@ static void __intel_pcie_remove(struct intel_pcie *pcie)\n static int intel_pcie_remove(struct platform_device *pdev)\n {\n \tstruct intel_pcie *pcie = platform_get_drvdata(pdev);\n-\tstruct pcie_port *pp = &pcie->pci.pp;\n+\tstruct dw_pcie_rp *pp = &pcie->pci.pp;\n \n \tdw_pcie_host_deinit(pp);\n \t__intel_pcie_remove(pcie);\n@@ -373,7 +373,7 @@ static int __maybe_unused intel_pcie_resume_noirq(struct device *dev)\n \treturn intel_pcie_host_setup(pcie);\n }\n \n-static int intel_pcie_rc_init(struct pcie_port *pp)\n+static int intel_pcie_rc_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct intel_pcie *pcie = dev_get_drvdata(pci->dev);\n@@ -403,7 +403,7 @@ static int intel_pcie_probe(struct platform_device *pdev)\n \tconst struct intel_pcie_soc *data;\n \tstruct device *dev = &pdev->dev;\n \tstruct intel_pcie *pcie;\n-\tstruct pcie_port *pp;\n+\tstruct dw_pcie_rp *pp;\n \tstruct dw_pcie *pci;\n \tint ret;\n \ndiff --git a/drivers/pci/controller/dwc/pcie-keembay.c b/drivers/pci/controller/dwc/pcie-keembay.c\nindex 1ac29a6eef22..58f3caf75cff 100644\n--- a/drivers/pci/controller/dwc/pcie-keembay.c\n+++ b/drivers/pci/controller/dwc/pcie-keembay.c\n@@ -231,7 +231,7 @@ static void keembay_pcie_msi_irq_handler(struct irq_desc *desc)\n \tstruct keembay_pcie *pcie = irq_desc_get_handler_data(desc);\n \tstruct irq_chip *chip = irq_desc_get_chip(desc);\n \tu32 val, mask, status;\n-\tstruct pcie_port *pp;\n+\tstruct dw_pcie_rp *pp;\n \n \t/*\n \t * Keem Bay PCIe Controller provides an additional IP logic on top of\n@@ -332,7 +332,7 @@ static int keembay_pcie_add_pcie_port(struct keembay_pcie *pcie,\n \t\t\t\t      struct platform_device *pdev)\n {\n \tstruct dw_pcie *pci = &pcie->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tstruct device *dev = &pdev->dev;\n \tu32 val;\n \tint ret;\ndiff --git a/drivers/pci/controller/dwc/pcie-kirin.c b/drivers/pci/controller/dwc/pcie-kirin.c\nindex a52cad269f85..7f67aad71df4 100644\n--- a/drivers/pci/controller/dwc/pcie-kirin.c\n+++ b/drivers/pci/controller/dwc/pcie-kirin.c\n@@ -620,7 +620,7 @@ static int kirin_pcie_start_link(struct dw_pcie *pci)\n \treturn 0;\n }\n \n-static int kirin_pcie_host_init(struct pcie_port *pp)\n+static int kirin_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tpp->bridge->ops = &kirin_pci_ops;\n \ndiff --git a/drivers/pci/controller/dwc/pcie-qcom.c b/drivers/pci/controller/dwc/pcie-qcom.c\nindex 2ea13750b492..a9b2322624d5 100644\n--- a/drivers/pci/controller/dwc/pcie-qcom.c\n+++ b/drivers/pci/controller/dwc/pcie-qcom.c\n@@ -1381,7 +1381,7 @@ static int qcom_pcie_config_sid_sm8250(struct qcom_pcie *pcie)\n \treturn 0;\n }\n \n-static int qcom_pcie_host_init(struct pcie_port *pp)\n+static int qcom_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct qcom_pcie *pcie = to_qcom_pcie(pci);\n@@ -1564,7 +1564,7 @@ static const struct dw_pcie_ops dw_pcie_ops = {\n static int qcom_pcie_probe(struct platform_device *pdev)\n {\n \tstruct device *dev = &pdev->dev;\n-\tstruct pcie_port *pp;\n+\tstruct dw_pcie_rp *pp;\n \tstruct dw_pcie *pci;\n \tstruct qcom_pcie *pcie;\n \tconst struct qcom_pcie_cfg *pcie_cfg;\ndiff --git a/drivers/pci/controller/dwc/pcie-spear13xx.c b/drivers/pci/controller/dwc/pcie-spear13xx.c\nindex 1569e82b5568..7fd698da144e 100644\n--- a/drivers/pci/controller/dwc/pcie-spear13xx.c\n+++ b/drivers/pci/controller/dwc/pcie-spear13xx.c\n@@ -85,7 +85,7 @@ static irqreturn_t spear13xx_pcie_irq_handler(int irq, void *arg)\n \tstruct spear13xx_pcie *spear13xx_pcie = arg;\n \tstruct pcie_app_reg __iomem *app_reg = spear13xx_pcie->app_base;\n \tstruct dw_pcie *pci = spear13xx_pcie->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tunsigned int status;\n \n \tstatus = readl(&app_reg->int_sts);\n@@ -121,7 +121,7 @@ static int spear13xx_pcie_link_up(struct dw_pcie *pci)\n \treturn 0;\n }\n \n-static int spear13xx_pcie_host_init(struct pcie_port *pp)\n+static int spear13xx_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct spear13xx_pcie *spear13xx_pcie = to_spear13xx_pcie(pci);\n@@ -155,7 +155,7 @@ static int spear13xx_add_pcie_port(struct spear13xx_pcie *spear13xx_pcie,\n \t\t\t\t   struct platform_device *pdev)\n {\n \tstruct dw_pcie *pci = spear13xx_pcie->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tstruct device *dev = &pdev->dev;\n \tint ret;\n \ndiff --git a/drivers/pci/controller/dwc/pcie-tegra194.c b/drivers/pci/controller/dwc/pcie-tegra194.c\nindex cc2678490162..65135f5c4a4a 100644\n--- a/drivers/pci/controller/dwc/pcie-tegra194.c\n+++ b/drivers/pci/controller/dwc/pcie-tegra194.c\n@@ -311,7 +311,7 @@ struct tegra_pcie_soc {\n \tenum dw_pcie_device_mode mode;\n };\n \n-static void apply_bad_link_workaround(struct pcie_port *pp)\n+static void apply_bad_link_workaround(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct tegra194_pcie *pcie = to_tegra_pcie(pci);\n@@ -349,7 +349,7 @@ static irqreturn_t tegra_pcie_rp_irq_handler(int irq, void *arg)\n {\n \tstruct tegra194_pcie *pcie = arg;\n \tstruct dw_pcie *pci = &pcie->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tu32 val, tmp;\n \tu16 val_w;\n \n@@ -698,7 +698,7 @@ static inline void init_host_aspm(struct tegra194_pcie *pcie) { return; }\n static inline void init_debugfs(struct tegra194_pcie *pcie) { return; }\n #endif\n \n-static void tegra_pcie_enable_system_interrupts(struct pcie_port *pp)\n+static void tegra_pcie_enable_system_interrupts(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct tegra194_pcie *pcie = to_tegra_pcie(pci);\n@@ -736,7 +736,7 @@ static void tegra_pcie_enable_system_interrupts(struct pcie_port *pp)\n \t\t\t   val_w);\n }\n \n-static void tegra_pcie_enable_legacy_interrupts(struct pcie_port *pp)\n+static void tegra_pcie_enable_legacy_interrupts(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct tegra194_pcie *pcie = to_tegra_pcie(pci);\n@@ -757,7 +757,7 @@ static void tegra_pcie_enable_legacy_interrupts(struct pcie_port *pp)\n \tappl_writel(pcie, val, APPL_INTR_EN_L1_8_0);\n }\n \n-static void tegra_pcie_enable_msi_interrupts(struct pcie_port *pp)\n+static void tegra_pcie_enable_msi_interrupts(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct tegra194_pcie *pcie = to_tegra_pcie(pci);\n@@ -770,7 +770,7 @@ static void tegra_pcie_enable_msi_interrupts(struct pcie_port *pp)\n \tappl_writel(pcie, val, APPL_INTR_EN_L0_0);\n }\n \n-static void tegra_pcie_enable_interrupts(struct pcie_port *pp)\n+static void tegra_pcie_enable_interrupts(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct tegra194_pcie *pcie = to_tegra_pcie(pci);\n@@ -851,7 +851,7 @@ static void config_gen3_gen4_eq_presets(struct tegra194_pcie *pcie)\n \tdw_pcie_writel_dbi(pci, GEN3_RELATED_OFF, val);\n }\n \n-static int tegra194_pcie_host_init(struct pcie_port *pp)\n+static int tegra194_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct tegra194_pcie *pcie = to_tegra_pcie(pci);\n@@ -916,7 +916,7 @@ static int tegra194_pcie_start_link(struct dw_pcie *pci)\n {\n \tu32 val, offset, speed, tmp;\n \tstruct tegra194_pcie *pcie = to_tegra_pcie(pci);\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tbool retry = true;\n \n \tif (pcie->mode == DW_PCIE_EP_TYPE) {\n@@ -1212,7 +1212,7 @@ static int tegra_pcie_bpmp_set_pll_state(struct tegra194_pcie *pcie,\n \n static void tegra_pcie_downstream_dev_to_D0(struct tegra194_pcie *pcie)\n {\n-\tstruct pcie_port *pp = &pcie->pci.pp;\n+\tstruct dw_pcie_rp *pp = &pcie->pci.pp;\n \tstruct pci_bus *child, *root_bus = NULL;\n \tstruct pci_dev *pdev;\n \n@@ -1443,7 +1443,7 @@ static void tegra_pcie_unconfig_controller(struct tegra194_pcie *pcie)\n static int tegra_pcie_init_controller(struct tegra194_pcie *pcie)\n {\n \tstruct dw_pcie *pci = &pcie->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \tint ret;\n \n \tret = tegra_pcie_config_controller(pcie, false);\n@@ -1961,7 +1961,7 @@ static int tegra194_pcie_probe(struct platform_device *pdev)\n \tstruct device *dev = &pdev->dev;\n \tstruct resource *atu_dma_res;\n \tstruct tegra194_pcie *pcie;\n-\tstruct pcie_port *pp;\n+\tstruct dw_pcie_rp *pp;\n \tstruct dw_pcie *pci;\n \tstruct phy **phys;\n \tchar *name;\ndiff --git a/drivers/pci/controller/dwc/pcie-uniphier.c b/drivers/pci/controller/dwc/pcie-uniphier.c\nindex b45ac3754242..48c3eba817b4 100644\n--- a/drivers/pci/controller/dwc/pcie-uniphier.c\n+++ b/drivers/pci/controller/dwc/pcie-uniphier.c\n@@ -171,7 +171,7 @@ static void uniphier_pcie_irq_enable(struct uniphier_pcie *pcie)\n \n static void uniphier_pcie_irq_mask(struct irq_data *d)\n {\n-\tstruct pcie_port *pp = irq_data_get_irq_chip_data(d);\n+\tstruct dw_pcie_rp *pp = irq_data_get_irq_chip_data(d);\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct uniphier_pcie *pcie = to_uniphier_pcie(pci);\n \tunsigned long flags;\n@@ -188,7 +188,7 @@ static void uniphier_pcie_irq_mask(struct irq_data *d)\n \n static void uniphier_pcie_irq_unmask(struct irq_data *d)\n {\n-\tstruct pcie_port *pp = irq_data_get_irq_chip_data(d);\n+\tstruct dw_pcie_rp *pp = irq_data_get_irq_chip_data(d);\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct uniphier_pcie *pcie = to_uniphier_pcie(pci);\n \tunsigned long flags;\n@@ -225,7 +225,7 @@ static const struct irq_domain_ops uniphier_intx_domain_ops = {\n \n static void uniphier_pcie_irq_handler(struct irq_desc *desc)\n {\n-\tstruct pcie_port *pp = irq_desc_get_handler_data(desc);\n+\tstruct dw_pcie_rp *pp = irq_desc_get_handler_data(desc);\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct uniphier_pcie *pcie = to_uniphier_pcie(pci);\n \tstruct irq_chip *chip = irq_desc_get_chip(desc);\n@@ -258,7 +258,7 @@ static void uniphier_pcie_irq_handler(struct irq_desc *desc)\n \tchained_irq_exit(chip, desc);\n }\n \n-static int uniphier_pcie_config_legacy_irq(struct pcie_port *pp)\n+static int uniphier_pcie_config_legacy_irq(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct uniphier_pcie *pcie = to_uniphier_pcie(pci);\n@@ -295,7 +295,7 @@ static int uniphier_pcie_config_legacy_irq(struct pcie_port *pp)\n \treturn ret;\n }\n \n-static int uniphier_pcie_host_init(struct pcie_port *pp)\n+static int uniphier_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct uniphier_pcie *pcie = to_uniphier_pcie(pci);\ndiff --git a/drivers/pci/controller/dwc/pcie-visconti.c b/drivers/pci/controller/dwc/pcie-visconti.c\nindex 50f80f07e4db..71026fefa366 100644\n--- a/drivers/pci/controller/dwc/pcie-visconti.c\n+++ b/drivers/pci/controller/dwc/pcie-visconti.c\n@@ -178,7 +178,7 @@ static void visconti_pcie_stop_link(struct dw_pcie *pci)\n  */\n static u64 visconti_pcie_cpu_addr_fixup(struct dw_pcie *pci, u64 cpu_addr)\n {\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \n \treturn cpu_addr & ~pp->io_base;\n }\n@@ -190,7 +190,7 @@ static const struct dw_pcie_ops dw_pcie_ops = {\n \t.stop_link = visconti_pcie_stop_link,\n };\n \n-static int visconti_pcie_host_init(struct pcie_port *pp)\n+static int visconti_pcie_host_init(struct dw_pcie_rp *pp)\n {\n \tstruct dw_pcie *pci = to_dw_pcie_from_pp(pp);\n \tstruct visconti_pcie *pcie = dev_get_drvdata(pci->dev);\n@@ -278,7 +278,7 @@ static int visconti_add_pcie_port(struct visconti_pcie *pcie,\n \t\t\t\t  struct platform_device *pdev)\n {\n \tstruct dw_pcie *pci = &pcie->pci;\n-\tstruct pcie_port *pp = &pci->pp;\n+\tstruct dw_pcie_rp *pp = &pci->pp;\n \n \tpp->irq = platform_get_irq_byname(pdev, \"intr\");\n \tif (pp->irq < 0)\n", "stats": " drivers/pci/controller/dwc/pci-dra7xx.c           | 12 ++++----\n drivers/pci/controller/dwc/pci-exynos.c           |  6 ++--\n drivers/pci/controller/dwc/pci-imx6.c             |  6 ++--\n drivers/pci/controller/dwc/pci-keystone.c         | 20 ++++++-------\n drivers/pci/controller/dwc/pci-layerscape.c       |  2 +-\n drivers/pci/controller/dwc/pci-meson.c            |  2 +-\n drivers/pci/controller/dwc/pcie-al.c              |  6 ++--\n drivers/pci/controller/dwc/pcie-armada8k.c        |  4 +--\n drivers/pci/controller/dwc/pcie-artpec6.c         |  4 +--\n drivers/pci/controller/dwc/pcie-designware-host.c | 36 +++++++++++------------\n drivers/pci/controller/dwc/pcie-designware-plat.c |  2 +-\n drivers/pci/controller/dwc/pcie-designware.h      | 30 +++++++++----------\n drivers/pci/controller/dwc/pcie-dw-rockchip.c     |  4 +--\n drivers/pci/controller/dwc/pcie-fu740.c           |  2 +-\n drivers/pci/controller/dwc/pcie-histb.c           | 10 +++----\n drivers/pci/controller/dwc/pcie-intel-gw.c        |  6 ++--\n drivers/pci/controller/dwc/pcie-keembay.c         |  4 +--\n drivers/pci/controller/dwc/pcie-kirin.c           |  2 +-\n drivers/pci/controller/dwc/pcie-qcom.c            |  4 +--\n drivers/pci/controller/dwc/pcie-spear13xx.c       |  6 ++--\n drivers/pci/controller/dwc/pcie-tegra194.c        | 22 +++++++-------\n drivers/pci/controller/dwc/pcie-uniphier.c        | 10 +++----\n drivers/pci/controller/dwc/pcie-visconti.c        |  6 ++--\n 23 files changed, 103 insertions(+), 103 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "60b3c27fb9b92b8b55cd8bdcc444c3f7cb556652"}, "tag": "linux", "timestamp": 1699830562.416687, "updated_on": 1657065652.0, "uuid": "dec2fb696ee6e782993b912527b398800e9489d5"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Thomas Zimmermann <tzimmermann@suse.de>", "AuthorDate": "Mon Aug 1 15:50:28 2022 +0200", "Commit": "Thomas Zimmermann <tzimmermann@suse.de>", "CommitDate": "Fri Aug 5 14:14:03 2022 +0200", "Signed-off-by": ["Thomas Zimmermann <tzimmermann@suse.de>"], "commit": "de40c281fe0b6babf3d1a25e034525a23e125d0c", "files": [{"action": "M", "added": "168", "file": "drivers/gpu/drm/tiny/simpledrm.c", "indexes": ["11a7348ccf4d", "82fd98f77981"], "modes": ["100644", "100644"], "removed": "105"}], "message": "drm/simpledrm: Convert to atomic helpers\n\nReplace the simple-KMS helpers with the regular atomic helpers. The\nregular helpers are better architectured and therefore allow for easier\ncode sharing among drivers. No functional changes.\n\nv3:\n        * remove empty CRTC helpers atomic_{enable, disable} (Javier)\n        * unconditionally run drm_atomic_helper_check_plane_state()\n\nSigned-off-by: Thomas Zimmermann <tzimmermann@suse.de>\nAcked-by: Javier Martinez Canillas <javierm@redhat.com>\nLink: https://patchwork.freedesktop.org/patch/msgid/20220801135028.30647-6-tzimmermann@suse.de", "parents": ["fd9e3169e42b7b9e3a5c58ca2bc95a15f9de1d6c"], "refs": [], "diff": "diff --git a/drivers/gpu/drm/tiny/simpledrm.c b/drivers/gpu/drm/tiny/simpledrm.c\nindex 11a7348ccf4d..82fd98f77981 100644\n--- a/drivers/gpu/drm/tiny/simpledrm.c\n+++ b/drivers/gpu/drm/tiny/simpledrm.c\n@@ -8,6 +8,7 @@\n #include <linux/regulator/consumer.h>\n \n #include <drm/drm_aperture.h>\n+#include <drm/drm_atomic.h>\n #include <drm/drm_atomic_state_helper.h>\n #include <drm/drm_connector.h>\n #include <drm/drm_damage_helper.h>\n@@ -20,8 +21,8 @@\n #include <drm/drm_gem_shmem_helper.h>\n #include <drm/drm_managed.h>\n #include <drm/drm_modeset_helper_vtables.h>\n+#include <drm/drm_plane_helper.h>\n #include <drm/drm_probe_helper.h>\n-#include <drm/drm_simple_kms_helper.h>\n \n #define DRIVER_NAME\t\"simpledrm\"\n #define DRIVER_DESC\t\"DRM driver for simple-framebuffer platform devices\"\n@@ -221,8 +222,10 @@ struct simpledrm_device {\n \t/* modesetting */\n \tuint32_t formats[8];\n \tsize_t nformats;\n+\tstruct drm_plane primary_plane;\n+\tstruct drm_crtc crtc;\n+\tstruct drm_encoder encoder;\n \tstruct drm_connector connector;\n-\tstruct drm_simple_display_pipe pipe;\n };\n \n static struct simpledrm_device *simpledrm_device_of_dev(struct drm_device *dev)\n@@ -460,7 +463,7 @@ static int simpledrm_device_init_regulators(struct simpledrm_device *sdev)\n  * TODO: Add blit helpers for remaining formats and uncomment\n  *       constants.\n  */\n-static const uint32_t simpledrm_default_formats[] = {\n+static const uint32_t simpledrm_primary_plane_formats[] = {\n \tDRM_FORMAT_XRGB8888,\n \tDRM_FORMAT_ARGB8888,\n \tDRM_FORMAT_RGB565,\n@@ -471,73 +474,44 @@ static const uint32_t simpledrm_default_formats[] = {\n \tDRM_FORMAT_ARGB2101010,\n };\n \n-static const uint64_t simpledrm_format_modifiers[] = {\n+static const uint64_t simpledrm_primary_plane_format_modifiers[] = {\n \tDRM_FORMAT_MOD_LINEAR,\n \tDRM_FORMAT_MOD_INVALID\n };\n \n-static int simpledrm_connector_helper_get_modes(struct drm_connector *connector)\n+static int simpledrm_primary_plane_helper_atomic_check(struct drm_plane *plane,\n+\t\t\t\t\t\t       struct drm_atomic_state *new_state)\n {\n-\tstruct simpledrm_device *sdev = simpledrm_device_of_dev(connector->dev);\n-\tstruct drm_display_mode *mode;\n-\n-\tmode = drm_mode_duplicate(connector->dev, &sdev->mode);\n-\tif (!mode)\n-\t\treturn 0;\n-\n-\tif (mode->name[0] == '\\0')\n-\t\tdrm_mode_set_name(mode);\n-\n-\tmode->type |= DRM_MODE_TYPE_PREFERRED;\n-\tdrm_mode_probed_add(connector, mode);\n-\n-\tif (mode->width_mm)\n-\t\tconnector->display_info.width_mm = mode->width_mm;\n-\tif (mode->height_mm)\n-\t\tconnector->display_info.height_mm = mode->height_mm;\n-\n-\treturn 1;\n-}\n-\n-static const struct drm_connector_helper_funcs simpledrm_connector_helper_funcs = {\n-\t.get_modes = simpledrm_connector_helper_get_modes,\n-};\n-\n-static const struct drm_connector_funcs simpledrm_connector_funcs = {\n-\t.reset = drm_atomic_helper_connector_reset,\n-\t.fill_modes = drm_helper_probe_single_connector_modes,\n-\t.destroy = drm_connector_cleanup,\n-\t.atomic_duplicate_state = drm_atomic_helper_connector_duplicate_state,\n-\t.atomic_destroy_state = drm_atomic_helper_connector_destroy_state,\n-};\n+\tstruct drm_plane_state *new_plane_state = drm_atomic_get_new_plane_state(new_state, plane);\n+\tstruct drm_crtc *new_crtc = new_plane_state->crtc;\n+\tstruct drm_crtc_state *new_crtc_state = NULL;\n+\tint ret;\n \n-static enum drm_mode_status\n-simpledrm_simple_display_pipe_mode_valid(struct drm_simple_display_pipe *pipe,\n-\t\t\t\t    const struct drm_display_mode *mode)\n-{\n-\tstruct simpledrm_device *sdev = simpledrm_device_of_dev(pipe->crtc.dev);\n+\tif (new_crtc)\n+\t\tnew_crtc_state = drm_atomic_get_new_crtc_state(new_state, new_crtc);\n \n-\tif (mode->hdisplay != sdev->mode.hdisplay &&\n-\t    mode->vdisplay != sdev->mode.vdisplay)\n-\t\treturn MODE_ONE_SIZE;\n-\telse if (mode->hdisplay != sdev->mode.hdisplay)\n-\t\treturn MODE_ONE_WIDTH;\n-\telse if (mode->vdisplay != sdev->mode.vdisplay)\n-\t\treturn MODE_ONE_HEIGHT;\n+\tret = drm_atomic_helper_check_plane_state(new_plane_state, new_crtc_state,\n+\t\t\t\t\t\t  DRM_PLANE_NO_SCALING,\n+\t\t\t\t\t\t  DRM_PLANE_NO_SCALING,\n+\t\t\t\t\t\t  false, false);\n+\tif (ret)\n+\t\treturn ret;\n+\telse if (!new_plane_state->visible)\n+\t\treturn 0;\n \n-\treturn MODE_OK;\n+\treturn 0;\n }\n \n-static void\n-simpledrm_simple_display_pipe_enable(struct drm_simple_display_pipe *pipe,\n-\t\t\t\t     struct drm_crtc_state *crtc_state,\n-\t\t\t\t     struct drm_plane_state *plane_state)\n+static void simpledrm_primary_plane_helper_atomic_update(struct drm_plane *plane,\n+\t\t\t\t\t\t\t struct drm_atomic_state *old_state)\n {\n-\tstruct simpledrm_device *sdev = simpledrm_device_of_dev(pipe->crtc.dev);\n+\tstruct drm_plane_state *plane_state = plane->state;\n+\tstruct drm_plane_state *old_plane_state = drm_atomic_get_old_plane_state(old_state, plane);\n \tstruct drm_shadow_plane_state *shadow_plane_state = to_drm_shadow_plane_state(plane_state);\n-\tstruct drm_framebuffer *fb = plane_state->fb;\n \tvoid *vmap = shadow_plane_state->data[0].vaddr; /* TODO: Use mapping abstraction */\n-\tstruct drm_device *dev = &sdev->dev;\n+\tstruct drm_framebuffer *fb = plane_state->fb;\n+\tstruct drm_device *dev = plane->dev;\n+\tstruct simpledrm_device *sdev = simpledrm_device_of_dev(dev);\n \tvoid __iomem *dst = sdev->screen_base;\n \tstruct drm_rect src_clip, dst_clip;\n \tint idx;\n@@ -545,7 +519,8 @@ simpledrm_simple_display_pipe_enable(struct drm_simple_display_pipe *pipe,\n \tif (!fb)\n \t\treturn;\n \n-\tdrm_rect_fp_to_int(&src_clip, &plane_state->src);\n+\tif (!drm_atomic_helper_damage_merged(old_plane_state, plane_state, &src_clip))\n+\t\treturn;\n \n \tdst_clip = plane_state->dst;\n \tif (!drm_rect_intersect(&dst_clip, &src_clip))\n@@ -560,11 +535,11 @@ simpledrm_simple_display_pipe_enable(struct drm_simple_display_pipe *pipe,\n \tdrm_dev_exit(idx);\n }\n \n-static void\n-simpledrm_simple_display_pipe_disable(struct drm_simple_display_pipe *pipe)\n+static void simpledrm_primary_plane_helper_atomic_disable(struct drm_plane *plane,\n+\t\t\t\t\t\t\t  struct drm_atomic_state *old_state)\n {\n-\tstruct simpledrm_device *sdev = simpledrm_device_of_dev(pipe->crtc.dev);\n-\tstruct drm_device *dev = &sdev->dev;\n+\tstruct drm_device *dev = plane->dev;\n+\tstruct simpledrm_device *sdev = simpledrm_device_of_dev(dev);\n \tint idx;\n \n \tif (!drm_dev_enter(dev, &idx))\n@@ -576,46 +551,105 @@ simpledrm_simple_display_pipe_disable(struct drm_simple_display_pipe *pipe)\n \tdrm_dev_exit(idx);\n }\n \n-static void\n-simpledrm_simple_display_pipe_update(struct drm_simple_display_pipe *pipe,\n-\t\t\t\t     struct drm_plane_state *old_plane_state)\n+static const struct drm_plane_helper_funcs simpledrm_primary_plane_helper_funcs = {\n+\tDRM_GEM_SHADOW_PLANE_HELPER_FUNCS,\n+\t.atomic_check = simpledrm_primary_plane_helper_atomic_check,\n+\t.atomic_update = simpledrm_primary_plane_helper_atomic_update,\n+\t.atomic_disable = simpledrm_primary_plane_helper_atomic_disable,\n+};\n+\n+static const struct drm_plane_funcs simpledrm_primary_plane_funcs = {\n+\t.update_plane = drm_atomic_helper_update_plane,\n+\t.disable_plane = drm_atomic_helper_disable_plane,\n+\t.destroy = drm_plane_cleanup,\n+\tDRM_GEM_SHADOW_PLANE_FUNCS,\n+};\n+\n+static enum drm_mode_status simpledrm_crtc_helper_mode_valid(struct drm_crtc *crtc,\n+\t\t\t\t\t\t\t     const struct drm_display_mode *mode)\n {\n-\tstruct simpledrm_device *sdev = simpledrm_device_of_dev(pipe->crtc.dev);\n-\tstruct drm_plane_state *plane_state = pipe->plane.state;\n-\tstruct drm_shadow_plane_state *shadow_plane_state = to_drm_shadow_plane_state(plane_state);\n-\tvoid *vmap = shadow_plane_state->data[0].vaddr; /* TODO: Use mapping abstraction */\n-\tstruct drm_framebuffer *fb = plane_state->fb;\n-\tstruct drm_device *dev = &sdev->dev;\n-\tvoid __iomem *dst = sdev->screen_base;\n-\tstruct drm_rect src_clip, dst_clip;\n-\tint idx;\n+\tstruct simpledrm_device *sdev = simpledrm_device_of_dev(crtc->dev);\n \n-\tif (!fb)\n-\t\treturn;\n+\tif (mode->hdisplay != sdev->mode.hdisplay &&\n+\t    mode->vdisplay != sdev->mode.vdisplay)\n+\t\treturn MODE_ONE_SIZE;\n+\telse if (mode->hdisplay != sdev->mode.hdisplay)\n+\t\treturn MODE_ONE_WIDTH;\n+\telse if (mode->vdisplay != sdev->mode.vdisplay)\n+\t\treturn MODE_ONE_HEIGHT;\n \n-\tif (!drm_atomic_helper_damage_merged(old_plane_state, plane_state, &src_clip))\n-\t\treturn;\n+\treturn MODE_OK;\n+}\n \n-\tdst_clip = plane_state->dst;\n-\tif (!drm_rect_intersect(&dst_clip, &src_clip))\n-\t\treturn;\n+static int simpledrm_crtc_helper_atomic_check(struct drm_crtc *crtc,\n+\t\t\t\t\t      struct drm_atomic_state *new_state)\n+{\n+\tstruct drm_crtc_state *new_crtc_state = drm_atomic_get_new_crtc_state(new_state, crtc);\n+\tint ret;\n \n-\tif (!drm_dev_enter(dev, &idx))\n-\t\treturn;\n+\tret = drm_atomic_helper_check_crtc_state(new_crtc_state, false);\n+\tif (ret)\n+\t\treturn ret;\n \n-\tdst += drm_fb_clip_offset(sdev->pitch, sdev->format, &dst_clip);\n-\tdrm_fb_blit_toio(dst, sdev->pitch, sdev->format->format, vmap, fb, &src_clip);\n+\treturn drm_atomic_add_affected_planes(new_state, crtc);\n+}\n \n-\tdrm_dev_exit(idx);\n+/*\n+ * The CRTC is always enabled. Screen updates are performed by\n+ * the primary plane's atomic_update function. Disabling clears\n+ * the screen in the primary plane's atomic_disable function.\n+ */\n+static const struct drm_crtc_helper_funcs simpledrm_crtc_helper_funcs = {\n+\t.mode_valid = simpledrm_crtc_helper_mode_valid,\n+\t.atomic_check = simpledrm_crtc_helper_atomic_check,\n+};\n+\n+static const struct drm_crtc_funcs simpledrm_crtc_funcs = {\n+\t.reset = drm_atomic_helper_crtc_reset,\n+\t.destroy = drm_crtc_cleanup,\n+\t.set_config = drm_atomic_helper_set_config,\n+\t.page_flip = drm_atomic_helper_page_flip,\n+\t.atomic_duplicate_state = drm_atomic_helper_crtc_duplicate_state,\n+\t.atomic_destroy_state = drm_atomic_helper_crtc_destroy_state,\n+};\n+\n+static const struct drm_encoder_funcs simpledrm_encoder_funcs = {\n+\t.destroy = drm_encoder_cleanup,\n+};\n+\n+static int simpledrm_connector_helper_get_modes(struct drm_connector *connector)\n+{\n+\tstruct simpledrm_device *sdev = simpledrm_device_of_dev(connector->dev);\n+\tstruct drm_display_mode *mode;\n+\n+\tmode = drm_mode_duplicate(connector->dev, &sdev->mode);\n+\tif (!mode)\n+\t\treturn 0;\n+\n+\tif (mode->name[0] == '\\0')\n+\t\tdrm_mode_set_name(mode);\n+\n+\tmode->type |= DRM_MODE_TYPE_PREFERRED;\n+\tdrm_mode_probed_add(connector, mode);\n+\n+\tif (mode->width_mm)\n+\t\tconnector->display_info.width_mm = mode->width_mm;\n+\tif (mode->height_mm)\n+\t\tconnector->display_info.height_mm = mode->height_mm;\n+\n+\treturn 1;\n }\n \n-static const struct drm_simple_display_pipe_funcs\n-simpledrm_simple_display_pipe_funcs = {\n-\t.mode_valid = simpledrm_simple_display_pipe_mode_valid,\n-\t.enable = simpledrm_simple_display_pipe_enable,\n-\t.disable = simpledrm_simple_display_pipe_disable,\n-\t.update = simpledrm_simple_display_pipe_update,\n-\tDRM_GEM_SIMPLE_DISPLAY_PIPE_SHADOW_PLANE_FUNCS,\n+static const struct drm_connector_helper_funcs simpledrm_connector_helper_funcs = {\n+\t.get_modes = simpledrm_connector_helper_get_modes,\n+};\n+\n+static const struct drm_connector_funcs simpledrm_connector_funcs = {\n+\t.reset = drm_atomic_helper_connector_reset,\n+\t.fill_modes = drm_helper_probe_single_connector_modes,\n+\t.destroy = drm_connector_cleanup,\n+\t.atomic_duplicate_state = drm_atomic_helper_connector_duplicate_state,\n+\t.atomic_destroy_state = drm_atomic_helper_connector_destroy_state,\n };\n \n static const struct drm_mode_config_funcs simpledrm_mode_config_funcs = {\n@@ -653,10 +687,10 @@ static const uint32_t *simpledrm_device_formats(struct simpledrm_device *sdev,\n \tsdev->nformats = 1;\n \n \t/* default formats go second */\n-\tfor (i = 0; i < ARRAY_SIZE(simpledrm_default_formats); ++i) {\n-\t\tif (simpledrm_default_formats[i] == sdev->format->format)\n+\tfor (i = 0; i < ARRAY_SIZE(simpledrm_primary_plane_formats); ++i) {\n+\t\tif (simpledrm_primary_plane_formats[i] == sdev->format->format)\n \t\t\tcontinue; /* native format already went first */\n-\t\tsdev->formats[sdev->nformats] = simpledrm_default_formats[i];\n+\t\tsdev->formats[sdev->nformats] = simpledrm_primary_plane_formats[i];\n \t\tsdev->nformats++;\n \t}\n \n@@ -689,8 +723,10 @@ static struct simpledrm_device *simpledrm_device_create(struct drm_driver *drv,\n \tconst struct drm_format_info *format;\n \tstruct resource *res, *mem;\n \tvoid __iomem *screen_base;\n+\tstruct drm_plane *primary_plane;\n+\tstruct drm_crtc *crtc;\n+\tstruct drm_encoder *encoder;\n \tstruct drm_connector *connector;\n-\tstruct drm_simple_display_pipe *pipe;\n \tunsigned long max_width, max_height;\n \tconst uint32_t *formats;\n \tsize_t nformats;\n@@ -802,6 +838,40 @@ static struct simpledrm_device *simpledrm_device_create(struct drm_driver *drv,\n \tdev->mode_config.preferred_depth = format->cpp[0] * 8;\n \tdev->mode_config.funcs = &simpledrm_mode_config_funcs;\n \n+\t/* Primary plane */\n+\n+\tformats = simpledrm_device_formats(sdev, &nformats);\n+\n+\tprimary_plane = &sdev->primary_plane;\n+\tret = drm_universal_plane_init(dev, primary_plane, 0, &simpledrm_primary_plane_funcs,\n+\t\t\t\t       formats, nformats,\n+\t\t\t\t       simpledrm_primary_plane_format_modifiers,\n+\t\t\t\t       DRM_PLANE_TYPE_PRIMARY, NULL);\n+\tif (ret)\n+\t\treturn ERR_PTR(ret);\n+\tdrm_plane_helper_add(primary_plane, &simpledrm_primary_plane_helper_funcs);\n+\tdrm_plane_enable_fb_damage_clips(primary_plane);\n+\n+\t/* CRTC */\n+\n+\tcrtc = &sdev->crtc;\n+\tret = drm_crtc_init_with_planes(dev, crtc, primary_plane, NULL,\n+\t\t\t\t\t&simpledrm_crtc_funcs, NULL);\n+\tif (ret)\n+\t\treturn ERR_PTR(ret);\n+\tdrm_crtc_helper_add(crtc, &simpledrm_crtc_helper_funcs);\n+\n+\t/* Encoder */\n+\n+\tencoder = &sdev->encoder;\n+\tret = drm_encoder_init(dev, encoder, &simpledrm_encoder_funcs,\n+\t\t\t       DRM_MODE_ENCODER_NONE, NULL);\n+\tif (ret)\n+\t\treturn ERR_PTR(ret);\n+\tencoder->possible_crtcs = drm_crtc_mask(crtc);\n+\n+\t/* Connector */\n+\n \tconnector = &sdev->connector;\n \tret = drm_connector_init(dev, connector, &simpledrm_connector_funcs,\n \t\t\t\t DRM_MODE_CONNECTOR_Unknown);\n@@ -812,17 +882,10 @@ static struct simpledrm_device *simpledrm_device_create(struct drm_driver *drv,\n \t\t\t\t\t\t       DRM_MODE_PANEL_ORIENTATION_UNKNOWN,\n \t\t\t\t\t\t       width, height);\n \n-\tformats = simpledrm_device_formats(sdev, &nformats);\n-\n-\tpipe = &sdev->pipe;\n-\tret = drm_simple_display_pipe_init(dev, pipe, &simpledrm_simple_display_pipe_funcs,\n-\t\t\t\t\t   formats, nformats, simpledrm_format_modifiers,\n-\t\t\t\t\t   connector);\n+\tret = drm_connector_attach_encoder(connector, encoder);\n \tif (ret)\n \t\treturn ERR_PTR(ret);\n \n-\tdrm_plane_enable_fb_damage_clips(&pipe->plane);\n-\n \tdrm_mode_config_reset(dev);\n \n \treturn sdev;\n", "stats": " drivers/gpu/drm/tiny/simpledrm.c | 273 ++++++++++++++++++++++++---------------\n 1 file changed, 168 insertions(+), 105 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "de40c281fe0b6babf3d1a25e034525a23e125d0c"}, "tag": "linux", "timestamp": 1699830700.592386, "updated_on": 1659701643.0, "uuid": "4c26c32053a0473f33c700ec9c1f575206b95264"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Palmer Dabbelt <palmer@rivosinc.com>", "AuthorDate": "Fri Nov 19 08:44:09 2021 -0800", "Commit": "Palmer Dabbelt <palmer@rivosinc.com>", "CommitDate": "Wed Jan 5 20:06:56 2022 -0800", "Signed-off-by": ["Palmer Dabbelt <palmer@rivosinc.com>"], "commit": "2fadc6ea4a082fa84df29ff40cfd67268770fa16", "files": [{"action": "M", "added": "0", "file": "arch/riscv/configs/nommu_k210_defconfig", "indexes": ["b16a2a12c82a", "89ab76349ea8"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "0", "file": "arch/riscv/configs/nommu_k210_sdcard_defconfig", "indexes": ["61f887f65419", "690460f79925"], "modes": ["100644", "100644"], "removed": "1"}], "message": "RISC-V: defconfigs: Sort CONFIG_SURFACE_PLATFORMS\n\nThis should have no functional change, it just sorts\nCONFIG_SURFACE_PLATFORMS the same way savedefconfig does.\n\nReviewed-by: Anup Patel <anup@brainfault.org>\nSigned-off-by: Palmer Dabbelt <palmer@rivosinc.com>", "parents": ["a7e9fbef867d2e1af316f9009bd714328aa0507a"], "refs": [], "diff": "diff --git a/arch/riscv/configs/nommu_k210_defconfig b/arch/riscv/configs/nommu_k210_defconfig\nindex b16a2a12c82a..89ab76349ea8 100644\n--- a/arch/riscv/configs/nommu_k210_defconfig\n+++ b/arch/riscv/configs/nommu_k210_defconfig\n@@ -75,7 +75,6 @@ CONFIG_LEDS_GPIO=y\n CONFIG_LEDS_USER=y\n # CONFIG_VIRTIO_MENU is not set\n # CONFIG_VHOST_MENU is not set\n-# CONFIG_SURFACE_PLATFORMS is not set\n # CONFIG_FILE_LOCKING is not set\n # CONFIG_DNOTIFY is not set\n # CONFIG_INOTIFY_USER is not set\ndiff --git a/arch/riscv/configs/nommu_k210_sdcard_defconfig b/arch/riscv/configs/nommu_k210_sdcard_defconfig\nindex 61f887f65419..690460f79925 100644\n--- a/arch/riscv/configs/nommu_k210_sdcard_defconfig\n+++ b/arch/riscv/configs/nommu_k210_sdcard_defconfig\n@@ -72,7 +72,6 @@ CONFIG_LEDS_GPIO=y\n CONFIG_LEDS_USER=y\n # CONFIG_VIRTIO_MENU is not set\n # CONFIG_VHOST_MENU is not set\n-# CONFIG_SURFACE_PLATFORMS is not set\n CONFIG_EXT2_FS=y\n # CONFIG_FILE_LOCKING is not set\n # CONFIG_DNOTIFY is not set\n", "stats": " arch/riscv/configs/nommu_k210_defconfig        | 1 -\n arch/riscv/configs/nommu_k210_sdcard_defconfig | 1 -\n 2 files changed, 2 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "2fadc6ea4a082fa84df29ff40cfd67268770fa16"}, "tag": "linux", "timestamp": 1699830013.151731, "updated_on": 1641442016.0, "uuid": "de2a0707621d0b7eccecf606b8c5797068c9deb8"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Akira Yokosawa <akiyks@gmail.com>", "AuthorDate": "Mon Aug 8 17:53:57 2022 +0900", "Commit": "Jonathan Corbet <corbet@lwn.net>", "CommitDate": "Thu Aug 18 11:27:55 2022 -0600", "Signed-off-by": ["Akira Yokosawa <akiyks@gmail.com>", "Jonathan Corbet <corbet@lwn.net>"], "commit": "cee7db1b0239468b22c295cf04a8c40c34ecd35a", "files": [{"action": "M", "added": "16", "file": "Documentation/sphinx/kerneldoc-preamble.sty", "indexes": ["2a29cbe51396", "9707e033c8c4"], "modes": ["100644", "100644"], "removed": "6"}], "message": "docs: kerneldoc-preamble: Test xeCJK.sty before loading\n\nOn distros whose texlive packaging is fine-grained, texlive-xecjk\ncan be installed/removed independently of other texlive packages.\nConditionally loading xeCJK depending only on the existence of the\n\"Noto Sans CJK SC\" font might end up in xelatex error of\n\"xeCJK.sty not found!\".\n\nImprove the situation by testing existence of xeCJK.sty before\nloading it.\n\nThis is useful on RHEL 9 and its clone distros where texlive-xecjk\ndoesn't work at the moment due to a missing dependency [1].\n\"make pdfdocs\" for non-CJK contents should work after removing\ntexlive-xecjk.\n\nLink: [1] https://bugzilla.redhat.com/show_bug.cgi?id=2086254\nFixes: 398f7abdcb7e (\"docs: pdfdocs: Pull LaTeX preamble part out of conf.py\")\nCc: stable@vger.kernel.org # v5.18+\nSigned-off-by: Akira Yokosawa <akiyks@gmail.com>\nAcked-by: Mauro Carvalho Chehab <mchehab@kernel.org>\nLink: https://lore.kernel.org/r/c24c2a87-70b2-5342-bcc9-de467940466e@gmail.com\nSigned-off-by: Jonathan Corbet <corbet@lwn.net>", "parents": ["568035b01cfb107af8d2e4bd2fb9aea22cf5b868"], "refs": [], "diff": "diff --git a/Documentation/sphinx/kerneldoc-preamble.sty b/Documentation/sphinx/kerneldoc-preamble.sty\nindex 2a29cbe51396..9707e033c8c4 100644\n--- a/Documentation/sphinx/kerneldoc-preamble.sty\n+++ b/Documentation/sphinx/kerneldoc-preamble.sty\n@@ -70,8 +70,16 @@\n \n % Translations have Asian (CJK) characters which are only displayed if\n % xeCJK is used\n+\\usepackage{ifthen}\n+\\newboolean{enablecjk}\n+\\setboolean{enablecjk}{false}\n \\IfFontExistsTF{Noto Sans CJK SC}{\n-    % Load xeCJK when CJK font is available\n+    \\IfFileExists{xeCJK.sty}{\n+\t\\setboolean{enablecjk}{true}\n+    }{}\n+}{}\n+\\ifthenelse{\\boolean{enablecjk}}{\n+    % Load xeCJK when both the Noto Sans CJK font and xeCJK.sty are available.\n     \\usepackage{xeCJK}\n     % Noto CJK fonts don't provide slant shape. [AutoFakeSlant] permits\n     % its emulation.\n@@ -196,7 +204,7 @@\n     % Inactivate CJK after tableofcontents\n     \\apptocmd{\\sphinxtableofcontents}{\\kerneldocCJKoff}{}{}\n     \\xeCJKsetup{CJKspace = true}% For inter-phrase space of Korean TOC\n-}{ % No CJK font found\n+}{ % Don't enable CJK\n     % Custom macros to on/off CJK and switch CJK fonts (Dummy)\n     \\newcommand{\\kerneldocCJKon}{}\n     \\newcommand{\\kerneldocCJKoff}{}\n@@ -204,14 +212,16 @@\n     %% and ignore the argument (#1) in their definitions, whole contents of\n     %% CJK chapters can be ignored.\n     \\newcommand{\\kerneldocBeginSC}[1]{%\n-\t%% Put a note on missing CJK fonts in place of zh_CN translation.\n-\t\\begin{sphinxadmonition}{note}{Note on missing fonts:}\n+\t%% Put a note on missing CJK fonts or the xecjk package in place of\n+\t%% zh_CN translation.\n+\t\\begin{sphinxadmonition}{note}{Note on missing fonts and a package:}\n \t    Translations of Simplified Chinese (zh\\_CN), Traditional Chinese\n \t    (zh\\_TW), Korean (ko\\_KR), and Japanese (ja\\_JP) were skipped\n-\t    due to the lack of suitable font families.\n+\t    due to the lack of suitable font families and/or the texlive-xecjk\n+\t    package.\n \n \t    If you want them, please install ``Noto Sans CJK'' font families\n-\t    by following instructions from\n+\t    along with the texlive-xecjk package by following instructions from\n \t    \\sphinxcode{./scripts/sphinx-pre-install}.\n \t    Having optional ``Noto Serif CJK'' font families will improve\n \t    the looks of those translations.\n", "stats": " Documentation/sphinx/kerneldoc-preamble.sty | 22 ++++++++++++++++------\n 1 file changed, 16 insertions(+), 6 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "cee7db1b0239468b22c295cf04a8c40c34ecd35a"}, "tag": "linux", "timestamp": 1699830621.679477, "updated_on": 1660843675.0, "uuid": "a22c2ae6d1fa486eb34a20174c882f961e30a2e4"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "NeilBrown <neilb@suse.de>", "AuthorDate": "Mon Mar 7 10:41:44 2022 +1100", "Commit": "Trond Myklebust <trond.myklebust@hammerspace.com>", "CommitDate": "Sun Mar 13 12:59:35 2022 -0400", "Signed-off-by": ["NeilBrown <neilb@suse.de>", "Trond Myklebust <trond.myklebust@hammerspace.com>"], "commit": "944d95f766c6fe97fa358c661281a741758cee7e", "files": [{"action": "M", "added": "0", "file": "fs/nfs/file.c", "indexes": ["4d681683d13c", "93c01aaa0a8d"], "modes": ["100644", "100644"], "removed": "5"}], "message": "NFS: remove IS_SWAPFILE hack\n\nThis code is pointless as IS_SWAPFILE is always defined.\nSo remove it.\n\nSuggested-by: Mark Hemment <markhemm@googlemail.com>\nReviewed-by: Christoph Hellwig <hch@lst.de>\nSigned-off-by: NeilBrown <neilb@suse.de>\nSigned-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>", "parents": ["b5fdf66f6eb2560784c6f60131dc567de06267dc"], "refs": [], "diff": "diff --git a/fs/nfs/file.c b/fs/nfs/file.c\nindex 4d681683d13c..93c01aaa0a8d 100644\n--- a/fs/nfs/file.c\n+++ b/fs/nfs/file.c\n@@ -44,11 +44,6 @@\n \n static const struct vm_operations_struct nfs_file_vm_ops;\n \n-/* Hack for future NFS swap support */\n-#ifndef IS_SWAPFILE\n-# define IS_SWAPFILE(inode)\t(0)\n-#endif\n-\n int nfs_check_flags(int flags)\n {\n \tif ((flags & (O_APPEND | O_DIRECT)) == (O_APPEND | O_DIRECT))\n", "stats": " fs/nfs/file.c | 5 -----\n 1 file changed, 5 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "944d95f766c6fe97fa358c661281a741758cee7e"}, "tag": "linux", "timestamp": 1699830197.022186, "updated_on": 1647190775.0, "uuid": "be27876447afd5c9a84616983c75e42920925609"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Jiaxun Yang <jiaxun.yang@flygoat.com>", "AuthorDate": "Thu Nov 3 15:10:53 2022 +0000", "Commit": "Thomas Bogendoerfer <tsbogend@alpha.franken.de>", "CommitDate": "Fri Nov 11 15:46:03 2022 +0100", "Signed-off-by": ["Jiaxun Yang <jiaxun.yang@flygoat.com>", "Thomas Bogendoerfer <tsbogend@alpha.franken.de>"], "commit": "64ac0befe75bdfaffc396c2b4a0ed5ae6920eeee", "files": [{"action": "M", "added": "1", "file": "arch/mips/kernel/jump_label.c", "indexes": ["71a882c8c6eb", "f7978d50a2ba"], "modes": ["100644", "100644"], "removed": "1"}], "message": "MIPS: jump_label: Fix compat branch range check\n\nCast upper bound of branch range to long to do signed compare,\navoid negative offset trigger this warning.\n\nFixes: 9b6584e35f40 (\"MIPS: jump_label: Use compact branches for >= r6\")\nSigned-off-by: Jiaxun Yang <jiaxun.yang@flygoat.com>\nCc: stable@vger.kernel.org\nReviewed-by: Philippe Mathieu-Daud\u00e9 <philmd@linaro.org>\nSigned-off-by: Thomas Bogendoerfer <tsbogend@alpha.franken.de>", "parents": ["2a296157859287c3b639f7228354c13f7182ed71"], "refs": [], "diff": "diff --git a/arch/mips/kernel/jump_label.c b/arch/mips/kernel/jump_label.c\nindex 71a882c8c6eb..f7978d50a2ba 100644\n--- a/arch/mips/kernel/jump_label.c\n+++ b/arch/mips/kernel/jump_label.c\n@@ -56,7 +56,7 @@ void arch_jump_label_transform(struct jump_entry *e,\n \t\t\t * The branch offset must fit in the instruction's 26\n \t\t\t * bit field.\n \t\t\t */\n-\t\t\tWARN_ON((offset >= BIT(25)) ||\n+\t\t\tWARN_ON((offset >= (long)BIT(25)) ||\n \t\t\t\t(offset < -(long)BIT(25)));\n \n \t\t\tinsn.j_format.opcode = bc6_op;\n", "stats": " arch/mips/kernel/jump_label.c | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "64ac0befe75bdfaffc396c2b4a0ed5ae6920eeee"}, "tag": "linux", "timestamp": 1699830822.411466, "updated_on": 1668177963.0, "uuid": "2ce0744d31671302fdd216576037efc12c7c5132"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Al Viro <viro@zeniv.linux.org.uk>", "AuthorDate": "Sun Aug 21 02:02:33 2022 +0100", "Commit": "Greg Kroah-Hartman <gregkh@linuxfoundation.org>", "CommitDate": "Tue Aug 30 14:25:02 2022 +0200", "Signed-off-by": ["Al Viro <viro@zeniv.linux.org.uk>", "Greg Kroah-Hartman <gregkh@linuxfoundation.org>"], "commit": "0c7833b9e86d61cdfe44c2af17dcf8a08ba0ee61", "files": [{"action": "M", "added": "0", "file": "drivers/tty/n_hdlc.c", "indexes": ["94c1ec2dd754", "5540d9be65ea"], "modes": ["100644", "100644"], "removed": "1"}], "message": "termios: get rid of stray asm/termios.h include in n_hdlc.c\n\nthat's the only one outside of include/uapi/linux/termios.h and it's\nnot even needed there - we have linux/tty.h already pulled and that\npulls linux/termios.h\n\nNormally I would not consider that a sufficient reason, but there's a\nplenty of linux/tty.h users, and this is the only one that follows that\nwith asm/termios.h.  The situation with termios.h is genuinely convoluted,\nand this complicates it for no good reason.\n\nSigned-off-by: Al Viro <viro@zeniv.linux.org.uk>\nLink: https://lore.kernel.org/r/20220821010239.1554132-2-viro@zeniv.linux.org.uk\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>", "parents": ["6f418aeaadb78bd820f74961df48876ab194cd7a"], "refs": [], "diff": "diff --git a/drivers/tty/n_hdlc.c b/drivers/tty/n_hdlc.c\nindex 94c1ec2dd754..5540d9be65ea 100644\n--- a/drivers/tty/n_hdlc.c\n+++ b/drivers/tty/n_hdlc.c\n@@ -98,7 +98,6 @@\n #include <linux/if.h>\n #include <linux/bitops.h>\n \n-#include <asm/termios.h>\n #include <linux/uaccess.h>\n #include \"tty.h\"\n \n", "stats": " drivers/tty/n_hdlc.c | 1 -\n 1 file changed, 1 deletion(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "0c7833b9e86d61cdfe44c2af17dcf8a08ba0ee61"}, "tag": "linux", "timestamp": 1699830733.511542, "updated_on": 1661862302.0, "uuid": "0017f000571c7caff08b4a227e1dc9e390bc92e9"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Pavel Begunkov <asml.silence@gmail.com>", "AuthorDate": "Fri Oct 21 11:16:41 2022 +0100", "Commit": "Jens Axboe <axboe@kernel.dk>", "CommitDate": "Sat Oct 22 08:43:03 2022 -0600", "Signed-off-by": ["Pavel Begunkov <asml.silence@gmail.com>", "Jens Axboe <axboe@kernel.dk>"], "commit": "cc767e7c6913f770741d9fad1efa4957c2623744", "files": [{"action": "M", "added": "2", "file": "io_uring/net.c", "indexes": ["26ff3675214d", "15dea91625e2"], "modes": ["100644", "100644"], "removed": "0"}], "message": "io_uring/net: fail zc sendmsg when unsupported by socket\n\nThe previous patch fails zerocopy send requests for protocols that don't\nsupport it, do the same for zerocopy sendmsg.\n\nSigned-off-by: Pavel Begunkov <asml.silence@gmail.com>\nLink: https://lore.kernel.org/r/0854e7bb4c3d810a48ec8b5853e2f61af36a0467.1666346426.git.asml.silence@gmail.com\nSigned-off-by: Jens Axboe <axboe@kernel.dk>", "parents": ["edf81438799ccead7122948446d7e44b083e788d"], "refs": [], "diff": "diff --git a/io_uring/net.c b/io_uring/net.c\nindex 26ff3675214d..15dea91625e2 100644\n--- a/io_uring/net.c\n+++ b/io_uring/net.c\n@@ -1153,6 +1153,8 @@ int io_sendmsg_zc(struct io_kiocb *req, unsigned int issue_flags)\n \tsock = sock_from_file(req->file);\n \tif (unlikely(!sock))\n \t\treturn -ENOTSOCK;\n+\tif (!test_bit(SOCK_SUPPORT_ZC, &sock->flags))\n+\t\treturn -EOPNOTSUPP;\n \n \tif (req_has_async_data(req)) {\n \t\tkmsg = req->async_data;\n", "stats": " io_uring/net.c | 2 ++\n 1 file changed, 2 insertions(+)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "cc767e7c6913f770741d9fad1efa4957c2623744"}, "tag": "linux", "timestamp": 1699830808.037573, "updated_on": 1666449783.0, "uuid": "9df639ab4521907eda0606f6eb09fe424d3533b3"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Biju Das <biju.das.jz@bp.renesas.com>", "AuthorDate": "Mon Jul 18 13:14:40 2022 +0100", "Commit": "Daniel Lezcano <daniel.lezcano@linaro.org>", "CommitDate": "Thu Jul 28 17:29:49 2022 +0200", "Signed-off-by": ["Biju Das <biju.das.jz@bp.renesas.com>", "Daniel Lezcano <daniel.lezcano@linaro.org>"], "commit": "8f5a9371e69664cf4ad22a84204340323d5165cc", "files": [{"action": "M", "added": "11", "file": "drivers/thermal/rzg2l_thermal.c", "indexes": ["be07e04c6926", "51ae80eda6af"], "modes": ["100644", "100644"], "removed": "7"}], "message": "thermal/drivers/rzg2l: Fix comments\n\nThis patch replaces 'Capture times'->'Total number of ADC data samples' as\nthe former does not really explain much.\n\nIt also fixes the typo\n * caliberation->calibration\n\nLastly, as per the coding style /* should be on a separate line.\nThis patch fixes this issue.\n\nReported-by: Pavel Machek <pavel@denx.de>\nSigned-off-by: Biju Das <biju.das.jz@bp.renesas.com>\nLink: https://lore.kernel.org/r/20220718121440.556408-1-biju.das.jz@bp.renesas.com\nSigned-off-by: Daniel Lezcano <daniel.lezcano@linaro.org>", "parents": ["11188b439974b8ef8fe8c4c6df6ab8b6486c8c45"], "refs": [], "diff": "diff --git a/drivers/thermal/rzg2l_thermal.c b/drivers/thermal/rzg2l_thermal.c\nindex be07e04c6926..51ae80eda6af 100644\n--- a/drivers/thermal/rzg2l_thermal.c\n+++ b/drivers/thermal/rzg2l_thermal.c\n@@ -47,7 +47,7 @@\n \n #define TS_CODE_AVE_SCALE(x)\t((x) * 1000000)\n #define MCELSIUS(temp)\t\t((temp) * MILLIDEGREE_PER_DEGREE)\n-#define TS_CODE_CAP_TIMES\t8\t/* Capture  times */\n+#define TS_CODE_CAP_TIMES\t8\t/* Total number of ADC data samples */\n \n #define RZG2L_THERMAL_GRAN\t500\t/* milli Celsius */\n #define RZG2L_TSU_SS_TIMEOUT_US\t1000\n@@ -80,7 +80,8 @@ static int rzg2l_thermal_get_temp(void *devdata, int *temp)\n \tint val, i;\n \n \tfor (i = 0; i < TS_CODE_CAP_TIMES ; i++) {\n-\t\t/* TSU repeats measurement at 20 microseconds intervals and\n+\t\t/*\n+\t\t * TSU repeats measurement at 20 microseconds intervals and\n \t\t * automatically updates the results of measurement. As per\n \t\t * the HW manual for measuring temperature we need to read 8\n \t\t * values consecutively and then take the average.\n@@ -92,16 +93,18 @@ static int rzg2l_thermal_get_temp(void *devdata, int *temp)\n \n \tts_code_ave = result / TS_CODE_CAP_TIMES;\n \n-\t/* Calculate actual sensor value by applying curvature correction formula\n+\t/*\n+\t * Calculate actual sensor value by applying curvature correction formula\n \t * dsensor = ts_code_ave / (1 + ts_code_ave * 0.000013). Here we are doing\n \t * integer calculation by scaling all the values by 1000000.\n \t */\n \tdsensor = TS_CODE_AVE_SCALE(ts_code_ave) /\n \t\t(TS_CODE_AVE_SCALE(1) + (ts_code_ave * CURVATURE_CORRECTION_CONST));\n \n-\t/* The temperature Tj is calculated by the formula\n+\t/*\n+\t * The temperature Tj is calculated by the formula\n \t * Tj = (dsensor \u2212 calib1) * 165/ (calib0 \u2212 calib1) \u2212 40\n-\t * where calib0 and calib1 are the caliberation values.\n+\t * where calib0 and calib1 are the calibration values.\n \t */\n \tval = ((dsensor - priv->calib1) * (MCELSIUS(165) /\n \t\t(priv->calib0 - priv->calib1))) - MCELSIUS(40);\n@@ -122,7 +125,8 @@ static int rzg2l_thermal_init(struct rzg2l_thermal_priv *priv)\n \trzg2l_thermal_write(priv, TSU_SM, TSU_SM_NORMAL_MODE);\n \trzg2l_thermal_write(priv, TSU_ST, 0);\n \n-\t/* Before setting the START bit, TSU should be in normal operating\n+\t/*\n+\t * Before setting the START bit, TSU should be in normal operating\n \t * mode. As per the HW manual, it will take 60 \u00b5s to place the TSU\n \t * into normal operating mode.\n \t */\n@@ -217,7 +221,7 @@ static int rzg2l_thermal_probe(struct platform_device *pdev)\n \tif (ret)\n \t\tgoto err;\n \n-\tdev_dbg(dev, \"TSU probed with %s caliberation values\",\n+\tdev_dbg(dev, \"TSU probed with %s calibration values\",\n \t\trzg2l_thermal_read(priv, OTPTSUTRIM_REG(0)) ?  \"hw\" : \"sw\");\n \n \treturn 0;\n", "stats": " drivers/thermal/rzg2l_thermal.c | 18 +++++++++++-------\n 1 file changed, 11 insertions(+), 7 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "8f5a9371e69664cf4ad22a84204340323d5165cc"}, "tag": "linux", "timestamp": 1699830481.762004, "updated_on": 1659022189.0, "uuid": "65ef755e43b0d4e8514156af8def08a5ee2ee398"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Lad Prabhakar <prabhakar.mahadev-lad.rj@bp.renesas.com>", "AuthorDate": "Tue Mar 8 21:15:43 2022 +0000", "Commit": "Rob Herring <robh@kernel.org>", "CommitDate": "Wed Apr 6 16:49:11 2022 -0500", "Signed-off-by": ["Lad Prabhakar <prabhakar.mahadev-lad.rj@bp.renesas.com>", "Rob Herring <robh@kernel.org>"], "commit": "5dc6ce767dc8ba173534fa75c66a9e2a13b969d1", "files": [{"action": "M", "added": "4", "file": "Documentation/devicetree/bindings/gpu/arm,mali-bifrost.yaml", "indexes": ["4d6bfae0653c", "85f8d4764740"], "modes": ["100644", "100644"], "removed": "1"}], "message": "dt-bindings: gpu: mali-bifrost: Document RZ/V2L SoC\n\nThe Renesas RZ/V2L SoC (a.k.a R9A07G054) has a Bifrost Mali-G31 GPU,\nadd a compatible string for it.\n\nSigned-off-by: Lad Prabhakar <prabhakar.mahadev-lad.rj@bp.renesas.com>\nReviewed-by: Biju Das <biju.das.jz@bp.renesas.com>\nReviewed-by: Geert Uytterhoeven <geert+renesas@glider.be>\nAcked-by: Krzysztof Kozlowski <krzysztof.kozlowski@canonical.com>\nSigned-off-by: Rob Herring <robh@kernel.org>\nLink: https://lore.kernel.org/r/20220308211543.3081-1-prabhakar.mahadev-lad.rj@bp.renesas.com", "parents": ["ce8b3ad1071b764e963d9b08ac34ffddddf12da6"], "refs": [], "diff": "diff --git a/Documentation/devicetree/bindings/gpu/arm,mali-bifrost.yaml b/Documentation/devicetree/bindings/gpu/arm,mali-bifrost.yaml\nindex 4d6bfae0653c..85f8d4764740 100644\n--- a/Documentation/devicetree/bindings/gpu/arm,mali-bifrost.yaml\n+++ b/Documentation/devicetree/bindings/gpu/arm,mali-bifrost.yaml\n@@ -20,6 +20,7 @@ properties:\n           - mediatek,mt8183-mali\n           - realtek,rtd1619-mali\n           - renesas,r9a07g044-mali\n+          - renesas,r9a07g054-mali\n           - rockchip,px30-mali\n           - rockchip,rk3568-mali\n       - const: arm,mali-bifrost # Mali Bifrost GPU model/revision is fully discoverable\n@@ -109,7 +110,9 @@ allOf:\n       properties:\n         compatible:\n           contains:\n-            const: renesas,r9a07g044-mali\n+            enum:\n+              - renesas,r9a07g044-mali\n+              - renesas,r9a07g054-mali\n     then:\n       properties:\n         interrupts:\n", "stats": " Documentation/devicetree/bindings/gpu/arm,mali-bifrost.yaml | 5 ++++-\n 1 file changed, 4 insertions(+), 1 deletion(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "5dc6ce767dc8ba173534fa75c66a9e2a13b969d1"}, "tag": "linux", "timestamp": 1699830226.055883, "updated_on": 1649281751.0, "uuid": "8ee5d5a2af77c68f195f7261e7b44aa6da686ad1"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Johannes Berg <johannes.berg@intel.com>", "AuthorDate": "Wed Jun 22 10:17:23 2022 +0200", "Commit": "Johannes Berg <johannes.berg@intel.com>", "CommitDate": "Fri Jul 15 11:43:14 2022 +0200", "Signed-off-by": ["Johannes Berg <johannes.berg@intel.com>"], "commit": "23cc6d8c37cdbe3b2b74a922f3311ecb2a5aea6c", "files": [{"action": "M", "added": "2", "file": "include/net/cfg80211.h", "indexes": ["c904cbd1c4d6", "a4e2cb2378b8"], "modes": ["100644", "100644"], "removed": "1"}], "message": "wifi: cfg80211: make cfg80211_auth_request::key_idx signed\n\nWe might assign -1 to it in some cases when key is NULL,\nwhich means the key_idx isn't used but can lead to a\nwarning from static checkers such as smatch.\n\nMake the struct member signed simply to avoid that, we\nonly need a range of -1..3 anyway.\n\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>", "parents": ["c0d6701261dbfa29902ca64c7b57b1cc5f0c2533"], "refs": [], "diff": "diff --git a/include/net/cfg80211.h b/include/net/cfg80211.h\nindex c904cbd1c4d6..a4e2cb2378b8 100644\n--- a/include/net/cfg80211.h\n+++ b/include/net/cfg80211.h\n@@ -2773,7 +2773,8 @@ struct cfg80211_auth_request {\n \tsize_t ie_len;\n \tenum nl80211_auth_type auth_type;\n \tconst u8 *key;\n-\tu8 key_len, key_idx;\n+\tu8 key_len;\n+\ts8 key_idx;\n \tconst u8 *auth_data;\n \tsize_t auth_data_len;\n \ts8 link_id;\n", "stats": " include/net/cfg80211.h | 3 ++-\n 1 file changed, 2 insertions(+), 1 deletion(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "23cc6d8c37cdbe3b2b74a922f3311ecb2a5aea6c"}, "tag": "linux", "timestamp": 1699830516.622706, "updated_on": 1657878194.0, "uuid": "623ef82897f5d71ad4597c7f6f4d19efd67f08ae"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Johannes Berg <johannes.berg@intel.com>", "AuthorDate": "Tue Sep 6 16:42:10 2022 +0300", "Commit": "Gregory Greenman <gregory.greenman@intel.com>", "CommitDate": "Sun Sep 18 14:40:14 2022 +0300", "Signed-off-by": ["Johannes Berg <johannes.berg@intel.com>", "Gregory Greenman <gregory.greenman@intel.com>", "Gregory Greenman <gregory.greenman@intel.com>"], "commit": "fab6f4904e2f722fbf8126f9ee229b46c2044627", "files": [{"action": "M", "added": "3", "file": "drivers/net/wireless/intel/iwlwifi/cfg/22000.c", "indexes": ["c949675ca2ed", "110fda65bd21"], "modes": ["100644", "100644"], "removed": "6"}], "message": "wifi: iwlwifi: cfg: remove IWL_DEVICE_BZ_COMMON macro\n\nWe only have a single use of this inside the IWL_DEVICE_BZ\nmacro, so just combine the contents here.\n\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>\nSigned-off-by: Gregory Greenman <gregory.greenman@intel.com>\nLink: https://lore.kernel.org/r/20220906161827.23d6c92e9a11.I4a11928a6d698079dc742e3ba3d3ce6fd7a878d1@changeid\nSigned-off-by: Gregory Greenman <gregory.greenman@intel.com>", "parents": ["7138763e02d1585659a5e82d517f096459985704"], "refs": [], "diff": "diff --git a/drivers/net/wireless/intel/iwlwifi/cfg/22000.c b/drivers/net/wireless/intel/iwlwifi/cfg/22000.c\nindex c949675ca2ed..110fda65bd21 100644\n--- a/drivers/net/wireless/intel/iwlwifi/cfg/22000.c\n+++ b/drivers/net/wireless/intel/iwlwifi/cfg/22000.c\n@@ -249,7 +249,7 @@ static const struct iwl_ht_params iwl_22000_ht_params = {\n \t\t},\t\t\t\t\t\t\t\\\n \t}\n \n-#define IWL_DEVICE_BZ_COMMON\t\t\t\t\t\t\\\n+#define IWL_DEVICE_BZ\t\t\t\t\t\t\t\\\n \t.ucode_api_max = IWL_22000_UCODE_API_MAX,\t\t\t\\\n \t.ucode_api_min = IWL_22000_UCODE_API_MIN,\t\t\t\\\n \t.led_mode = IWL_LED_RF_STATE,\t\t\t\t\t\\\n@@ -285,16 +285,13 @@ static const struct iwl_ht_params iwl_22000_ht_params = {\n \t\t\t.addr = LDBG_M2S_BUF_WRAP_CNT,\t\t\t\\\n \t\t\t.mask = LDBG_M2S_BUF_WRAP_CNT_VAL_MSK,\t\t\\\n \t\t},\t\t\t\t\t\t\t\\\n-\t}\n-\n-#define IWL_DEVICE_BZ\t\t\t\t\t\t\t\\\n-\tIWL_DEVICE_BZ_COMMON,\t\t\t\t\t\t\\\n+\t},\t\t\t\t\t\t\t\t\\\n \t.trans.umac_prph_offset = 0x300000,\t\t\t\t\\\n \t.trans.device_family = IWL_DEVICE_FAMILY_BZ,\t\t\t\\\n \t.trans.base_params = &iwl_ax210_base_params,\t\t\t\\\n \t.min_txq_size = 128,\t\t\t\t\t\t\\\n \t.gp2_reg_addr = 0xd02c68,\t\t\t\t\t\\\n-\t.min_ba_txq_size = IWL_DEFAULT_QUEUE_SIZE_EHT,\t\t\\\n+\t.min_ba_txq_size = IWL_DEFAULT_QUEUE_SIZE_EHT,\t\t\t\\\n \t.mon_dram_regs = {\t\t\t\t\t\t\\\n \t\t.write_ptr = {\t\t\t\t\t\t\\\n \t\t\t.addr = DBGC_CUR_DBGBUF_STATUS,\t\t\t\\\n", "stats": " drivers/net/wireless/intel/iwlwifi/cfg/22000.c | 9 +++------\n 1 file changed, 3 insertions(+), 6 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "fab6f4904e2f722fbf8126f9ee229b46c2044627"}, "tag": "linux", "timestamp": 1699830682.305216, "updated_on": 1663501214.0, "uuid": "b93846701cf9978700eedfdff1f8a196bbbbf985"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Leo Yan <leo.yan@linaro.org>", "AuthorDate": "Wed May 18 13:57:21 2022 +0800", "Commit": "Arnaldo Carvalho de Melo <acme@redhat.com>", "CommitDate": "Mon May 23 09:36:47 2022 -0300", "Signed-off-by": ["Leo Yan <leo.yan@linaro.org>", "Arnaldo Carvalho de Melo <acme@redhat.com>"], "commit": "12aeaaba087d6d922423e88b0de7d145bc5d8de7", "files": [{"action": "M", "added": "5", "file": "tools/perf/Documentation/perf-c2c.txt", "indexes": ["3b6a2c84ea02", "6f69173731aa"], "modes": ["100644", "100644"], "removed": "3"}], "message": "perf c2c: Update documentation for store metric 'N/A'\n\nThe 'N/A' metric is added for store operations, update documentation to\nreflect changes in the report table.\n\nSigned-off-by: Leo Yan <leo.yan@linaro.org>\nAcked-by: Jiri Olsa <jolsa@kernel.org>\nCc: Adam Li <adamli@amperemail.onmicrosoft.com>\nCc: Alexander Shishkin <alexander.shishkin@linux.intel.com>\nCc: Ali Saidi <alisaidi@amazon.com>\nCc: Alyssa Ross <hi@alyssa.is>\nCc: German Gomez <german.gomez@arm.com>\nCc: Ian Rogers <irogers@google.com>\nCc: Ingo Molnar <mingo@redhat.com>\nCc: James Clark <james.clark@arm.com>\nCc: Joe Mario <jmario@redhat.com>\nCc: Kajol Jain <kjain@linux.ibm.com>\nCc: Kan Liang <kan.liang@linux.intel.com>\nCc: Li Huafei <lihuafei1@huawei.com>\nCc: Like Xu <likexu@tencent.com>\nCc: Mark Rutland <mark.rutland@arm.com>\nCc: Namhyung Kim <namhyung@kernel.org>\nCc: Peter Zijlstra <peterz@infradead.org>\nLink: https://lore.kernel.org/r/20220518055729.1869566-4-leo.yan@linaro.org\nSigned-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>", "parents": ["550b4d6f9a7e5ddc99d7d13652ba9e859d0e5361"], "refs": [], "diff": "diff --git a/tools/perf/Documentation/perf-c2c.txt b/tools/perf/Documentation/perf-c2c.txt\nindex 3b6a2c84ea02..6f69173731aa 100644\n--- a/tools/perf/Documentation/perf-c2c.txt\n+++ b/tools/perf/Documentation/perf-c2c.txt\n@@ -189,9 +189,10 @@ For each cacheline in the 1) list we display following data:\n   Total stores\n   - sum of all store accesses\n \n-  Store Reference - L1Hit, L1Miss\n+  Store Reference - L1Hit, L1Miss, N/A\n     L1Hit - store accesses that hit L1\n     L1Miss - store accesses that missed L1\n+    N/A - store accesses with memory level is not available\n \n   Core Load Hit - FB, L1, L2\n   - count of load hits in FB (Fill Buffer), L1 and L2 cache\n@@ -210,8 +211,9 @@ For each offset in the 2) list we display following data:\n   HITM - Rmt, Lcl\n   - % of Remote/Local HITM accesses for given offset within cacheline\n \n-  Store Refs - L1 Hit, L1 Miss\n-  - % of store accesses that hit/missed L1 for given offset within cacheline\n+  Store Refs - L1 Hit, L1 Miss, N/A\n+  - % of store accesses that hit L1, missed L1 and N/A (no available) memory\n+    level for given offset within cacheline\n \n   Data address - Offset\n   - offset address\n", "stats": " tools/perf/Documentation/perf-c2c.txt | 8 +++++---\n 1 file changed, 5 insertions(+), 3 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "12aeaaba087d6d922423e88b0de7d145bc5d8de7"}, "tag": "linux", "timestamp": 1699830320.117081, "updated_on": 1653309407.0, "uuid": "284a3f9ed5130c2c34b7a5f3d0371dd207d941d3"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Bitterblue Smith <rtl8821cerfe2@gmail.com>", "AuthorDate": "Tue Nov 1 22:33:49 2022 +0200", "Commit": "Kalle Valo <kvalo@kernel.org>", "CommitDate": "Fri Nov 4 13:01:34 2022 +0200", "Signed-off-by": ["Bitterblue Smith <rtl8821cerfe2@gmail.com>", "Kalle Valo <kvalo@kernel.org>"], "commit": "7b0ac469e331d9f9fd77f4ebb7a6322f5562db67", "files": [{"action": "M", "added": "5", "file": "drivers/net/wireless/realtek/rtl8xxxu/rtl8xxxu_core.c", "indexes": ["51cb22ee55cd", "823e50811b0d"], "modes": ["100644", "100644"], "removed": "21"}], "message": "wifi: rtl8xxxu: Recognise all possible chip cuts\n\nThe chip cut, also known as the chip version, is a letter from A (0)\nto P (15). Recognise them all instead of printing \"unknown\" when it's\ngreater than E.\n\nSigned-off-by: Bitterblue Smith <rtl8821cerfe2@gmail.com>\nSigned-off-by: Kalle Valo <kvalo@kernel.org>\nLink: https://lore.kernel.org/r/1559c705-0b0b-8dcb-7596-fbb85844d3d9@gmail.com", "parents": ["2ad2a813b803593832fa10b2c3d6d6065aec17ad"], "refs": [], "diff": "diff --git a/drivers/net/wireless/realtek/rtl8xxxu/rtl8xxxu_core.c b/drivers/net/wireless/realtek/rtl8xxxu/rtl8xxxu_core.c\nindex 51cb22ee55cd..823e50811b0d 100644\n--- a/drivers/net/wireless/realtek/rtl8xxxu/rtl8xxxu_core.c\n+++ b/drivers/net/wireless/realtek/rtl8xxxu/rtl8xxxu_core.c\n@@ -1574,30 +1574,14 @@ rtl8xxxu_set_spec_sifs(struct rtl8xxxu_priv *priv, u16 cck, u16 ofdm)\n static void rtl8xxxu_print_chipinfo(struct rtl8xxxu_priv *priv)\n {\n \tstruct device *dev = &priv->udev->dev;\n-\tchar *cut;\n+\tchar cut = '?';\n \n-\tswitch (priv->chip_cut) {\n-\tcase 0:\n-\t\tcut = \"A\";\n-\t\tbreak;\n-\tcase 1:\n-\t\tcut = \"B\";\n-\t\tbreak;\n-\tcase 2:\n-\t\tcut = \"C\";\n-\t\tbreak;\n-\tcase 3:\n-\t\tcut = \"D\";\n-\t\tbreak;\n-\tcase 4:\n-\t\tcut = \"E\";\n-\t\tbreak;\n-\tdefault:\n-\t\tcut = \"unknown\";\n-\t}\n+\t/* Currently always true: chip_cut is 4 bits. */\n+\tif (priv->chip_cut <= 15)\n+\t\tcut = 'A' + priv->chip_cut;\n \n \tdev_info(dev,\n-\t\t \"RTL%s rev %s (%s) %iT%iR, TX queues %i, WiFi=%i, BT=%i, GPS=%i, HI PA=%i\\n\",\n+\t\t \"RTL%s rev %c (%s) %iT%iR, TX queues %i, WiFi=%i, BT=%i, GPS=%i, HI PA=%i\\n\",\n \t\t priv->chip_name, cut, priv->chip_vendor, priv->tx_paths,\n \t\t priv->rx_paths, priv->ep_tx_count, priv->has_wifi,\n \t\t priv->has_bluetooth, priv->has_gps, priv->hi_pa);\n", "stats": " .../net/wireless/realtek/rtl8xxxu/rtl8xxxu_core.c  | 26 +++++-----------------\n 1 file changed, 5 insertions(+), 21 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "7b0ac469e331d9f9fd77f4ebb7a6322f5562db67"}, "tag": "linux", "timestamp": 1699830991.519429, "updated_on": 1667559694.0, "uuid": "6f1ddb30a1a375e0453518fdb058d19a82b1c798"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Lai Jiangshan <jiangshan.ljs@antgroup.com>", "AuthorDate": "Wed Dec 7 20:05:05 2022 +0800", "Commit": "Paolo Bonzini <pbonzini@redhat.com>", "CommitDate": "Tue Dec 27 06:00:51 2022 -0500", "Signed-off-by": ["Lai Jiangshan <jiangshan.ljs@antgroup.com>", "Paolo Bonzini <pbonzini@redhat.com>"], "commit": "562f5bc48a8d99a8898c734ecacf061a79a88fbf", "files": [{"action": "M", "added": "1", "file": "arch/x86/kvm/mmu/spte.h", "indexes": ["1f03701b943a", "6f54dc9409c9"], "modes": ["100644", "100644"], "removed": "1"}], "message": "kvm: x86/mmu: Remove duplicated \"be split\" in spte.h\n\n\"be split be split\" -> \"be split\"\n\nSigned-off-by: Lai Jiangshan <jiangshan.ljs@antgroup.com>\nMessage-Id: <20221207120505.9175-1-jiangshanlai@gmail.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>", "parents": ["a303def0fc18f0f2393b5c5f8ae3d2657a9713dc"], "refs": [], "diff": "diff --git a/arch/x86/kvm/mmu/spte.h b/arch/x86/kvm/mmu/spte.h\nindex 1f03701b943a..6f54dc9409c9 100644\n--- a/arch/x86/kvm/mmu/spte.h\n+++ b/arch/x86/kvm/mmu/spte.h\n@@ -363,7 +363,7 @@ static __always_inline bool is_rsvd_spte(struct rsvd_bits_validate *rsvd_check,\n  * A shadow-present leaf SPTE may be non-writable for 4 possible reasons:\n  *\n  *  1. To intercept writes for dirty logging. KVM write-protects huge pages\n- *     so that they can be split be split down into the dirty logging\n+ *     so that they can be split down into the dirty logging\n  *     granularity (4KiB) whenever the guest writes to them. KVM also\n  *     write-protects 4KiB pages so that writes can be recorded in the dirty log\n  *     (e.g. if not using PML). SPTEs are write-protected for dirty logging\n", "stats": " arch/x86/kvm/mmu/spte.h | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "562f5bc48a8d99a8898c734ecacf061a79a88fbf"}, "tag": "linux", "timestamp": 1699831057.638065, "updated_on": 1672138851.0, "uuid": "f276f3f5a88e43d5d96b3467c9b2b64823751942"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Marc Kleine-Budde <mkl@pengutronix.de>", "AuthorDate": "Sat Oct 23 00:27:13 2021 +0200", "Commit": "Marc Kleine-Budde <mkl@pengutronix.de>", "CommitDate": "Sat Jan 8 20:17:42 2022 +0100", "Signed-off-by": ["Marc Kleine-Budde <mkl@pengutronix.de>"], "commit": "3044a4f271d278858321675d367b37bcafca186c", "files": [{"action": "M", "added": "2", "file": "drivers/net/can/spi/mcp251xfd/mcp251xfd-chip-fifo.c", "indexes": ["ce94dd744a93", "2f9a623d381d"], "modes": ["100644", "100644"], "removed": "2"}, {"action": "M", "added": "1", "file": "drivers/net/can/spi/mcp251xfd/mcp251xfd-ring.c", "indexes": ["ffb3691c4ba7", "92f9e9b01289"], "modes": ["100644", "100644"], "removed": "2"}, {"action": "M", "added": "6", "file": "drivers/net/can/spi/mcp251xfd/mcp251xfd.h", "indexes": ["597786a85621", "f551c900803e"], "modes": ["100644", "100644"], "removed": "0"}], "message": "can: mcp251xfd: introduce and make use of mcp251xfd_is_fd_mode()\n\nThis patch replaces the open coded check, if the chip's FIFOs are\nconfigured for CAN-FD mode, by the newly introduced function\nmcp251xfd_is_fd_mode().\n\nLink: https://lore.kernel.org/all/20220105154300.1258636-14-mkl@pengutronix.de\nSigned-off-by: Marc Kleine-Budde <mkl@pengutronix.de>", "parents": ["55bc37c85587d0c53a666a685a49752e28a31396"], "refs": [], "diff": "diff --git a/drivers/net/can/spi/mcp251xfd/mcp251xfd-chip-fifo.c b/drivers/net/can/spi/mcp251xfd/mcp251xfd-chip-fifo.c\nindex ce94dd744a93..2f9a623d381d 100644\n--- a/drivers/net/can/spi/mcp251xfd/mcp251xfd-chip-fifo.c\n+++ b/drivers/net/can/spi/mcp251xfd/mcp251xfd-chip-fifo.c\n@@ -34,7 +34,7 @@ mcp251xfd_chip_rx_fifo_init_one(const struct mcp251xfd_priv *priv,\n \t\tMCP251XFD_REG_FIFOCON_RXOVIE |\n \t\tMCP251XFD_REG_FIFOCON_TFNRFNIE;\n \n-\tif (priv->can.ctrlmode & (CAN_CTRLMODE_LISTENONLY | CAN_CTRLMODE_FD))\n+\tif (mcp251xfd_is_fd_mode(priv))\n \t\tfifo_con |= FIELD_PREP(MCP251XFD_REG_FIFOCON_PLSIZE_MASK,\n \t\t\t\t       MCP251XFD_REG_FIFOCON_PLSIZE_64);\n \telse\n@@ -84,7 +84,7 @@ int mcp251xfd_chip_fifo_init(const struct mcp251xfd_priv *priv)\n \t\tMCP251XFD_REG_FIFOCON_TXEN |\n \t\tMCP251XFD_REG_FIFOCON_TXATIE;\n \n-\tif (priv->can.ctrlmode & (CAN_CTRLMODE_LISTENONLY | CAN_CTRLMODE_FD))\n+\tif (mcp251xfd_is_fd_mode(priv))\n \t\tval |= FIELD_PREP(MCP251XFD_REG_FIFOCON_PLSIZE_MASK,\n \t\t\t\t  MCP251XFD_REG_FIFOCON_PLSIZE_64);\n \telse\ndiff --git a/drivers/net/can/spi/mcp251xfd/mcp251xfd-ring.c b/drivers/net/can/spi/mcp251xfd/mcp251xfd-ring.c\nindex ffb3691c4ba7..92f9e9b01289 100644\n--- a/drivers/net/can/spi/mcp251xfd/mcp251xfd-ring.c\n+++ b/drivers/net/can/spi/mcp251xfd/mcp251xfd-ring.c\n@@ -209,8 +209,7 @@ int mcp251xfd_ring_alloc(struct mcp251xfd_priv *priv)\n \tint ram_free, i;\n \n \ttef_obj_size = sizeof(struct mcp251xfd_hw_tef_obj);\n-\t/* listen-only mode works like FD mode */\n-\tif (priv->can.ctrlmode & (CAN_CTRLMODE_LISTENONLY | CAN_CTRLMODE_FD)) {\n+\tif (mcp251xfd_is_fd_mode(priv)) {\n \t\ttx_obj_num = MCP251XFD_TX_OBJ_NUM_CANFD;\n \t\ttx_obj_size = sizeof(struct mcp251xfd_hw_tx_obj_canfd);\n \t\trx_obj_size = sizeof(struct mcp251xfd_hw_rx_obj_canfd);\ndiff --git a/drivers/net/can/spi/mcp251xfd/mcp251xfd.h b/drivers/net/can/spi/mcp251xfd/mcp251xfd.h\nindex 597786a85621..f551c900803e 100644\n--- a/drivers/net/can/spi/mcp251xfd/mcp251xfd.h\n+++ b/drivers/net/can/spi/mcp251xfd/mcp251xfd.h\n@@ -626,6 +626,12 @@ MCP251XFD_IS(2517);\n MCP251XFD_IS(2518);\n MCP251XFD_IS(251X);\n \n+static inline bool mcp251xfd_is_fd_mode(const struct mcp251xfd_priv *priv)\n+{\n+\t/* listen-only mode works like FD mode */\n+\treturn priv->can.ctrlmode & (CAN_CTRLMODE_LISTENONLY | CAN_CTRLMODE_FD);\n+}\n+\n static inline u8 mcp251xfd_first_byte_set(u32 mask)\n {\n \treturn (mask & 0x0000ffff) ?\n", "stats": " drivers/net/can/spi/mcp251xfd/mcp251xfd-chip-fifo.c | 4 ++--\n drivers/net/can/spi/mcp251xfd/mcp251xfd-ring.c      | 3 +--\n drivers/net/can/spi/mcp251xfd/mcp251xfd.h           | 6 ++++++\n 3 files changed, 9 insertions(+), 4 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "3044a4f271d278858321675d367b37bcafca186c"}, "tag": "linux", "timestamp": 1699829948.571895, "updated_on": 1641669462.0, "uuid": "964e4580961cdc7d9e4a4c6336e31ecaae3b9488"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "N\u00edcolas F. R. A. Prado <nfraprado@collabora.com>", "AuthorDate": "Wed Nov 2 14:19:55 2022 -0400", "Commit": "Mark Brown <broonie@kernel.org>", "CommitDate": "Mon Nov 7 16:12:35 2022 +0000", "Signed-off-by": ["N\u00edcolas F. R. A. Prado <nfraprado@collabora.com>", "Mark Brown <broonie@kernel.org>"], "commit": "163460262782b183a28d07255403fa72151fa20b", "files": [{"action": "M", "added": "12", "file": "Documentation/devicetree/bindings/sound/realtek,rt5682s.yaml", "indexes": ["1c0b06d82369", "b7338bfc0f5a"], "modes": ["100644", "100644"], "removed": "0"}], "message": "ASoC: dt-bindings: realtek,rt5682s: Add AVDD and MICVDD supplies\n\nThe rt5682s codec has two supplies - AVDD and MICVDD - which are already\nused by sc7180-trogdor-kingoftown.dtsi. Document them in the binding.\n\nAcked-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>\nReviewed-by: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>\nSigned-off-by: N\u00edcolas F. R. A. Prado <nfraprado@collabora.com>\nLink: https://lore.kernel.org/r/20221102182002.255282-2-nfraprado@collabora.com\nSigned-off-by: Mark Brown <broonie@kernel.org>", "parents": ["4b19211435950a78af032c26ad64a5268e6012be"], "refs": [], "diff": "diff --git a/Documentation/devicetree/bindings/sound/realtek,rt5682s.yaml b/Documentation/devicetree/bindings/sound/realtek,rt5682s.yaml\nindex 1c0b06d82369..b7338bfc0f5a 100644\n--- a/Documentation/devicetree/bindings/sound/realtek,rt5682s.yaml\n+++ b/Documentation/devicetree/bindings/sound/realtek,rt5682s.yaml\n@@ -90,11 +90,20 @@ properties:\n   \"#sound-dai-cells\":\n     const: 1\n \n+  AVDD-supply:\n+    description: Regulator supplying analog power through the AVDD pin.\n+\n+  MICVDD-supply:\n+    description: Regulator supplying power for the microphone bias through the\n+      MICVDD pin.\n+\n additionalProperties: false\n \n required:\n   - compatible\n   - reg\n+  - AVDD-supply\n+  - MICVDD-supply\n \n examples:\n   - |\n@@ -120,5 +129,8 @@ examples:\n \n             clocks = <&osc>;\n             clock-names = \"mclk\";\n+\n+            AVDD-supply = <&avdd_reg>;\n+            MICVDD-supply = <&micvdd_reg>;\n         };\n     };\n", "stats": " Documentation/devicetree/bindings/sound/realtek,rt5682s.yaml | 12 ++++++++++++\n 1 file changed, 12 insertions(+)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "163460262782b183a28d07255403fa72151fa20b"}, "tag": "linux", "timestamp": 1699830918.739269, "updated_on": 1667837555.0, "uuid": "4e55cd70af1546f21af6de842a426ab3141bb580"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Tariq Toukan <tariqt@nvidia.com>", "AuthorDate": "Wed Sep 14 11:02:34 2022 +0300", "Commit": "Saeed Mahameed <saeedm@nvidia.com>", "CommitDate": "Sat Nov 12 02:20:19 2022 -0800", "Signed-off-by": ["Tariq Toukan <tariqt@nvidia.com>", "Saeed Mahameed <saeedm@nvidia.com>"], "commit": "1f74399fd1edea2eefd8d340f5d1f7c5f5edec66", "files": [{"action": "M", "added": "0", "file": "drivers/net/ethernet/mellanox/mlx5/core/en_accel/ktls_tx.c", "indexes": ["2e0335246967", "f8d9708feb7c"], "modes": ["100644", "100644"], "removed": "1"}], "message": "net/mlx5e: kTLS, Remove unused work field\n\nWork field in struct mlx5e_async_ctx is not used. Remove it.\n\nSigned-off-by: Tariq Toukan <tariqt@nvidia.com>\nReviewed-by: Gal Pressman <gal@nvidia.com>\nSigned-off-by: Saeed Mahameed <saeedm@nvidia.com>", "parents": ["989722906166173c703c1d73a26a0167fdad4136"], "refs": [], "diff": "diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en_accel/ktls_tx.c b/drivers/net/ethernet/mellanox/mlx5/core/en_accel/ktls_tx.c\nindex 2e0335246967..f8d9708feb7c 100644\n--- a/drivers/net/ethernet/mellanox/mlx5/core/en_accel/ktls_tx.c\n+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_accel/ktls_tx.c\n@@ -126,7 +126,6 @@ mlx5e_get_ktls_tx_priv_ctx(struct tls_context *tls_ctx)\n struct mlx5e_async_ctx {\n \tstruct mlx5_async_work context;\n \tstruct mlx5_async_ctx async_ctx;\n-\tstruct work_struct work;\n \tstruct mlx5e_ktls_offload_context_tx *priv_tx;\n \tstruct completion complete;\n \tint err;\n", "stats": " drivers/net/ethernet/mellanox/mlx5/core/en_accel/ktls_tx.c | 1 -\n 1 file changed, 1 deletion(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "1f74399fd1edea2eefd8d340f5d1f7c5f5edec66"}, "tag": "linux", "timestamp": 1699830990.091355, "updated_on": 1668248419.0, "uuid": "7138b9e2ba2c8e768e6837aede11ddb0fa111a89"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Rob Herring <robh@kernel.org>", "AuthorDate": "Tue Mar 1 15:05:13 2022 -0600", "Commit": "Rob Clark <robdclark@chromium.org>", "CommitDate": "Tue Mar 1 16:34:25 2022 -0800", "Signed-off-by": ["Rob Herring <robh@kernel.org>", "Rob Clark <robdclark@chromium.org>"], "commit": "719ca379729002b0ec888069a36e508a26e51204", "files": [{"action": "M", "added": "2", "file": "Documentation/devicetree/bindings/display/msm/dpu-msm8998.yaml", "indexes": ["167bc48748d7", "2df64afb76e6"], "modes": ["100644", "100644"], "removed": "2"}, {"action": "M", "added": "1", "file": "Documentation/devicetree/bindings/display/msm/dpu-qcm2290.yaml", "indexes": ["8766b13f0c46", "28617bc1d2ff"], "modes": ["100644", "100644"], "removed": "1"}], "message": "dt-bindings: display/msm: Drop bogus interrupt flags cell on MDSS nodes\n\nThe MDSS interrupt provider is a single cell, so specifying interrupt flags\non the consumers is incorrect.\n\nSigned-off-by: Rob Herring <robh@kernel.org>\nReviewed-by: Dmitry Baryshkov <dmitry.baryshkov@linaro.org>\nLink: https://lore.kernel.org/r/20220301210513.1855076-1-robh@kernel.org\nSigned-off-by: Rob Clark <robdclark@chromium.org>", "parents": ["afab9d91d872819f98a792c32c302d9e3261f1a1"], "refs": [], "diff": "diff --git a/Documentation/devicetree/bindings/display/msm/dpu-msm8998.yaml b/Documentation/devicetree/bindings/display/msm/dpu-msm8998.yaml\nindex 167bc48748d7..2df64afb76e6 100644\n--- a/Documentation/devicetree/bindings/display/msm/dpu-msm8998.yaml\n+++ b/Documentation/devicetree/bindings/display/msm/dpu-msm8998.yaml\n@@ -155,7 +155,7 @@ examples:\n     #include <dt-bindings/interrupt-controller/arm-gic.h>\n     #include <dt-bindings/power/qcom-rpmpd.h>\n \n-    display-subsystem@c900000 {\n+    mdss: display-subsystem@c900000 {\n         compatible = \"qcom,msm8998-mdss\";\n         reg = <0x0c900000 0x1000>;\n         reg-names = \"mdss\";\n@@ -192,7 +192,7 @@ examples:\n             clock-names = \"iface\", \"bus\", \"mnoc\", \"core\", \"vsync\";\n \n             interrupt-parent = <&mdss>;\n-            interrupts = <0 IRQ_TYPE_LEVEL_HIGH>;\n+            interrupts = <0>;\n             operating-points-v2 = <&mdp_opp_table>;\n             power-domains = <&rpmpd MSM8998_VDDMX>;\n \ndiff --git a/Documentation/devicetree/bindings/display/msm/dpu-qcm2290.yaml b/Documentation/devicetree/bindings/display/msm/dpu-qcm2290.yaml\nindex 8766b13f0c46..28617bc1d2ff 100644\n--- a/Documentation/devicetree/bindings/display/msm/dpu-qcm2290.yaml\n+++ b/Documentation/devicetree/bindings/display/msm/dpu-qcm2290.yaml\n@@ -197,7 +197,7 @@ examples:\n                 power-domains = <&rpmpd QCM2290_VDDCX>;\n \n                 interrupt-parent = <&mdss>;\n-                interrupts = <0 IRQ_TYPE_NONE>;\n+                interrupts = <0>;\n \n                 ports {\n                         #address-cells = <1>;\n", "stats": " Documentation/devicetree/bindings/display/msm/dpu-msm8998.yaml | 4 ++--\n Documentation/devicetree/bindings/display/msm/dpu-qcm2290.yaml | 2 +-\n 2 files changed, 3 insertions(+), 3 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "719ca379729002b0ec888069a36e508a26e51204"}, "tag": "linux", "timestamp": 1699830169.210844, "updated_on": 1646181265.0, "uuid": "85ea45d6bea4e6881f225ad7551893ae295f2d56"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Nathan Chancellor <nathan@kernel.org>", "AuthorDate": "Mon Oct 17 09:28:38 2022 -0700", "Commit": "Alex Deucher <alexander.deucher@amd.com>", "CommitDate": "Tue Oct 18 22:13:12 2022 -0400", "Signed-off-by": ["Nathan Chancellor <nathan@kernel.org>", "Alex Deucher <alexander.deucher@amd.com>"], "commit": "e688ba3e276422aa88eae7a54186a95320836081", "files": [{"action": "M", "added": "3", "file": "drivers/gpu/drm/amd/include/kgd_kfd_interface.h", "indexes": ["e85364dff4e0", "5cb3e8634739"], "modes": ["100644", "100644"], "removed": "2"}], "message": "drm/amdkfd: Fix type of reset_type parameter in hqd_destroy() callback\n\nWhen booting a kernel compiled with CONFIG_CFI_CLANG on a machine with\nan RX 6700 XT, there is a CFI failure in kfd_destroy_mqd_cp():\n\n  [   12.894543] CFI failure at kfd_destroy_mqd_cp+0x2a/0x40 [amdgpu] (target: hqd_destroy_v10_3+0x0/0x260 [amdgpu]; expected type: 0x8594d794)\n\nClang's kernel Control Flow Integrity (kCFI) makes sure that all\nindirect call targets have a type that exactly matches the function\npointer prototype. In this case, hqd_destroy()'s third parameter,\nreset_type, should have a type of 'uint32_t' but every implementation of\nthis callback has a third parameter type of 'enum kfd_preempt_type'.\n\nUpdate the function pointer prototype to match reality so that there is\nno more CFI violation.\n\nLink: https://github.com/ClangBuiltLinux/linux/issues/1738\nSigned-off-by: Nathan Chancellor <nathan@kernel.org>\nSigned-off-by: Alex Deucher <alexander.deucher@amd.com>", "parents": ["8a70b2d89ea3f2dc1449f0634ca6befb41472f24"], "refs": [], "diff": "diff --git a/drivers/gpu/drm/amd/include/kgd_kfd_interface.h b/drivers/gpu/drm/amd/include/kgd_kfd_interface.h\nindex e85364dff4e0..5cb3e8634739 100644\n--- a/drivers/gpu/drm/amd/include/kgd_kfd_interface.h\n+++ b/drivers/gpu/drm/amd/include/kgd_kfd_interface.h\n@@ -262,8 +262,9 @@ struct kfd2kgd_calls {\n \t\t\t\tuint32_t queue_id);\n \n \tint (*hqd_destroy)(struct amdgpu_device *adev, void *mqd,\n-\t\t\t\tuint32_t reset_type, unsigned int timeout,\n-\t\t\t\tuint32_t pipe_id, uint32_t queue_id);\n+\t\t\t\tenum kfd_preempt_type reset_type,\n+\t\t\t\tunsigned int timeout, uint32_t pipe_id,\n+\t\t\t\tuint32_t queue_id);\n \n \tbool (*hqd_sdma_is_occupied)(struct amdgpu_device *adev, void *mqd);\n \n", "stats": " drivers/gpu/drm/amd/include/kgd_kfd_interface.h | 5 +++--\n 1 file changed, 3 insertions(+), 2 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "e688ba3e276422aa88eae7a54186a95320836081"}, "tag": "linux", "timestamp": 1699830792.510629, "updated_on": 1666145592.0, "uuid": "cd6904f25edbb384db230e87148f45db73f836c9"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Minghao Chi <chi.minghao@zte.com.cn>", "AuthorDate": "Mon Apr 18 11:05:37 2022 +0000", "Commit": "Herbert Xu <herbert@gondor.apana.org.au>", "CommitDate": "Fri Apr 29 13:44:57 2022 +0800", "Signed-off-by": ["Minghao Chi <chi.minghao@zte.com.cn>", "Herbert Xu <herbert@gondor.apana.org.au>"], "commit": "ee74fdf0ca74e6a65716400b403285686133a9f8", "files": [{"action": "M", "added": "2", "file": "drivers/crypto/allwinner/sun8i-ss/sun8i-ss-prng.c", "indexes": ["246a6782674c", "dd677e9ed06f"], "modes": ["100644", "100644"], "removed": "4"}], "message": "crypto: sun8i-ss - using pm_runtime_resume_and_get instead of pm_runtime_get_sync\n\nUsing pm_runtime_resume_and_get is more appropriate\nfor simplifing code\n\nReported-by: Zeal Robot <zealci@zte.com.cn>\nSigned-off-by: Minghao Chi <chi.minghao@zte.com.cn>\nSigned-off-by: Herbert Xu <herbert@gondor.apana.org.au>", "parents": ["cca806307311bec150268646572ef6a3548ac295"], "refs": [], "diff": "diff --git a/drivers/crypto/allwinner/sun8i-ss/sun8i-ss-prng.c b/drivers/crypto/allwinner/sun8i-ss/sun8i-ss-prng.c\nindex 246a6782674c..dd677e9ed06f 100644\n--- a/drivers/crypto/allwinner/sun8i-ss/sun8i-ss-prng.c\n+++ b/drivers/crypto/allwinner/sun8i-ss/sun8i-ss-prng.c\n@@ -112,11 +112,9 @@ int sun8i_ss_prng_generate(struct crypto_rng *tfm, const u8 *src,\n \t\tgoto err_iv;\n \t}\n \n-\terr = pm_runtime_get_sync(ss->dev);\n-\tif (err < 0) {\n-\t\tpm_runtime_put_noidle(ss->dev);\n+\terr = pm_runtime_resume_and_get(ss->dev);\n+\tif (err < 0)\n \t\tgoto err_pm;\n-\t}\n \terr = 0;\n \n \tmutex_lock(&ss->mlock);\n", "stats": " drivers/crypto/allwinner/sun8i-ss/sun8i-ss-prng.c | 6 ++----\n 1 file changed, 2 insertions(+), 4 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "ee74fdf0ca74e6a65716400b403285686133a9f8"}, "tag": "linux", "timestamp": 1699830366.49495, "updated_on": 1651211097.0, "uuid": "b13d6d04476d1987bd217b565883c065fb0fc1a8"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Dmytro Laktyushkin <Dmytro.Laktyushkin@amd.com>", "AuthorDate": "Fri Jan 21 17:28:07 2022 -0500", "Commit": "Alex Deucher <alexander.deucher@amd.com>", "CommitDate": "Wed Feb 23 14:26:36 2022 -0500", "Signed-off-by": ["Dmytro Laktyushkin <Dmytro.Laktyushkin@amd.com>", "Alex Deucher <alexander.deucher@amd.com>"], "commit": "5b45b1c8b89f84d01fea8939b672631b51cdf95b", "files": [{"action": "M", "added": "31", "file": "drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c", "indexes": ["90c265275f93", "d66633bef2b3"], "modes": ["100644", "100644"], "removed": "21"}], "message": "drm/amd/display: revert populating dcn315 clk table based on dcfclk\n\n[Why & How]\nDue to how pmfw fills out the table when dcfclk states are disabled,\nusing dcfclk based clk table would cause a no read situation.\nRevert the change to prevent underflow until a better solution is coded.\n\nReviewed-by: Charlene Liu <Charlene.Liu@amd.com>\nAcked-by: Qingqing Zhuo <qingqing.zhuo@amd.com>\nSigned-off-by: Dmytro Laktyushkin <Dmytro.Laktyushkin@amd.com>\nReviewed-by: Harry Wentland <harry.wentland@amd.com>\nSigned-off-by: Alex Deucher <alexander.deucher@amd.com>", "parents": ["e2573d5f2a5cebe789bbf415e484b589d8eebad7"], "refs": [], "diff": "diff --git a/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c b/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c\nindex 90c265275f93..d66633bef2b3 100644\n--- a/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c\n+++ b/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c\n@@ -414,23 +414,20 @@ static uint32_t find_max_clk_value(const uint32_t clocks[], uint32_t num_clocks)\n \treturn max;\n }\n \n-static unsigned int find_dfpstate_for_voltage(\n-\t\tconst DfPstateTable_t table[],\n-\t\tunsigned int NumDfPstatesEnabled,\n+static unsigned int find_clk_for_voltage(\n+\t\tconst DpmClocks_315_t *clock_table,\n+\t\tconst uint32_t clocks[],\n \t\tunsigned int voltage)\n {\n \tint i;\n-\tunsigned int minVoltage = table[0].Voltage;\n-\tunsigned int minlevel = 0;\n \n-\tfor (i = 1; i < NumDfPstatesEnabled; i++) {\n-\t\tif (table[i].Voltage >= voltage && minVoltage > table[i].Voltage) {\n-\t\t\tminVoltage = table[i].Voltage;\n-\t\t\tminlevel = i;\n-\t\t}\n+\tfor (i = 0; i < NUM_SOC_VOLTAGE_LEVELS; i++) {\n+\t\tif (clock_table->SocVoltage[i] == voltage)\n+\t\t\treturn clocks[i];\n \t}\n \n-\treturn minlevel;\n+\tASSERT(0);\n+\treturn 0;\n }\n \n void dcn315_clk_mgr_helper_populate_bw_params(\n@@ -438,21 +435,30 @@ void dcn315_clk_mgr_helper_populate_bw_params(\n \t\tstruct integrated_info *bios_info,\n \t\tconst DpmClocks_315_t *clock_table)\n {\n-\tint i, num_clk_lvl;\n+\tint i, j;\n \tstruct clk_bw_params *bw_params = clk_mgr->base.bw_params;\n \tuint32_t max_dispclk = 0, max_dppclk = 0;\n \n-\tnum_clk_lvl = clock_table->NumDcfClkLevelsEnabled;\n+\tj = -1;\n+\n+\tASSERT(NUM_DF_PSTATE_LEVELS <= MAX_NUM_DPM_LVL);\n+\n+\t/* Find lowest DPM, FCLK is filled in reverse order*/\n \n-\tASSERT(num_clk_lvl <= MAX_NUM_DPM_LVL);\n+\tfor (i = NUM_DF_PSTATE_LEVELS - 1; i >= 0; i--) {\n+\t\tif (clock_table->DfPstateTable[i].FClk != 0) {\n+\t\t\tj = i;\n+\t\t\tbreak;\n+\t\t}\n+\t}\n \n-\tif (num_clk_lvl == 0 || clock_table->DcfClocks[0] == 0) {\n-\t\t/* clock table is no good, just use our own hardcode */\n+\tif (j == -1) {\n+\t\t/* clock table is all 0s, just use our own hardcode */\n \t\tASSERT(0);\n \t\treturn;\n \t}\n \n-\tbw_params->clk_table.num_entries = num_clk_lvl;\n+\tbw_params->clk_table.num_entries = j + 1;\n \n \t/* dispclk and dppclk can be max at any voltage, same number of levels for both */\n \tif (clock_table->NumDispClkLevelsEnabled <= NUM_DISPCLK_DPM_LEVELS &&\n@@ -463,15 +469,19 @@ void dcn315_clk_mgr_helper_populate_bw_params(\n \t\tASSERT(0);\n \t}\n \n-\tfor (i = 0; i < bw_params->clk_table.num_entries; i++) {\n-\t\tint j = find_dfpstate_for_voltage(clock_table->DfPstateTable, clock_table->NumDfPstatesEnabled, clock_table->SocVoltage[i]);\n+\tfor (i = 0; i < bw_params->clk_table.num_entries; i++, j--) {\n+\t\tint temp;\n \n \t\tbw_params->clk_table.entries[i].fclk_mhz = clock_table->DfPstateTable[j].FClk;\n \t\tbw_params->clk_table.entries[i].memclk_mhz = clock_table->DfPstateTable[j].MemClk;\n \t\tbw_params->clk_table.entries[i].voltage = clock_table->DfPstateTable[j].Voltage;\n \t\tbw_params->clk_table.entries[i].wck_ratio = 1;\n-\t\tbw_params->clk_table.entries[i].dcfclk_mhz = clock_table->DcfClocks[i];\n-\t\tbw_params->clk_table.entries[i].socclk_mhz = clock_table->SocClocks[i];\n+\t\ttemp = find_clk_for_voltage(clock_table, clock_table->DcfClocks, clock_table->DfPstateTable[j].Voltage);\n+\t\tif (temp)\n+\t\t\tbw_params->clk_table.entries[i].dcfclk_mhz = temp;\n+\t\ttemp = find_clk_for_voltage(clock_table, clock_table->SocClocks, clock_table->DfPstateTable[j].Voltage);\n+\t\tif (temp)\n+\t\t\tbw_params->clk_table.entries[i].socclk_mhz = temp;\n \t\tbw_params->clk_table.entries[i].dispclk_mhz = max_dispclk;\n \t\tbw_params->clk_table.entries[i].dppclk_mhz = max_dppclk;\n \t}\n", "stats": " .../amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c | 52 +++++++++++++---------\n 1 file changed, 31 insertions(+), 21 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "5b45b1c8b89f84d01fea8939b672631b51cdf95b"}, "tag": "linux", "timestamp": 1699830163.025594, "updated_on": 1645644396.0, "uuid": "5f0bb2e65c02d4ba0c6ed88caefc1329c76c5522"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Gabe Teeger <gabe.teeger@amd.com>", "AuthorDate": "Mon Mar 14 12:07:14 2022 -0400", "Commit": "Alex Deucher <alexander.deucher@amd.com>", "CommitDate": "Fri Mar 25 12:40:25 2022 -0400", "Signed-off-by": ["Gabe Teeger <gabe.teeger@amd.com>", "Alex Deucher <alexander.deucher@amd.com>"], "commit": "e5fc78252ccd8dfc260f87d83905e9dffff6d975", "files": [{"action": "M", "added": "19", "file": "drivers/gpu/drm/amd/display/dc/core/dc.c", "indexes": ["75f9c97bebb0", "f2ad8f58e69c"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "5", "file": "drivers/gpu/drm/amd/display/dc/dc.h", "indexes": ["4ffab7bb1098", "9f4d926d54e7"], "modes": ["100644", "100644"], "removed": "1"}, {"action": "M", "added": "2", "file": "drivers/gpu/drm/amd/display/dc/dc_stream.h", "indexes": ["99a750f561f8", "c4168c11257c"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "12", "file": "drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c", "indexes": ["ab910deed481", "4290eaf11a04"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "8", "file": "drivers/gpu/drm/amd/display/dc/dcn31/dcn31_hubp.c", "indexes": ["53b792b997b7", "8ae6117953ca"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "1", "file": "drivers/gpu/drm/amd/display/dc/dcn31/dcn31_resource.c", "indexes": ["89b7b6b7254a", "338235bcef4a"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "15", "file": "drivers/gpu/drm/amd/display/dc/dml/dcn20/dcn20_fpu.c", "indexes": ["2f6122153bdb", "f93af45aeab4"], "modes": ["100644", "100644"], "removed": "3"}, {"action": "M", "added": "13", "file": "drivers/gpu/drm/amd/display/dc/dml/dcn31/display_rq_dlg_calc_31.c", "indexes": ["e0fecf127bd5", "53d760e169e6"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "2", "file": "drivers/gpu/drm/amd/display/dc/dml/display_mode_structs.h", "indexes": ["59f0a61c33cf", "2df660cd8801"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "3", "file": "drivers/gpu/drm/amd/display/dc/inc/hw/hubp.h", "indexes": ["e45b7993c5c5", "ad69d78c4ac3"], "modes": ["100644", "100644"], "removed": "0"}], "message": "drm/amd/display: Add support for zstate during extended vblank\n\n[why]\nWhen we enter FREESYNC_STATE_VIDEO, we want to use the extra vblank\nportion to enter zstate if possible.\n\n[how]\nWhen we enter freesync, a full update is triggered and the new vtotal\nwith extra lines is passed to dml in a stream update. The time gained\nfrom extra vblank lines is calculated in microseconds. We allow zstate\nentry if the time gained is greater than 5 ms, which is the current\npolicy. Furthermore, an optimized value for min_dst_y_next_start is\ncalculated and written to its register. When exiting freesync, another\nfull update is triggered and default values are restored.\n\nReviewed-by: Nicholas Kazlauskas <Nicholas.Kazlauskas@amd.com>\nAcked-by: Alex Hung <alex.hung@amd.com>\nSigned-off-by: Gabe Teeger <gabe.teeger@amd.com>\nTested-by: Daniel Wheeler <daniel.wheeler@amd.com>\nSigned-off-by: Alex Deucher <alexander.deucher@amd.com>", "parents": ["02fc996d5098f4c3f65bdf6cdb6b28e3f29ba789"], "refs": [], "diff": "diff --git a/drivers/gpu/drm/amd/display/dc/core/dc.c b/drivers/gpu/drm/amd/display/dc/core/dc.c\nindex 75f9c97bebb0..f2ad8f58e69c 100644\n--- a/drivers/gpu/drm/amd/display/dc/core/dc.c\n+++ b/drivers/gpu/drm/amd/display/dc/core/dc.c\n@@ -2393,6 +2393,8 @@ static enum surface_update_type check_update_surfaces_for_stream(\n \n \t\tif (stream_update->mst_bw_update)\n \t\t\tsu_flags->bits.mst_bw = 1;\n+\t\tif (stream_update->crtc_timing_adjust && dc_extended_blank_supported(dc))\n+\t\t\tsu_flags->bits.crtc_timing_adjust = 1;\n \n \t\tif (su_flags->raw != 0)\n \t\t\toverall_type = UPDATE_TYPE_FULL;\n@@ -2654,6 +2656,9 @@ static void copy_stream_update_to_stream(struct dc *dc,\n \tif (update->vrr_infopacket)\n \t\tstream->vrr_infopacket = *update->vrr_infopacket;\n \n+\tif (update->crtc_timing_adjust)\n+\t\tstream->adjust = *update->crtc_timing_adjust;\n+\n \tif (update->dpms_off)\n \t\tstream->dpms_off = *update->dpms_off;\n \n@@ -4055,3 +4060,17 @@ void dc_notify_vsync_int_state(struct dc *dc, struct dc_stream_state *stream, bo\n \tif (pipe->stream_res.abm && pipe->stream_res.abm->funcs->set_abm_pause)\n \t\tpipe->stream_res.abm->funcs->set_abm_pause(pipe->stream_res.abm, !enable, i, pipe->stream_res.tg->inst);\n }\n+/*\n+ * dc_extended_blank_supported: Decide whether extended blank is supported\n+ *\n+ * Extended blank is a freesync optimization feature to be enabled in the future.\n+ * During the extra vblank period gained from freesync, we have the ability to enter z9/z10.\n+ *\n+ * @param [in] dc: Current DC state\n+ * @return: Indicate whether extended blank is supported (true or false)\n+ */\n+bool dc_extended_blank_supported(struct dc *dc)\n+{\n+\treturn dc->debug.extended_blank_optimization && !dc->debug.disable_z10\n+\t\t&& dc->caps.zstate_support && dc->caps.is_apu;\n+}\ndiff --git a/drivers/gpu/drm/amd/display/dc/dc.h b/drivers/gpu/drm/amd/display/dc/dc.h\nindex 4ffab7bb1098..9f4d926d54e7 100644\n--- a/drivers/gpu/drm/amd/display/dc/dc.h\n+++ b/drivers/gpu/drm/amd/display/dc/dc.h\n@@ -188,6 +188,7 @@ struct dc_caps {\n \tbool psp_setup_panel_mode;\n \tbool extended_aux_timeout_support;\n \tbool dmcub_support;\n+\tbool zstate_support;\n \tuint32_t num_of_internal_disp;\n \tenum dp_protocol_version max_dp_protocol_version;\n \tunsigned int mall_size_per_mem_channel;\n@@ -703,13 +704,14 @@ struct dc_debug_options {\n \tbool enable_driver_sequence_debug;\n \tenum det_size crb_alloc_policy;\n \tint crb_alloc_policy_min_disp_count;\n-#if defined(CONFIG_DRM_AMD_DC_DCN)\n \tbool disable_z10;\n+#if defined(CONFIG_DRM_AMD_DC_DCN)\n \tbool enable_z9_disable_interface;\n \tbool enable_sw_cntl_psr;\n \tunion dpia_debug_options dpia_debug;\n #endif\n \tbool apply_vendor_specific_lttpr_wa;\n+\tbool extended_blank_optimization;\n \tbool ignore_dpref_ss;\n \tuint8_t psr_power_use_phy_fsm;\n };\n@@ -1369,6 +1371,8 @@ struct dc_sink_init_data {\n \tbool converter_disable_audio;\n };\n \n+bool dc_extended_blank_supported(struct dc *dc);\n+\n struct dc_sink *dc_sink_create(const struct dc_sink_init_data *init_params);\n \n /* Newer interfaces  */\ndiff --git a/drivers/gpu/drm/amd/display/dc/dc_stream.h b/drivers/gpu/drm/amd/display/dc/dc_stream.h\nindex 99a750f561f8..c4168c11257c 100644\n--- a/drivers/gpu/drm/amd/display/dc/dc_stream.h\n+++ b/drivers/gpu/drm/amd/display/dc/dc_stream.h\n@@ -131,6 +131,7 @@ union stream_update_flags {\n \t\tuint32_t wb_update:1;\n \t\tuint32_t dsc_changed : 1;\n \t\tuint32_t mst_bw : 1;\n+\t\tuint32_t crtc_timing_adjust : 1;\n \t} bits;\n \n \tuint32_t raw;\n@@ -289,6 +290,7 @@ struct dc_stream_update {\n \tstruct dc_3dlut *lut3d_func;\n \n \tstruct test_pattern *pending_test_pattern;\n+\tstruct dc_crtc_timing_adjust *crtc_timing_adjust;\n };\n \n bool dc_is_stream_unchanged(\ndiff --git a/drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c b/drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c\nindex ab910deed481..4290eaf11a04 100644\n--- a/drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c\n+++ b/drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c\n@@ -1857,6 +1857,7 @@ void dcn20_optimize_bandwidth(\n \t\tstruct dc_state *context)\n {\n \tstruct hubbub *hubbub = dc->res_pool->hubbub;\n+\tint i;\n \n \t/* program dchubbub watermarks */\n \thubbub->funcs->program_watermarks(hubbub,\n@@ -1873,6 +1874,17 @@ void dcn20_optimize_bandwidth(\n \t\t\tdc->clk_mgr,\n \t\t\tcontext,\n \t\t\ttrue);\n+\tif (dc_extended_blank_supported(dc) && context->bw_ctx.bw.dcn.clk.zstate_support == DCN_ZSTATE_SUPPORT_ALLOW) {\n+\t\tfor (i = 0; i < dc->res_pool->pipe_count; ++i) {\n+\t\t\tstruct pipe_ctx *pipe_ctx = &context->res_ctx.pipe_ctx[i];\n+\n+\t\t\tif (pipe_ctx->stream && pipe_ctx->plane_res.hubp->funcs->program_extended_blank\n+\t\t\t\t&& pipe_ctx->stream->adjust.v_total_min == pipe_ctx->stream->adjust.v_total_max\n+\t\t\t\t&& pipe_ctx->stream->adjust.v_total_max > pipe_ctx->stream->timing.v_total)\n+\t\t\t\t\tpipe_ctx->plane_res.hubp->funcs->program_extended_blank(pipe_ctx->plane_res.hubp,\n+\t\t\t\t\t\tpipe_ctx->dlg_regs.optimized_min_dst_y_next_start);\n+\t\t}\n+\t}\n \t/* increase compbuf size */\n \tif (hubbub->funcs->program_compbuf_size)\n \t\thubbub->funcs->program_compbuf_size(hubbub, context->bw_ctx.bw.dcn.compbuf_size_kb, true);\ndiff --git a/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_hubp.c b/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_hubp.c\nindex 53b792b997b7..8ae6117953ca 100644\n--- a/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_hubp.c\n+++ b/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_hubp.c\n@@ -54,6 +54,13 @@ void hubp31_soft_reset(struct hubp *hubp, bool reset)\n \tREG_UPDATE(DCHUBP_CNTL, HUBP_SOFT_RESET, reset);\n }\n \n+void hubp31_program_extended_blank(struct hubp *hubp, unsigned int min_dst_y_next_start_optimized)\n+{\n+\tstruct dcn20_hubp *hubp2 = TO_DCN20_HUBP(hubp);\n+\n+\tREG_SET(BLANK_OFFSET_1, 0, MIN_DST_Y_NEXT_START, min_dst_y_next_start_optimized);\n+}\n+\n static struct hubp_funcs dcn31_hubp_funcs = {\n \t.hubp_enable_tripleBuffer = hubp2_enable_triplebuffer,\n \t.hubp_is_triplebuffer_enabled = hubp2_is_triplebuffer_enabled,\n@@ -80,6 +87,7 @@ static struct hubp_funcs dcn31_hubp_funcs = {\n \t.set_unbounded_requesting = hubp31_set_unbounded_requesting,\n \t.hubp_soft_reset = hubp31_soft_reset,\n \t.hubp_in_blank = hubp1_in_blank,\n+\t.program_extended_blank = hubp31_program_extended_blank,\n };\n \n bool hubp31_construct(\ndiff --git a/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_resource.c b/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_resource.c\nindex 89b7b6b7254a..338235bcef4a 100644\n--- a/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_resource.c\n+++ b/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_resource.c\n@@ -2232,6 +2232,7 @@ static bool dcn31_resource_construct(\n \tdc->caps.extended_aux_timeout_support = true;\n \tdc->caps.dmcub_support = true;\n \tdc->caps.is_apu = true;\n+\tdc->caps.zstate_support = true;\n \n \t/* Color pipeline capabilities */\n \tdc->caps.color.dpp.dcn_arch = 1;\ndiff --git a/drivers/gpu/drm/amd/display/dc/dml/dcn20/dcn20_fpu.c b/drivers/gpu/drm/amd/display/dc/dml/dcn20/dcn20_fpu.c\nindex 2f6122153bdb..f93af45aeab4 100644\n--- a/drivers/gpu/drm/amd/display/dc/dml/dcn20/dcn20_fpu.c\n+++ b/drivers/gpu/drm/amd/display/dc/dml/dcn20/dcn20_fpu.c\n@@ -722,8 +722,10 @@ static enum dcn_zstate_support_state  decide_zstate_support(struct dc *dc, struc\n {\n \tint plane_count;\n \tint i;\n+\tunsigned int optimized_min_dst_y_next_start_us;\n \n \tplane_count = 0;\n+\toptimized_min_dst_y_next_start_us = 0;\n \tfor (i = 0; i < dc->res_pool->pipe_count; i++) {\n \t\tif (context->res_ctx.pipe_ctx[i].plane_state)\n \t\t\tplane_count++;\n@@ -744,11 +746,22 @@ static enum dcn_zstate_support_state  decide_zstate_support(struct dc *dc, struc\n \t\tstruct dc_link *link = context->streams[0]->sink->link;\n \t\tstruct dc_stream_status *stream_status = &context->stream_status[0];\n \n+\t\tif (dc_extended_blank_supported(dc)) {\n+\t\t\tfor (i = 0; i < dc->res_pool->pipe_count; i++) {\n+\t\t\t\tif (context->res_ctx.pipe_ctx[i].stream == context->streams[0]\n+\t\t\t\t\t&& context->res_ctx.pipe_ctx[i].stream->adjust.v_total_min == context->res_ctx.pipe_ctx[i].stream->adjust.v_total_max\n+\t\t\t\t\t&& context->res_ctx.pipe_ctx[i].stream->adjust.v_total_min > context->res_ctx.pipe_ctx[i].stream->timing.v_total) {\n+\t\t\t\t\t\toptimized_min_dst_y_next_start_us =\n+\t\t\t\t\t\t\tcontext->res_ctx.pipe_ctx[i].dlg_regs.optimized_min_dst_y_next_start_us;\n+\t\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n \t\t/* zstate only supported on PWRSEQ0  and when there's <2 planes*/\n \t\tif (link->link_index != 0 || stream_status->plane_count > 1)\n \t\t\treturn DCN_ZSTATE_SUPPORT_DISALLOW;\n \n-\t\tif (context->bw_ctx.dml.vba.StutterPeriod > 5000.0)\n+\t\tif (context->bw_ctx.dml.vba.StutterPeriod > 5000.0 || optimized_min_dst_y_next_start_us > 5000)\n \t\t\treturn DCN_ZSTATE_SUPPORT_ALLOW;\n \t\telse if (link->psr_settings.psr_version == DC_PSR_VERSION_1 && !dc->debug.disable_psr)\n \t\t\treturn DCN_ZSTATE_SUPPORT_ALLOW_Z10_ONLY;\n@@ -786,8 +799,6 @@ void dcn20_calculate_dlg_params(\n \t\t\t\t\t\t\t!= dm_dram_clock_change_unsupported;\n \tcontext->bw_ctx.bw.dcn.clk.dppclk_khz = 0;\n \n-\tcontext->bw_ctx.bw.dcn.clk.zstate_support = decide_zstate_support(dc, context);\n-\n \tcontext->bw_ctx.bw.dcn.clk.dtbclk_en = is_dtbclk_required(dc, context);\n \n \tif (context->bw_ctx.bw.dcn.clk.dispclk_khz < dc->debug.min_disp_clk_khz)\n@@ -843,6 +854,7 @@ void dcn20_calculate_dlg_params(\n \t\t\t\t&pipes[pipe_idx].pipe);\n \t\tpipe_idx++;\n \t}\n+\tcontext->bw_ctx.bw.dcn.clk.zstate_support = decide_zstate_support(dc, context);\n }\n \n static void swizzle_to_dml_params(\ndiff --git a/drivers/gpu/drm/amd/display/dc/dml/dcn31/display_rq_dlg_calc_31.c b/drivers/gpu/drm/amd/display/dc/dml/dcn31/display_rq_dlg_calc_31.c\nindex e0fecf127bd5..53d760e169e6 100644\n--- a/drivers/gpu/drm/amd/display/dc/dml/dcn31/display_rq_dlg_calc_31.c\n+++ b/drivers/gpu/drm/amd/display/dc/dml/dcn31/display_rq_dlg_calc_31.c\n@@ -1055,6 +1055,7 @@ static void dml_rq_dlg_get_dlg_params(\n \n \tfloat vba__refcyc_per_req_delivery_pre_l = get_refcyc_per_req_delivery_pre_l_in_us(mode_lib, e2e_pipe_param, num_pipes, pipe_idx) * refclk_freq_in_mhz;  // From VBA\n \tfloat vba__refcyc_per_req_delivery_l = get_refcyc_per_req_delivery_l_in_us(mode_lib, e2e_pipe_param, num_pipes, pipe_idx) * refclk_freq_in_mhz;  // From VBA\n+\tint blank_lines;\n \n \tmemset(disp_dlg_regs, 0, sizeof(*disp_dlg_regs));\n \tmemset(disp_ttu_regs, 0, sizeof(*disp_ttu_regs));\n@@ -1080,6 +1081,18 @@ static void dml_rq_dlg_get_dlg_params(\n \tdlg_vblank_start = interlaced ? (vblank_start / 2) : vblank_start;\n \n \tdisp_dlg_regs->min_dst_y_next_start = (unsigned int) (((double) dlg_vblank_start) * dml_pow(2, 2));\n+\tblank_lines = (dst->vblank_end + dst->vtotal_min - dst->vblank_start - dst->vstartup_start - 1);\n+\tif (blank_lines < 0)\n+\t\tblank_lines = 0;\n+\tif (blank_lines != 0) {\n+\t\tdisp_dlg_regs->optimized_min_dst_y_next_start_us =\n+\t\t\t((unsigned int) blank_lines * dst->hactive) / (unsigned int) dst->pixel_rate_mhz;\n+\t\tdisp_dlg_regs->optimized_min_dst_y_next_start =\n+\t\t\t(unsigned int)(((double) (dlg_vblank_start + blank_lines)) * dml_pow(2, 2));\n+\t} else {\n+\t\t// use unoptimized value\n+\t\tdisp_dlg_regs->optimized_min_dst_y_next_start = disp_dlg_regs->min_dst_y_next_start;\n+\t}\n \tASSERT(disp_dlg_regs->min_dst_y_next_start < (unsigned int)dml_pow(2, 18));\n \n \tdml_print(\"DML_DLG: %s: min_ttu_vblank (us)         = %3.2f\\n\", __func__, min_ttu_vblank);\ndiff --git a/drivers/gpu/drm/amd/display/dc/dml/display_mode_structs.h b/drivers/gpu/drm/amd/display/dc/dml/display_mode_structs.h\nindex 59f0a61c33cf..2df660cd8801 100644\n--- a/drivers/gpu/drm/amd/display/dc/dml/display_mode_structs.h\n+++ b/drivers/gpu/drm/amd/display/dc/dml/display_mode_structs.h\n@@ -446,6 +446,8 @@ struct _vcs_dpi_display_dlg_regs_st {\n \tunsigned int refcyc_h_blank_end;\n \tunsigned int dlg_vblank_end;\n \tunsigned int min_dst_y_next_start;\n+\tunsigned int optimized_min_dst_y_next_start;\n+\tunsigned int optimized_min_dst_y_next_start_us;\n \tunsigned int refcyc_per_htotal;\n \tunsigned int refcyc_x_after_scaler;\n \tunsigned int dst_y_after_scaler;\ndiff --git a/drivers/gpu/drm/amd/display/dc/inc/hw/hubp.h b/drivers/gpu/drm/amd/display/dc/inc/hw/hubp.h\nindex e45b7993c5c5..ad69d78c4ac3 100644\n--- a/drivers/gpu/drm/amd/display/dc/inc/hw/hubp.h\n+++ b/drivers/gpu/drm/amd/display/dc/inc/hw/hubp.h\n@@ -195,6 +195,9 @@ struct hubp_funcs {\n \n \tvoid (*hubp_set_flip_int)(struct hubp *hubp);\n \n+\tvoid (*program_extended_blank)(struct hubp *hubp,\n+\t\t\tunsigned int min_dst_y_next_start_optimized);\n+\n \tvoid (*hubp_wait_pipe_read_start)(struct hubp *hubp);\n };\n \n", "stats": " drivers/gpu/drm/amd/display/dc/core/dc.c              | 19 +++++++++++++++++++\n drivers/gpu/drm/amd/display/dc/dc.h                   |  6 +++++-\n drivers/gpu/drm/amd/display/dc/dc_stream.h            |  2 ++\n drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c    | 12 ++++++++++++\n drivers/gpu/drm/amd/display/dc/dcn31/dcn31_hubp.c     |  8 ++++++++\n drivers/gpu/drm/amd/display/dc/dcn31/dcn31_resource.c |  1 +\n drivers/gpu/drm/amd/display/dc/dml/dcn20/dcn20_fpu.c  | 18 +++++++++++++++---\n .../amd/display/dc/dml/dcn31/display_rq_dlg_calc_31.c | 13 +++++++++++++\n .../gpu/drm/amd/display/dc/dml/display_mode_structs.h |  2 ++\n drivers/gpu/drm/amd/display/dc/inc/hw/hubp.h          |  3 +++\n 10 files changed, 80 insertions(+), 4 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "e5fc78252ccd8dfc260f87d83905e9dffff6d975"}, "tag": "linux", "timestamp": 1699830218.394231, "updated_on": 1648226425.0, "uuid": "ea2e8ed7413479ad8e4bf1f9e6408aa54bb0d30e"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "kyrie wu <kyrie.wu@mediatek.com>", "AuthorDate": "Thu Sep 29 17:08:14 2022 +0800", "Commit": "Hans Verkuil <hverkuil-cisco@xs4all.nl>", "CommitDate": "Fri Sep 30 16:39:29 2022 +0200", "Signed-off-by": ["kyrie wu <kyrie.wu@mediatek.com>", "irui wang <irui.wang@mediatek.com>", "Hans Verkuil <hverkuil-cisco@xs4all.nl>"], "commit": "dedc21500334b97b80d4ca37ab683cde214fcb03", "files": [{"action": "M", "added": "196", "file": "drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.c", "indexes": ["debee9b82158", "453962e429ae"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "11", "file": "drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.h", "indexes": ["391c4ec25b2c", "0713b8d14356"], "modes": ["100644", "100644"], "removed": "0"}, {"action": "M", "added": "27", "file": "drivers/media/platform/mediatek/jpeg/mtk_jpeg_dec_hw.c", "indexes": ["d65cc0a3b663", "f7e3013234d3"], "modes": ["100644", "100644"], "removed": "12"}], "message": "media: mtk-jpegdec: add jpeg decode worker interface\n\nAdd jpeg decoding worker to ensure that three HWs\nrun in parallel in MT8195.\n\nSigned-off-by: kyrie wu <kyrie.wu@mediatek.com>\nSigned-off-by: irui wang <irui.wang@mediatek.com>\nSigned-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>", "parents": ["e5f969dd937705289b95f91a018ace6a5ab3f5a2"], "refs": [], "diff": "diff --git a/drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.c b/drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.c\nindex debee9b82158..453962e429ae 100644\n--- a/drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.c\n+++ b/drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.c\n@@ -1100,6 +1100,180 @@ static void mtk_jpeg_multicore_enc_device_run(void *priv)\n \tqueue_work(jpeg->workqueue, &ctx->jpeg_work);\n }\n \n+static int mtk_jpegdec_get_hw(struct mtk_jpeg_ctx *ctx)\n+{\n+\tstruct mtk_jpegdec_comp_dev *comp_jpeg;\n+\tstruct mtk_jpeg_dev *jpeg = ctx->jpeg;\n+\tunsigned long flags;\n+\tint hw_id = -1;\n+\tint i;\n+\n+\tspin_lock_irqsave(&jpeg->hw_lock, flags);\n+\tfor (i = 0; i < MTK_JPEGDEC_HW_MAX; i++) {\n+\t\tcomp_jpeg = jpeg->dec_hw_dev[i];\n+\t\tif (comp_jpeg->hw_state == MTK_JPEG_HW_IDLE) {\n+\t\t\thw_id = i;\n+\t\t\tcomp_jpeg->hw_state = MTK_JPEG_HW_BUSY;\n+\t\t\tbreak;\n+\t\t}\n+\t}\n+\tspin_unlock_irqrestore(&jpeg->hw_lock, flags);\n+\n+\treturn hw_id;\n+}\n+\n+static int mtk_jpegdec_put_hw(struct mtk_jpeg_dev *jpeg, int hw_id)\n+{\n+\tunsigned long flags;\n+\n+\tspin_lock_irqsave(&jpeg->hw_lock, flags);\n+\tjpeg->dec_hw_dev[hw_id]->hw_state =\n+\t\tMTK_JPEG_HW_IDLE;\n+\tspin_unlock_irqrestore(&jpeg->hw_lock, flags);\n+\n+\treturn 0;\n+}\n+\n+static int mtk_jpegdec_set_hw_param(struct mtk_jpeg_ctx *ctx,\n+\t\t\t\t    int hw_id,\n+\t\t\t\t    struct vb2_v4l2_buffer *src_buf,\n+\t\t\t\t    struct vb2_v4l2_buffer *dst_buf)\n+{\n+\tstruct mtk_jpegdec_comp_dev *jpeg =\n+\t\tctx->jpeg->dec_hw_dev[hw_id];\n+\n+\tjpeg->hw_param.curr_ctx = ctx;\n+\tjpeg->hw_param.src_buffer = src_buf;\n+\tjpeg->hw_param.dst_buffer = dst_buf;\n+\n+\treturn 0;\n+}\n+\n+static void mtk_jpegdec_worker(struct work_struct *work)\n+{\n+\tstruct mtk_jpeg_ctx *ctx = container_of(work, struct mtk_jpeg_ctx,\n+\t\tjpeg_work);\n+\tstruct mtk_jpegdec_comp_dev *comp_jpeg[MTK_JPEGDEC_HW_MAX];\n+\tenum vb2_buffer_state buf_state = VB2_BUF_STATE_ERROR;\n+\tstruct mtk_jpeg_src_buf *jpeg_src_buf, *jpeg_dst_buf;\n+\tstruct vb2_v4l2_buffer *src_buf, *dst_buf;\n+\tstruct mtk_jpeg_dev *jpeg = ctx->jpeg;\n+\tint ret, i, hw_id = 0;\n+\tstruct mtk_jpeg_bs bs;\n+\tstruct mtk_jpeg_fb fb;\n+\tunsigned long flags;\n+\n+\tfor (i = 0; i < MTK_JPEGDEC_HW_MAX; i++)\n+\t\tcomp_jpeg[i] = jpeg->dec_hw_dev[i];\n+\ti = 0;\n+\n+retry_select:\n+\thw_id = mtk_jpegdec_get_hw(ctx);\n+\tif (hw_id < 0) {\n+\t\tret = wait_event_interruptible_timeout(jpeg->dec_hw_wq,\n+\t\t\t\t\t\t       atomic_read(&jpeg->dechw_rdy) > 0,\n+\t\t\t\t\t\t       MTK_JPEG_HW_TIMEOUT_MSEC);\n+\t\tif (ret != 0 || (i++ > MTK_JPEG_MAX_RETRY_TIME)) {\n+\t\t\tdev_err(jpeg->dev, \"%s : %d, all HW are busy\\n\",\n+\t\t\t\t__func__, __LINE__);\n+\t\t\tv4l2_m2m_job_finish(jpeg->m2m_dev, ctx->fh.m2m_ctx);\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tgoto retry_select;\n+\t}\n+\n+\tatomic_dec(&jpeg->dechw_rdy);\n+\tsrc_buf = v4l2_m2m_next_src_buf(ctx->fh.m2m_ctx);\n+\tif (!src_buf)\n+\t\tgoto getbuf_fail;\n+\n+\tdst_buf = v4l2_m2m_next_dst_buf(ctx->fh.m2m_ctx);\n+\tif (!dst_buf)\n+\t\tgoto getbuf_fail;\n+\n+\tv4l2_m2m_src_buf_remove(ctx->fh.m2m_ctx);\n+\tv4l2_m2m_dst_buf_remove(ctx->fh.m2m_ctx);\n+\n+\tv4l2_m2m_buf_copy_metadata(src_buf, dst_buf, true);\n+\tjpeg_src_buf = mtk_jpeg_vb2_to_srcbuf(&src_buf->vb2_buf);\n+\tjpeg_dst_buf = mtk_jpeg_vb2_to_srcbuf(&dst_buf->vb2_buf);\n+\n+\tif (mtk_jpeg_check_resolution_change(ctx,\n+\t\t\t\t\t     &jpeg_src_buf->dec_param)) {\n+\t\tmtk_jpeg_queue_src_chg_event(ctx);\n+\t\tctx->state = MTK_JPEG_SOURCE_CHANGE;\n+\t\tgoto dec_end;\n+\t}\n+\n+\tjpeg_src_buf->curr_ctx = ctx;\n+\tjpeg_src_buf->frame_num = ctx->total_frame_num;\n+\tjpeg_dst_buf->curr_ctx = ctx;\n+\tjpeg_dst_buf->frame_num = ctx->total_frame_num;\n+\tctx->total_frame_num++;\n+\n+\tmtk_jpegdec_set_hw_param(ctx, hw_id, src_buf, dst_buf);\n+\tret = pm_runtime_get_sync(comp_jpeg[hw_id]->dev);\n+\tif (ret < 0) {\n+\t\tdev_err(jpeg->dev, \"%s : %d, pm_runtime_get_sync fail !!!\\n\",\n+\t\t\t__func__, __LINE__);\n+\t\tgoto dec_end;\n+\t}\n+\n+\tret = clk_prepare_enable(comp_jpeg[hw_id]->jdec_clk.clks->clk);\n+\tif (ret) {\n+\t\tdev_err(jpeg->dev, \"%s : %d, jpegdec clk_prepare_enable fail\\n\",\n+\t\t\t__func__, __LINE__);\n+\t\tgoto clk_end;\n+\t}\n+\n+\tschedule_delayed_work(&comp_jpeg[hw_id]->job_timeout_work,\n+\t\t\t      msecs_to_jiffies(MTK_JPEG_HW_TIMEOUT_MSEC));\n+\n+\tmtk_jpeg_set_dec_src(ctx, &src_buf->vb2_buf, &bs);\n+\tif (mtk_jpeg_set_dec_dst(ctx,\n+\t\t\t\t &jpeg_src_buf->dec_param,\n+\t\t\t\t &dst_buf->vb2_buf, &fb)) {\n+\t\tdev_err(jpeg->dev, \"%s : %d, mtk_jpeg_set_dec_dst fail\\n\",\n+\t\t\t__func__, __LINE__);\n+\t\tgoto setdst_end;\n+\t}\n+\n+\tspin_lock_irqsave(&comp_jpeg[hw_id]->hw_lock, flags);\n+\tmtk_jpeg_dec_reset(comp_jpeg[hw_id]->reg_base);\n+\tmtk_jpeg_dec_set_config(jpeg->reg_base,\n+\t\t\t\t&jpeg_src_buf->dec_param,\n+\t\t\t\t&bs,\n+\t\t\t\t&fb);\n+\tmtk_jpeg_dec_start(comp_jpeg[hw_id]->reg_base);\n+\tv4l2_m2m_job_finish(jpeg->m2m_dev, ctx->fh.m2m_ctx);\n+\tspin_unlock_irqrestore(&comp_jpeg[hw_id]->hw_lock, flags);\n+\n+\treturn;\n+\n+setdst_end:\n+\tclk_disable_unprepare(comp_jpeg[hw_id]->jdec_clk.clks->clk);\n+clk_end:\n+\tpm_runtime_put(comp_jpeg[hw_id]->dev);\n+dec_end:\n+\tv4l2_m2m_src_buf_remove(ctx->fh.m2m_ctx);\n+\tv4l2_m2m_dst_buf_remove(ctx->fh.m2m_ctx);\n+\tv4l2_m2m_buf_done(src_buf, buf_state);\n+\tv4l2_m2m_buf_done(dst_buf, buf_state);\n+getbuf_fail:\n+\tatomic_inc(&jpeg->dechw_rdy);\n+\tmtk_jpegdec_put_hw(jpeg, hw_id);\n+\tv4l2_m2m_job_finish(jpeg->m2m_dev, ctx->fh.m2m_ctx);\n+}\n+\n+static void mtk_jpeg_multicore_dec_device_run(void *priv)\n+{\n+\tstruct mtk_jpeg_ctx *ctx = priv;\n+\tstruct mtk_jpeg_dev *jpeg = ctx->jpeg;\n+\n+\tqueue_work(jpeg->workqueue, &ctx->jpeg_work);\n+}\n+\n static void mtk_jpeg_dec_device_run(void *priv)\n {\n \tstruct mtk_jpeg_ctx *ctx = priv;\n@@ -1166,6 +1340,10 @@ static const struct v4l2_m2m_ops mtk_jpeg_multicore_enc_m2m_ops = {\n \t.device_run = mtk_jpeg_multicore_enc_device_run,\n };\n \n+static const struct v4l2_m2m_ops mtk_jpeg_multicore_dec_m2m_ops = {\n+\t.device_run = mtk_jpeg_multicore_dec_device_run,\n+};\n+\n static const struct v4l2_m2m_ops mtk_jpeg_dec_m2m_ops = {\n \t.device_run = mtk_jpeg_dec_device_run,\n \t.job_ready  = mtk_jpeg_dec_job_ready,\n@@ -1369,6 +1547,9 @@ static int mtk_jpeg_open(struct file *file)\n \tif (jpeg->is_jpgenc_multihw)\n \t\tINIT_WORK(&ctx->jpeg_work, mtk_jpegenc_worker);\n \n+\tif (jpeg->is_jpgdec_multihw)\n+\t\tINIT_WORK(&ctx->jpeg_work, mtk_jpegdec_worker);\n+\n \tINIT_LIST_HEAD(&ctx->dst_done_queue);\n \tspin_lock_init(&ctx->done_queue_lock);\n \tv4l2_fh_init(&ctx->fh, vfd);\n@@ -1675,6 +1856,17 @@ static struct mtk_jpeg_variant mtk8195_jpegenc_drvdata = {\n \t.cap_q_default_fourcc = V4L2_PIX_FMT_JPEG,\n };\n \n+static const struct mtk_jpeg_variant mtk8195_jpegdec_drvdata = {\n+\t.formats = mtk_jpeg_dec_formats,\n+\t.num_formats = MTK_JPEG_DEC_NUM_FORMATS,\n+\t.qops = &mtk_jpeg_dec_qops,\n+\t.m2m_ops = &mtk_jpeg_multicore_dec_m2m_ops,\n+\t.dev_name = \"mtk-jpeg-dec\",\n+\t.ioctl_ops = &mtk_jpeg_dec_ioctl_ops,\n+\t.out_q_default_fourcc = V4L2_PIX_FMT_JPEG,\n+\t.cap_q_default_fourcc = V4L2_PIX_FMT_YUV420M,\n+};\n+\n #if defined(CONFIG_OF)\n static const struct of_device_id mtk_jpeg_match[] = {\n \t{\n@@ -1693,6 +1885,10 @@ static const struct of_device_id mtk_jpeg_match[] = {\n \t\t.compatible = \"mediatek,mt8195-jpgenc\",\n \t\t.data = &mtk8195_jpegenc_drvdata,\n \t},\n+\t{\n+\t\t.compatible = \"mediatek,mt8195-jpgdec\",\n+\t\t.data = &mtk8195_jpegdec_drvdata,\n+\t},\n \t{},\n };\n \ndiff --git a/drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.h b/drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.h\nindex 391c4ec25b2c..0713b8d14356 100644\n--- a/drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.h\n+++ b/drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.h\n@@ -167,6 +167,8 @@ struct mtk_jpegenc_comp_dev {\n  * @jpegdec_irq:\t\tjpeg decode irq num\n  * @job_timeout_work:\t\tdecode timeout workqueue\n  * @hw_param:\t\t\tjpeg decode hw parameters\n+ * @hw_state:\t\t\trecord hw state\n+ * @hw_lock:\t\t\tspinlock protecting hw\n  */\n struct mtk_jpegdec_comp_dev {\n \tstruct device *dev;\n@@ -177,6 +179,9 @@ struct mtk_jpegdec_comp_dev {\n \tint jpegdec_irq;\n \tstruct delayed_work job_timeout_work;\n \tstruct mtk_jpeg_hw_param hw_param;\n+\tenum mtk_jpeg_hw_state hw_state;\n+\t/* spinlock protecting the hw device resource */\n+\tspinlock_t hw_lock;\n };\n \n /**\n@@ -200,6 +205,9 @@ struct mtk_jpegdec_comp_dev {\n  * @reg_decbase:\tjpg decode register base addr\n  * @dec_hw_dev:\t\tjpg decode hardware device\n  * @is_jpgdec_multihw:\tthe flag of dec multi-hw core\n+ * @dec_hw_wq:\t\tjpg decode wait queue\n+ * @dec_workqueue:\tjpg decode work queue\n+ * @dechw_rdy:\t\tjpg decode hw ready flag\n  */\n struct mtk_jpeg_dev {\n \tstruct mutex\t\tlock;\n@@ -223,6 +231,9 @@ struct mtk_jpeg_dev {\n \tvoid __iomem *reg_decbase[MTK_JPEGDEC_HW_MAX];\n \tstruct mtk_jpegdec_comp_dev *dec_hw_dev[MTK_JPEGDEC_HW_MAX];\n \tbool is_jpgdec_multihw;\n+\twait_queue_head_t dec_hw_wq;\n+\tstruct workqueue_struct\t*dec_workqueue;\n+\tatomic_t dechw_rdy;\n };\n \n /**\ndiff --git a/drivers/media/platform/mediatek/jpeg/mtk_jpeg_dec_hw.c b/drivers/media/platform/mediatek/jpeg/mtk_jpeg_dec_hw.c\nindex d65cc0a3b663..f7e3013234d3 100644\n--- a/drivers/media/platform/mediatek/jpeg/mtk_jpeg_dec_hw.c\n+++ b/drivers/media/platform/mediatek/jpeg/mtk_jpeg_dec_hw.c\n@@ -446,6 +446,7 @@ static void mtk_jpegdec_timeout_work(struct work_struct *work)\n \tstruct mtk_jpegdec_comp_dev *cjpeg =\n \t\tcontainer_of(work, struct mtk_jpegdec_comp_dev,\n \t\t\t     job_timeout_work.work);\n+\tstruct mtk_jpeg_dev *master_jpeg = cjpeg->master_dev;\n \tstruct vb2_v4l2_buffer *src_buf, *dst_buf;\n \n \tsrc_buf = cjpeg->hw_param.src_buffer;\n@@ -455,6 +456,9 @@ static void mtk_jpegdec_timeout_work(struct work_struct *work)\n \tmtk_jpeg_dec_reset(cjpeg->reg_base);\n \tclk_disable_unprepare(cjpeg->jdec_clk.clks->clk);\n \tpm_runtime_put(cjpeg->dev);\n+\tcjpeg->hw_state = MTK_JPEG_HW_IDLE;\n+\tatomic_inc(&master_jpeg->dechw_rdy);\n+\twake_up(&master_jpeg->dec_hw_wq);\n \tv4l2_m2m_buf_done(src_buf, buf_state);\n \tv4l2_m2m_buf_done(dst_buf, buf_state);\n }\n@@ -474,22 +478,19 @@ static irqreturn_t mtk_jpegdec_hw_irq_handler(int irq, void *priv)\n \n \tcancel_delayed_work(&jpeg->job_timeout_work);\n \n+\tctx = jpeg->hw_param.curr_ctx;\n+\tsrc_buf = jpeg->hw_param.src_buffer;\n+\tdst_buf = jpeg->hw_param.dst_buffer;\n+\tv4l2_m2m_buf_copy_metadata(src_buf, dst_buf, true);\n+\n \tirq_status = mtk_jpeg_dec_get_int_status(jpeg->reg_base);\n \tdec_irq_ret = mtk_jpeg_dec_enum_result(irq_status);\n \tif (dec_irq_ret >= MTK_JPEG_DEC_RESULT_UNDERFLOW)\n \t\tmtk_jpeg_dec_reset(jpeg->reg_base);\n-\tif (dec_irq_ret != MTK_JPEG_DEC_RESULT_EOF_DONE)\n-\t\treturn IRQ_NONE;\n \n-\tctx = v4l2_m2m_get_curr_priv(master_jpeg->m2m_dev);\n-\tif (!ctx) {\n-\t\tdev_err(jpeg->dev, \"Context is NULL\\n\");\n-\t\treturn IRQ_HANDLED;\n-\t}\n+\tif (dec_irq_ret != MTK_JPEG_DEC_RESULT_EOF_DONE)\n+\t\tdev_warn(jpeg->dev, \"Jpg Dec occurs unknown Err.\");\n \n-\tsrc_buf = v4l2_m2m_src_buf_remove(ctx->fh.m2m_ctx);\n-\tdst_buf = v4l2_m2m_dst_buf_remove(ctx->fh.m2m_ctx);\n-\tv4l2_m2m_buf_copy_metadata(src_buf, dst_buf, true);\n \tjpeg_src_buf =\n \t\tcontainer_of(src_buf, struct mtk_jpeg_src_buf, b);\n \n@@ -498,11 +499,14 @@ static irqreturn_t mtk_jpegdec_hw_irq_handler(int irq, void *priv)\n \t\t\t\t      jpeg_src_buf->dec_param.comp_size[i]);\n \n \tbuf_state = VB2_BUF_STATE_DONE;\n-\n \tv4l2_m2m_buf_done(src_buf, buf_state);\n \tv4l2_m2m_buf_done(dst_buf, buf_state);\n-\tv4l2_m2m_job_finish(master_jpeg->m2m_dev, ctx->fh.m2m_ctx);\n \tpm_runtime_put(ctx->jpeg->dev);\n+\tclk_disable_unprepare(jpeg->jdec_clk.clks->clk);\n+\n+\tjpeg->hw_state = MTK_JPEG_HW_IDLE;\n+\twake_up(&master_jpeg->dec_hw_wq);\n+\tatomic_inc(&master_jpeg->dechw_rdy);\n \n \treturn IRQ_HANDLED;\n }\n@@ -557,8 +561,19 @@ static int mtk_jpegdec_hw_probe(struct platform_device *pdev)\n \t\tmaster_dev->is_jpgdec_multihw = true;\n \t\tfor (i = 0; i < MTK_JPEGDEC_HW_MAX; i++)\n \t\t\tmaster_dev->dec_hw_dev[i] = NULL;\n+\n+\t\tinit_waitqueue_head(&master_dev->dec_hw_wq);\n+\t\tmaster_dev->workqueue = alloc_ordered_workqueue(MTK_JPEG_NAME,\n+\t\t\t\t\t\t\t\tWQ_MEM_RECLAIM\n+\t\t\t\t\t\t\t\t| WQ_FREEZABLE);\n+\t\tif (!master_dev->workqueue)\n+\t\t\treturn -EINVAL;\n \t}\n \n+\tatomic_set(&master_dev->dechw_rdy, MTK_JPEGDEC_HW_MAX);\n+\tspin_lock_init(&dev->hw_lock);\n+\tdev->hw_state = MTK_JPEG_HW_IDLE;\n+\n \tINIT_DELAYED_WORK(&dev->job_timeout_work,\n \t\t\t  mtk_jpegdec_timeout_work);\n \n", "stats": " .../media/platform/mediatek/jpeg/mtk_jpeg_core.c   | 196 +++++++++++++++++++++\n .../media/platform/mediatek/jpeg/mtk_jpeg_core.h   |  11 ++\n .../media/platform/mediatek/jpeg/mtk_jpeg_dec_hw.c |  39 ++--\n 3 files changed, 234 insertions(+), 12 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "dedc21500334b97b80d4ca37ab683cde214fcb03"}, "tag": "linux", "timestamp": 1699830923.407897, "updated_on": 1664548769.0, "uuid": "61e710260865f8d5db63f927d1962fffe09c53b7"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Linus Walleij <linus.walleij@linaro.org>", "AuthorDate": "Fri Apr 15 00:17:48 2022 +0200", "Commit": "Stephen Boyd <sboyd@kernel.org>", "CommitDate": "Mon Apr 25 16:17:24 2022 -0700", "Signed-off-by": ["Linus Walleij <linus.walleij@linaro.org>", "Stephen Boyd <sboyd@kernel.org>"], "commit": "801179b670be3ff5e07c76c00837615b7f481aec", "files": [{"action": "M", "added": "0", "file": "drivers/clk/ux500/clk-prcmu.c", "indexes": ["937b6bb82b30", "fffdb6326191"], "modes": ["100644", "100644"], "removed": "35"}], "message": "clk: ux500: Drop .is_enabled state from PRCMU clocks\n\nThe core already keeps a software enable count. Drop this\ncustom software enable count.\n\nReviewed-by: Ulf Hansson <ulf.hansson@linaro.org>\nSigned-off-by: Linus Walleij <linus.walleij@linaro.org>\nLink: https://lore.kernel.org/r/20220414221751.323525-3-linus.walleij@linaro.org\nSigned-off-by: Stephen Boyd <sboyd@kernel.org>", "parents": ["7335631fcd5eecfa84555bd57433e6446d06ad21"], "refs": [], "diff": "diff --git a/drivers/clk/ux500/clk-prcmu.c b/drivers/clk/ux500/clk-prcmu.c\nindex 937b6bb82b30..fffdb6326191 100644\n--- a/drivers/clk/ux500/clk-prcmu.c\n+++ b/drivers/clk/ux500/clk-prcmu.c\n@@ -19,7 +19,6 @@ struct clk_prcmu {\n \tstruct clk_hw hw;\n \tu8 cg_sel;\n \tint is_prepared;\n-\tint is_enabled;\n \tint opp_requested;\n };\n \n@@ -53,25 +52,6 @@ static int clk_prcmu_is_prepared(struct clk_hw *hw)\n \treturn clk->is_prepared;\n }\n \n-static int clk_prcmu_enable(struct clk_hw *hw)\n-{\n-\tstruct clk_prcmu *clk = to_clk_prcmu(hw);\n-\tclk->is_enabled = 1;\n-\treturn 0;\n-}\n-\n-static void clk_prcmu_disable(struct clk_hw *hw)\n-{\n-\tstruct clk_prcmu *clk = to_clk_prcmu(hw);\n-\tclk->is_enabled = 0;\n-}\n-\n-static int clk_prcmu_is_enabled(struct clk_hw *hw)\n-{\n-\tstruct clk_prcmu *clk = to_clk_prcmu(hw);\n-\treturn clk->is_enabled;\n-}\n-\n static unsigned long clk_prcmu_recalc_rate(struct clk_hw *hw,\n \t\t\t\t\t   unsigned long parent_rate)\n {\n@@ -189,9 +169,6 @@ static const struct clk_ops clk_prcmu_scalable_ops = {\n \t.prepare = clk_prcmu_prepare,\n \t.unprepare = clk_prcmu_unprepare,\n \t.is_prepared = clk_prcmu_is_prepared,\n-\t.enable = clk_prcmu_enable,\n-\t.disable = clk_prcmu_disable,\n-\t.is_enabled = clk_prcmu_is_enabled,\n \t.recalc_rate = clk_prcmu_recalc_rate,\n \t.round_rate = clk_prcmu_round_rate,\n \t.set_rate = clk_prcmu_set_rate,\n@@ -201,21 +178,16 @@ static const struct clk_ops clk_prcmu_gate_ops = {\n \t.prepare = clk_prcmu_prepare,\n \t.unprepare = clk_prcmu_unprepare,\n \t.is_prepared = clk_prcmu_is_prepared,\n-\t.enable = clk_prcmu_enable,\n-\t.disable = clk_prcmu_disable,\n-\t.is_enabled = clk_prcmu_is_enabled,\n \t.recalc_rate = clk_prcmu_recalc_rate,\n };\n \n static const struct clk_ops clk_prcmu_scalable_rate_ops = {\n-\t.is_enabled = clk_prcmu_is_enabled,\n \t.recalc_rate = clk_prcmu_recalc_rate,\n \t.round_rate = clk_prcmu_round_rate,\n \t.set_rate = clk_prcmu_set_rate,\n };\n \n static const struct clk_ops clk_prcmu_rate_ops = {\n-\t.is_enabled = clk_prcmu_is_enabled,\n \t.recalc_rate = clk_prcmu_recalc_rate,\n };\n \n@@ -223,9 +195,6 @@ static const struct clk_ops clk_prcmu_opp_gate_ops = {\n \t.prepare = clk_prcmu_opp_prepare,\n \t.unprepare = clk_prcmu_opp_unprepare,\n \t.is_prepared = clk_prcmu_is_prepared,\n-\t.enable = clk_prcmu_enable,\n-\t.disable = clk_prcmu_disable,\n-\t.is_enabled = clk_prcmu_is_enabled,\n \t.recalc_rate = clk_prcmu_recalc_rate,\n };\n \n@@ -233,9 +202,6 @@ static const struct clk_ops clk_prcmu_opp_volt_scalable_ops = {\n \t.prepare = clk_prcmu_opp_volt_prepare,\n \t.unprepare = clk_prcmu_opp_volt_unprepare,\n \t.is_prepared = clk_prcmu_is_prepared,\n-\t.enable = clk_prcmu_enable,\n-\t.disable = clk_prcmu_disable,\n-\t.is_enabled = clk_prcmu_is_enabled,\n \t.recalc_rate = clk_prcmu_recalc_rate,\n \t.round_rate = clk_prcmu_round_rate,\n \t.set_rate = clk_prcmu_set_rate,\n@@ -263,7 +229,6 @@ static struct clk *clk_reg_prcmu(const char *name,\n \n \tclk->cg_sel = cg_sel;\n \tclk->is_prepared = 1;\n-\tclk->is_enabled = 1;\n \tclk->opp_requested = 0;\n \t/* \"rate\" can be used for changing the initial frequency */\n \tif (rate)\n", "stats": " drivers/clk/ux500/clk-prcmu.c | 35 -----------------------------------\n 1 file changed, 35 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "801179b670be3ff5e07c76c00837615b7f481aec"}, "tag": "linux", "timestamp": 1699830366.036642, "updated_on": 1650928644.0, "uuid": "006e6df19d052d5ab6680c59079ed76c5f2e1a46"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Colin Ian King <colin.i.king@gmail.com>", "AuthorDate": "Wed Mar 2 17:07:28 2022 +0000", "Commit": "Takashi Iwai <tiwai@suse.de>", "CommitDate": "Fri Mar 4 09:50:39 2022 +0100", "Signed-off-by": ["Colin Ian King <colin.i.king@gmail.com>", "Takashi Iwai <tiwai@suse.de>"], "commit": "3cffb26fbb5202c6a4bee4b99d6bef5623003fbb", "files": [{"action": "M", "added": "1", "file": "sound/pci/echoaudio/midi.c", "indexes": ["cb72d27e809e", "7be5c3327b16"], "modes": ["100644", "100644"], "removed": "1"}], "message": "ALSA: echoaudio: remove redundant assignment to variable bytes\n\nThe variable bytes is being assigned a value that is never read, it\nis being re-assigned inside a following if block. The assignment is\nredundant and can be removed.\n\nCleans up clang scan build warning:\nsound/pci/echoaudio/midi.c:211:9: warning: Although the value stored\nto 'bytes' is used in the enclosing expression, the value is never\nactually read from 'bytes' [deadcode.DeadStores]\n\nSigned-off-by: Colin Ian King <colin.i.king@gmail.com>\nLink: https://lore.kernel.org/r/20220302170728.1094633-1-colin.i.king@gmail.com\nSigned-off-by: Takashi Iwai <tiwai@suse.de>", "parents": ["76f22f4dcae645ea468811f9d30ec04f9ffaa1ea"], "refs": [], "diff": "diff --git a/sound/pci/echoaudio/midi.c b/sound/pci/echoaudio/midi.c\nindex cb72d27e809e..7be5c3327b16 100644\n--- a/sound/pci/echoaudio/midi.c\n+++ b/sound/pci/echoaudio/midi.c\n@@ -208,7 +208,7 @@ static void snd_echo_midi_output_write(struct timer_list *t)\n \n \t/* No interrupts are involved: we have to check at regular intervals\n \tif the card's output buffer has room for new data. */\n-\tsent = bytes = 0;\n+\tsent = 0;\n \tspin_lock_irqsave(&chip->lock, flags);\n \tchip->midi_full = 0;\n \tif (!snd_rawmidi_transmit_empty(chip->midi_out)) {\n", "stats": " sound/pci/echoaudio/midi.c | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "3cffb26fbb5202c6a4bee4b99d6bef5623003fbb"}, "tag": "linux", "timestamp": 1699830098.5908, "updated_on": 1646383839.0, "uuid": "5cc0f01791cfeb64e661fb4e44ce9eec5212b2d5"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Justin Stitt <jstitt007@gmail.com>", "AuthorDate": "Tue Jun 7 12:11:19 2022 -0700", "Commit": "Jakub Kicinski <kuba@kernel.org>", "CommitDate": "Wed Jun 8 21:12:03 2022 -0700", "Signed-off-by": ["Justin Stitt <jstitt007@gmail.com>", "Jakub Kicinski <kuba@kernel.org>"], "commit": "647df0d41b6bd8f4987dde6e8d8d0aba5b082985", "files": [{"action": "M", "added": "1", "file": "drivers/net/ethernet/amd/xgbe/xgbe-drv.c", "indexes": ["a3593290886f", "4d46780fad13"], "modes": ["100644", "100644"], "removed": "1"}], "message": "net: amd-xgbe: fix clang -Wformat warning\n\nsee warning:\n| drivers/net/ethernet/amd/xgbe/xgbe-drv.c:2787:43: warning: format specifies\n| type 'unsigned short' but the argument has type 'int' [-Wformat]\n|        netdev_dbg(netdev, \"Protocol: %#06hx\\n\", ntohs(eth->h_proto));\n|                                      ~~~~~~     ^~~~~~~~~~~~~~~~~~~\n\nVariadic functions (printf-like) undergo default argument promotion.\nDocumentation/core-api/printk-formats.rst specifically recommends\nusing the promoted-to-type's format flag.\n\nAlso, as per C11 6.3.1.1:\n(https://www.open-std.org/jtc1/sc22/wg14/www/docs/n1548.pdf)\n`If an int can represent all values of the original type ..., the\nvalue is converted to an int; otherwise, it is converted to an\nunsigned int. These are called the integer promotions.`\n\nSince the argument is a u16 it will get promoted to an int and thus it is\nmost accurate to use the %x format specifier here. It should be noted that the\n`#06` formatting sugar does not alter the promotion rules.\n\nLink: https://github.com/ClangBuiltLinux/linux/issues/378\nSigned-off-by: Justin Stitt <jstitt007@gmail.com>\nReviewed-by: Nick Desaulniers <ndesaulniers@google.com>\nLink: https://lore.kernel.org/r/20220607191119.20686-1-jstitt007@gmail.com\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>", "parents": ["e67b72b90b7e19a4be4d9c29f3feea6f58ab43f8"], "refs": [], "diff": "diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.c\nindex a3593290886f..4d46780fad13 100644\n--- a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c\n+++ b/drivers/net/ethernet/amd/xgbe/xgbe-drv.c\n@@ -2784,7 +2784,7 @@ void xgbe_print_pkt(struct net_device *netdev, struct sk_buff *skb, bool tx_rx)\n \n \tnetdev_dbg(netdev, \"Dst MAC addr: %pM\\n\", eth->h_dest);\n \tnetdev_dbg(netdev, \"Src MAC addr: %pM\\n\", eth->h_source);\n-\tnetdev_dbg(netdev, \"Protocol: %#06hx\\n\", ntohs(eth->h_proto));\n+\tnetdev_dbg(netdev, \"Protocol: %#06x\\n\", ntohs(eth->h_proto));\n \n \tfor (i = 0; i < skb->len; i += 32) {\n \t\tunsigned int len = min(skb->len - i, 32U);\n", "stats": " drivers/net/ethernet/amd/xgbe/xgbe-drv.c | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "647df0d41b6bd8f4987dde6e8d8d0aba5b082985"}, "tag": "linux", "timestamp": 1699830413.896368, "updated_on": 1654747923.0, "uuid": "1978e9fa20133e356a9bf2e51e3688edd0ad549d"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Mark Brown <broonie@kernel.org>", "AuthorDate": "Wed Feb 23 01:48:45 2022 +0000", "Commit": "Mark Brown <broonie@kernel.org>", "CommitDate": "Mon Feb 28 13:34:01 2022 +0000", "Signed-off-by": ["Mark Brown <broonie@kernel.org>", "Mark Brown <broonie@kernel.org>"], "commit": "9231bb1b25348bff738181e4614c997bcdeba7cf", "files": [{"action": "M", "added": "17", "file": "sound/soc/codecs/pcm3168a.c", "indexes": ["7417cf45d916", "cf27f05dc46a"], "modes": ["100644", "100644"], "removed": "17"}], "message": "ASoC: pcm3168a: Use modern ASoC DAI format terminology\n\nAs part of moving to remove the old style defines for the bus clocks update\nthe pcm3168a driver to use more modern terminology for clocking.\n\nSigned-off-by: Mark Brown <broonie@kernel.org>\nLink: https://lore.kernel.org/r/20220223014846.2765382-3-broonie@kernel.org\nSigned-off-by: Mark Brown <broonie@kernel.org>", "parents": ["765e30ac665777d7d7ad4fe75490138a85931d3a"], "refs": [], "diff": "diff --git a/sound/soc/codecs/pcm3168a.c b/sound/soc/codecs/pcm3168a.c\nindex 7417cf45d916..cf27f05dc46a 100644\n--- a/sound/soc/codecs/pcm3168a.c\n+++ b/sound/soc/codecs/pcm3168a.c\n@@ -48,7 +48,7 @@ static const char *const pcm3168a_supply_names[] = {\n \n /* ADC/DAC side parameters */\n struct pcm3168a_io_params {\n-\tbool master_mode;\n+\tbool provider_mode;\n \tunsigned int format;\n \tint tdm_slots;\n \tu32 tdm_mask;\n@@ -357,7 +357,7 @@ static int pcm3168a_set_dai_fmt(struct snd_soc_dai *dai, unsigned int format)\n \tstruct snd_soc_component *component = dai->component;\n \tstruct pcm3168a_priv *pcm3168a = snd_soc_component_get_drvdata(component);\n \tstruct pcm3168a_io_params *io_params = &pcm3168a->io_params[dai->id];\n-\tbool master_mode;\n+\tbool provider_mode;\n \n \tswitch (format & SND_SOC_DAIFMT_FORMAT_MASK) {\n \tcase SND_SOC_DAIFMT_LEFT_J:\n@@ -371,15 +371,15 @@ static int pcm3168a_set_dai_fmt(struct snd_soc_dai *dai, unsigned int format)\n \t\treturn -EINVAL;\n \t}\n \n-\tswitch (format & SND_SOC_DAIFMT_MASTER_MASK) {\n-\tcase SND_SOC_DAIFMT_CBS_CFS:\n-\t\tmaster_mode = false;\n+\tswitch (format & SND_SOC_DAIFMT_CLOCK_PROVIDER_MASK) {\n+\tcase SND_SOC_DAIFMT_CBC_CFC:\n+\t\tprovider_mode = false;\n \t\tbreak;\n-\tcase SND_SOC_DAIFMT_CBM_CFM:\n-\t\tmaster_mode = true;\n+\tcase SND_SOC_DAIFMT_CBP_CFP:\n+\t\tprovider_mode = true;\n \t\tbreak;\n \tdefault:\n-\t\tdev_err(component->dev, \"unsupported master/slave mode\\n\");\n+\t\tdev_err(component->dev, \"unsupported provider mode\\n\");\n \t\treturn -EINVAL;\n \t}\n \n@@ -390,7 +390,7 @@ static int pcm3168a_set_dai_fmt(struct snd_soc_dai *dai, unsigned int format)\n \t\treturn -EINVAL;\n \t}\n \n-\tio_params->master_mode = master_mode;\n+\tio_params->provider_mode = provider_mode;\n \tio_params->format = format & SND_SOC_DAIFMT_FORMAT_MASK;\n \n \tpcm3168a_update_fixup_pcm_stream(dai);\n@@ -440,7 +440,7 @@ static int pcm3168a_hw_params(struct snd_pcm_substream *substream,\n \tstruct snd_soc_component *component = dai->component;\n \tstruct pcm3168a_priv *pcm3168a = snd_soc_component_get_drvdata(component);\n \tstruct pcm3168a_io_params *io_params = &pcm3168a->io_params[dai->id];\n-\tbool master_mode, tdm_mode;\n+\tbool provider_mode, tdm_mode;\n \tunsigned int format;\n \tunsigned int reg, mask, ms, ms_shift, fmt, fmt_shift, ratio, tdm_slots;\n \tint i, num_scki_ratios, slot_width;\n@@ -459,9 +459,9 @@ static int pcm3168a_hw_params(struct snd_pcm_substream *substream,\n \t\tfmt_shift = PCM3168A_ADC_FMTAD_SHIFT;\n \t}\n \n-\tmaster_mode = io_params->master_mode;\n+\tprovider_mode = io_params->provider_mode;\n \n-\tif (master_mode) {\n+\tif (provider_mode) {\n \t\tratio = pcm3168a->sysclk / params_rate(params);\n \n \t\tfor (i = 0; i < num_scki_ratios; i++) {\n@@ -488,15 +488,15 @@ static int pcm3168a_hw_params(struct snd_pcm_substream *substream,\n \n \tswitch (slot_width) {\n \tcase 16:\n-\t\tif (master_mode || (format != SND_SOC_DAIFMT_RIGHT_J)) {\n-\t\t\tdev_err(component->dev, \"16-bit slots are supported only for slave mode using right justified\\n\");\n+\t\tif (provider_mode || (format != SND_SOC_DAIFMT_RIGHT_J)) {\n+\t\t\tdev_err(component->dev, \"16-bit slots are supported only for consumer mode using right justified\\n\");\n \t\t\treturn -EINVAL;\n \t\t}\n \t\tbreak;\n \tcase 24:\n-\t\tif (master_mode || (format == SND_SOC_DAIFMT_DSP_A) ||\n-\t\t\t\t   (format == SND_SOC_DAIFMT_DSP_B)) {\n-\t\t\tdev_err(component->dev, \"24-bit slots not supported in master mode, or slave mode using DSP\\n\");\n+\t\tif (provider_mode || (format == SND_SOC_DAIFMT_DSP_A) ||\n+\t\t    \t\t     (format == SND_SOC_DAIFMT_DSP_B)) {\n+\t\t\tdev_err(component->dev, \"24-bit slots not supported in provider mode, or consumer mode using DSP\\n\");\n \t\t\treturn -EINVAL;\n \t\t}\n \t\tbreak;\n", "stats": " sound/soc/codecs/pcm3168a.c | 34 +++++++++++++++++-----------------\n 1 file changed, 17 insertions(+), 17 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "9231bb1b25348bff738181e4614c997bcdeba7cf"}, "tag": "linux", "timestamp": 1699830098.786963, "updated_on": 1646055241.0, "uuid": "b5866de2c3c14fb3d0eb1ad9f0447b1a7b4e366e"}
{"backend_name": "Git", "backend_version": "0.13.0", "category": "commit", "classified_fields_filtered": null, "data": {"Author": "Michael Straube <straube.linux@gmail.com>", "AuthorDate": "Sat Apr 2 11:23:32 2022 +0200", "Commit": "Greg Kroah-Hartman <gregkh@linuxfoundation.org>", "CommitDate": "Mon Apr 4 07:33:50 2022 +0200", "Signed-off-by": ["Michael Straube <straube.linux@gmail.com>", "Greg Kroah-Hartman <gregkh@linuxfoundation.org>"], "commit": "67fda6c2df8223c6bd5e8daee929c9a8179190cf", "files": [{"action": "M", "added": "3", "file": "drivers/staging/r8188eu/core/rtw_p2p.c", "indexes": ["48500fb82250", "1e728a03e0ac"], "modes": ["100644", "100644"], "removed": "3"}, {"action": "M", "added": "0", "file": "drivers/staging/r8188eu/hal/usb_halinit.c", "indexes": ["cbd49183be13", "4bc6b08fb282"], "modes": ["100644", "100644"], "removed": "6"}, {"action": "M", "added": "0", "file": "drivers/staging/r8188eu/include/hal_intf.h", "indexes": ["0f64cb41cca6", "e222ab89bfc5"], "modes": ["100644", "100644"], "removed": "1"}], "message": "staging: r8188eu: remove HW_VAR_H2C_FW_P2P_PS_OFFLOAD from SetHwReg8188EU()\n\nThe HW_VAR_H2C_FW_P2P_PS_OFFLOAD case in SetHwReg8188EU() just calls a\nfunction. Call the function directly and remove the\nHW_VAR_H2C_FW_P2P_PS_OFFLOAD case from SetHwReg8188EU(). This is part\nof the ongoing effort to get rid of the unwanted hal layer.\n\nSigned-off-by: Michael Straube <straube.linux@gmail.com>\nLink: https://lore.kernel.org/r/20220402092332.6627-8-straube.linux@gmail.com\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>", "parents": ["f234f5f7bce383dba4ad8b639c9befe5c7be05c2"], "refs": [], "diff": "diff --git a/drivers/staging/r8188eu/core/rtw_p2p.c b/drivers/staging/r8188eu/core/rtw_p2p.c\nindex 48500fb82250..1e728a03e0ac 100644\n--- a/drivers/staging/r8188eu/core/rtw_p2p.c\n+++ b/drivers/staging/r8188eu/core/rtw_p2p.c\n@@ -1602,7 +1602,7 @@ void p2p_ps_wk_hdl(struct adapter *padapter, u8 p2p_ps_state)\n \tcase P2P_PS_DISABLE:\n \t\tpwdinfo->p2p_ps_state = p2p_ps_state;\n \n-\t\tSetHwReg8188EU(padapter, HW_VAR_H2C_FW_P2P_PS_OFFLOAD, (u8 *)(&p2p_ps_state));\n+\t\trtl8188e_set_p2p_ps_offload_cmd(padapter, p2p_ps_state);\n \n \t\tpwdinfo->noa_index = 0;\n \t\tpwdinfo->ctwindow = 0;\n@@ -1626,7 +1626,7 @@ void p2p_ps_wk_hdl(struct adapter *padapter, u8 p2p_ps_state)\n \t\t\t\t\tSetHwReg8188EU(padapter, HW_VAR_H2C_FW_PWRMODE, (u8 *)(&padapter->pwrctrlpriv.pwr_mode));\n \t\t\t\t}\n \t\t\t}\n-\t\t\tSetHwReg8188EU(padapter, HW_VAR_H2C_FW_P2P_PS_OFFLOAD, (u8 *)(&p2p_ps_state));\n+\t\t\trtl8188e_set_p2p_ps_offload_cmd(padapter, p2p_ps_state);\n \t\t}\n \t\tbreak;\n \tcase P2P_PS_SCAN:\n@@ -1634,7 +1634,7 @@ void p2p_ps_wk_hdl(struct adapter *padapter, u8 p2p_ps_state)\n \tcase P2P_PS_ALLSTASLEEP:\n \t\tif (pwdinfo->p2p_ps_mode > P2P_PS_NONE) {\n \t\t\tpwdinfo->p2p_ps_state = p2p_ps_state;\n-\t\t\tSetHwReg8188EU(padapter, HW_VAR_H2C_FW_P2P_PS_OFFLOAD, (u8 *)(&p2p_ps_state));\n+\t\t\trtl8188e_set_p2p_ps_offload_cmd(padapter, p2p_ps_state);\n \t\t}\n \t\tbreak;\n \tdefault:\ndiff --git a/drivers/staging/r8188eu/hal/usb_halinit.c b/drivers/staging/r8188eu/hal/usb_halinit.c\nindex cbd49183be13..4bc6b08fb282 100644\n--- a/drivers/staging/r8188eu/hal/usb_halinit.c\n+++ b/drivers/staging/r8188eu/hal/usb_halinit.c\n@@ -1150,12 +1150,6 @@ void SetHwReg8188EU(struct adapter *Adapter, u8 variable, u8 *val)\n \t\t\trtl8188e_set_FwPwrMode_cmd(Adapter, psmode);\n \t\t}\n \t\tbreak;\n-\tcase HW_VAR_H2C_FW_P2P_PS_OFFLOAD:\n-\t\t{\n-\t\t\tu8 p2p_ps_state = (*(u8 *)val);\n-\t\t\trtl8188e_set_p2p_ps_offload_cmd(Adapter, p2p_ps_state);\n-\t\t}\n-\t\tbreak;\n \tcase HW_VAR_INITIAL_GAIN:\n \t\t{\n \t\t\tstruct rtw_dig *pDigTable = &podmpriv->DM_DigTable;\ndiff --git a/drivers/staging/r8188eu/include/hal_intf.h b/drivers/staging/r8188eu/include/hal_intf.h\nindex 0f64cb41cca6..e222ab89bfc5 100644\n--- a/drivers/staging/r8188eu/include/hal_intf.h\n+++ b/drivers/staging/r8188eu/include/hal_intf.h\n@@ -22,7 +22,6 @@ enum hw_variables {\n \tHW_VAR_AC_PARAM_BE,\n \tHW_VAR_AMPDU_FACTOR,\n \tHW_VAR_H2C_FW_PWRMODE,\n-\tHW_VAR_H2C_FW_P2P_PS_OFFLOAD,\n \tHW_VAR_INITIAL_GAIN,\n \tHW_VAR_FIFO_CLEARN_UP,\n \tHW_VAR_H2C_MEDIA_STATUS_RPT,\n", "stats": " drivers/staging/r8188eu/core/rtw_p2p.c     | 6 +++---\n drivers/staging/r8188eu/hal/usb_halinit.c  | 6 ------\n drivers/staging/r8188eu/include/hal_intf.h | 1 -\n 3 files changed, 3 insertions(+), 10 deletions(-)\n"}, "origin": "linux", "perceval_version": "0.23.1", "search_fields": {"item_id": "67fda6c2df8223c6bd5e8daee929c9a8179190cf"}, "tag": "linux", "timestamp": 1699830390.310543, "updated_on": 1649050430.0, "uuid": "61d50143dced342f57aaf0adada6d63956130948"}
